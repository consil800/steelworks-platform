<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SteelWorks Platform - ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="../shared-assets/css/main.css">
    <link rel="stylesheet" href="../shared-assets/css/platform.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Database Manager -->
    <script src="database.js"></script>
    <!-- Domain Manager -->
    <script src="domain-manager.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            height: 70px;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .brand-text h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .brand-text span {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .nav-menu {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            margin-top: 80px; /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ë†’ì´ë§Œí¼ ì—¬ë°± ì¶”ê°€ */
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .dashboard-header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .dashboard-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-card .icon {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
            text-align: center;
            line-height: 50px;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .stat-card h3 {
            margin: 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .stat-card .trend {
            color: #27ae60;
            font-size: 0.9em;
        }
        
        .dashboard-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .management-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .management-section h2 {
            margin-top: 0;
            color: #333;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .company-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .company-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .company-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 16px 16px 0 0;
        }
        
        .company-card.tier-basic::before {
            background: linear-gradient(90deg, #94a3b8, #64748b);
        }
        
        .company-card.tier-standard::before {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }
        
        .company-card.tier-premium::before {
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
        }
        
        .company-card.tier-enterprise::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        
        .company-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: #cbd5e1;
        }
        
        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .company-info h4 {
            margin: 0 0 8px 0;
            color: #1e293b;
            font-size: 1.25rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .company-domain {
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .company-tier {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }
        
        .tier-basic {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        
        .tier-standard {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .tier-premium {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            color: #6d28d9;
            border: 1px solid #c4b5fd;
        }
        
        .tier-enterprise {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .company-details {
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .detail-icon {
            width: 20px;
            margin-right: 12px;
            color: #667eea;
            font-size: 0.875rem;
        }
        
        .detail-text {
            color: #475569;
            font-size: 0.875rem;
            flex: 1;
        }
        
        .detail-text.website-link {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .detail-text.website-link:hover {
            color: #5a67d8;
            text-decoration: underline;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-inactive {
            background: #fef2f2;
            color: #991b1b;
        }
        
        .company-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f1f5f9;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.8rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-sm:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #475569, #334155);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #0891b2, #0e7490);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .add-new-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .add-new-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.3);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.8em;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group.half-width {
            margin-bottom: 0;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-end;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            max-width: 150px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-cancel {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            max-width: 120px;
        }
        
        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            max-width: 120px;
        }

        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }
        
        .btn-danger:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .permission-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .permission-card h4 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .permission-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .permission-item input[type="checkbox"] {
            margin-right: 10px;
        }

        /* ìƒˆë¡œ ì¶”ê°€ëœ ìŠ¤íƒ€ì¼ë“¤ */
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .company-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .company-card:hover {
            transform: translateY(-2px);
        }

        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .company-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .company-info p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .company-logo {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }

        .company-details {
            margin-bottom: 15px;
        }

        .company-details p {
            margin: 5px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .company-details i {
            width: 20px;
            color: #667eea;
        }

        .company-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }



        /* ì‚¬ìš©ì ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .company-users-section {
            margin-bottom: 30px;
        }

        /* íšŒì‚¬ ì„¹ì…˜ ì œëª© ìŠ¤íƒ€ì¼ì€ ì•„ë˜ì—ì„œ ì •ì˜ë¨ */

        /* ì‚¬ìš©ì ê´€ë¦¬ í…Œì´ë¸” ìŠ¤íƒ€ì¼ì€ ì•„ë˜ .users-table ì„¹ì…˜ì—ì„œ ì •ì˜ë¨ */
        
        /* ì‚¬ìš©ì ëª©ë¡ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .user-list {
            margin-top: 20px;
        }
        
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ì€ ì•„ë˜ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ë¡œ ëŒ€ì²´ë¨ */
        
        /* ì‚¬ìš©ì í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .users-table-container {
            overflow-x: auto;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        
        .users-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .users-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            white-space: nowrap;
        }
        
        .users-table tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s ease;
        }
        
        .users-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .users-table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .user-name strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        .user-contact {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .user-actions-cell {
            width: 150px;
        }
        
        .user-actions-cell .user-actions {
            gap: 5px;
            justify-content: flex-start;
            margin-top: 0;
        }
        
        .user-actions .btn-sm {
            padding: 4px 8px;
            font-size: 0.85rem;
        }
        
        /* ì—­í•  ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .role-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .role-badge.master {
            background: #fef3c7;
            color: #92400e;
        }
        
        .role-badge.company_admin,
        .role-badge.admin {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .role-badge.company_manager,
        .role-badge.manager {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .role-badge.company_employee,
        .role-badge.employee {
            background: #d1fae5;
            color: #065f46;
        }
        
        /* ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .company-users-section {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .company-section-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .company-section-header:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }
        
        .company-section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .dropdown-icon {
            transition: transform 0.3s ease;
            font-size: 0.9rem;
        }
        
        .company-users-section.expanded .dropdown-icon {
            transform: rotate(180deg);
        }
        
        .users-table-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }
        
        .company-users-section.expanded .users-table-container {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .user-count {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .users-table {
                font-size: 0.85rem;
            }
            
            .users-table th,
            .users-table td {
                padding: 8px 10px;
            }
            
            .user-actions-cell {
                width: auto;
            }
        }

        /* ê¶Œí•œ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .permissions-overview {
            margin-bottom: 30px;
        }

        .permissions-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .permission-stat {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.admin {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .stat-icon.manager {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .stat-icon.employee {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .company-permission-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .permission-breakdown {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .role-badge.admin {
            background: #fff3cd;
            color: #856404;
        }

        .role-badge.manager {
            background: #d1ecf1;
            color: #0c5460;
        }

        .role-badge.employee {
            background: #d4edda;
            color: #155724;
        }

        /* ì‹œìŠ¤í…œ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .system-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .system-stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .system-stat-card i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .status-text {
            font-weight: 600;
            margin-top: 10px;
        }

        .status-text.connected {
            color: #28a745;
        }

        .status-text.disconnected {
            color: #dc3545;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .activity-list {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item i {
            color: #667eea;
            width: 20px;
        }

        .activity-item time {
            margin-left: auto;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .company-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .company-card {
                padding: 20px;
            }
            
            .company-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .company-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-sm {
                width: 100%;
                justify-content: center;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .nav-menu {
                display: none;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .company-card {
                padding: 16px;
            }
            
            .company-info h4 {
                font-size: 1.1rem;
            }
            
            .detail-text {
                font-size: 0.8rem;
            }
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .company-card {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .company-card:nth-child(1) { animation-delay: 0.1s; }
        .company-card:nth-child(2) { animation-delay: 0.2s; }
        .company-card:nth-child(3) { animation-delay: 0.3s; }
        .company-card:nth-child(4) { animation-delay: 0.4s; }
        .company-card:nth-child(5) { animation-delay: 0.5s; }
        .company-card:nth-child(6) { animation-delay: 0.6s; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="brand-text">
                    <h1>SteelWorks</h1>
                    <span>Master Dashboard</span>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="index.html" class="nav-link">í”Œë«í¼ í™ˆ</a>
                <a href="#companies" class="nav-link" onclick="showTab('companies')">íšŒì‚¬ ê´€ë¦¬</a>
                <a href="#users" class="nav-link" onclick="showTab('users')">ì‚¬ìš©ì ê´€ë¦¬</a>
                <a href="#permissions" class="nav-link" onclick="showTab('permissions')">ê¶Œí•œ ê´€ë¦¬</a>
                <a href="#settings" class="nav-link" onclick="showTab('system')">ì„¤ì •</a>
            </div>
            
            <div class="nav-actions">
                <span class="user-info">
                    <i class="fas fa-crown" style="color: gold;"></i> ë§ˆìŠ¤í„° ê´€ë¦¬ì
                </span>
                <button onclick="logout()" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ</h1>
            <p>SteelWorks Platformì˜ ëª¨ë“  íšŒì‚¬ì™€ ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card" id="totalCompanies">
                <div class="icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>ë“±ë¡ëœ íšŒì‚¬</h3>
                <div class="value">0</div>
                <div class="trend">í”Œë«í¼ ë“±ë¡ íšŒì‚¬</div>
            </div>
            
            <div class="stat-card" id="totalUsers">
                <div class="icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>ì´ ì‚¬ìš©ì</h3>
                <div class="value">0</div>
                <div class="trend">ì§ì› ìˆ˜ í•©ê³„</div>
            </div>
            
            <div class="stat-card" id="activeWebsites">
                <div class="icon">
                    <i class="fas fa-globe"></i>
                </div>
                <h3>í™œì„± í™ˆí˜ì´ì§€</h3>
                <div class="value">0</div>
                <div class="trend">ì‚¬ìš© ì¤‘ì¸ íšŒì‚¬ ìˆ˜</div>
            </div>
            
            <div class="stat-card" id="systemStatus">
                <div class="icon">
                    <i class="fas fa-server"></i>
                </div>
                <h3>ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                <div class="value" style="font-size: 1.5em;">ì •ìƒ</div>
                <div class="trend">0% ê°€ë™ë¥ </div>
            </div>
        </div>

        <div class="dashboard-tabs">
            <button class="tab-btn active" onclick="showTab('companies')">
                <i class="fas fa-building"></i> íšŒì‚¬ ê´€ë¦¬
            </button>
            <button class="tab-btn" onclick="showTab('users'); debugLocalStorage();">
                <i class="fas fa-users"></i> ì‚¬ìš©ì ê´€ë¦¬
            </button>
            <button class="tab-btn" onclick="showTab('permissions')">
                <i class="fas fa-shield-alt"></i> ê¶Œí•œ ê´€ë¦¬
            </button>
            <button class="tab-btn" onclick="showTab('system')">
                <i class="fas fa-cog"></i> ì‹œìŠ¤í…œ ì„¤ì •
            </button>
        </div>

        <div id="companies-tab" class="tab-content active">
            <div class="management-section">
                <h2>íšŒì‚¬ ê´€ë¦¬</h2>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="íšŒì‚¬ëª…ìœ¼ë¡œ ê²€ìƒ‰...">
                    <button class="btn btn-primary">
                        <i class="fas fa-search"></i> ê²€ìƒ‰
                    </button>
                </div>

                <div class="company-list">
                    <!-- íšŒì‚¬ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
                
                <button class="add-new-btn" onclick="showAddCompanyModal()">
                    <i class="fas fa-plus"></i> ìƒˆ íšŒì‚¬ ì¶”ê°€
                </button>
                
            </div>
        </div>

        <div id="users-tab" class="tab-content">
            <div class="management-section">
                <h2>ì‚¬ìš©ì ê´€ë¦¬</h2>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼ë¡œ ê²€ìƒ‰...">
                    <select class="search-input" style="flex: 0.3;" id="companyFilterSelect">
                        <option value="">ëª¨ë“  íšŒì‚¬</option>
                        <!-- íšŒì‚¬ ì˜µì…˜ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </select>
                    <button class="btn btn-primary">
                        <i class="fas fa-search"></i> ê²€ìƒ‰
                    </button>
                    <button class="btn btn-secondary" onclick="toggleAllCompanySections(true)" title="ëª¨ë“  íšŒì‚¬ í¼ì¹˜ê¸°">
                        <i class="fas fa-expand-alt"></i> ëª¨ë‘ í¼ì¹˜ê¸°
                    </button>
                    <button class="btn btn-secondary" onclick="toggleAllCompanySections(false)" title="ëª¨ë“  íšŒì‚¬ ì ‘ê¸°">
                        <i class="fas fa-compress-alt"></i> ëª¨ë‘ ì ‘ê¸°
                    </button>
                </div>

                <div class="user-list" id="usersList">
                    <!-- ì‚¬ìš©ì ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <div id="permissions-tab" class="tab-content">
            <div class="management-section">
                <h2>ê¶Œí•œ ê´€ë¦¬</h2>
                <div class="permissions-content">
                    <!-- ê¶Œí•œ ê´€ë¦¬ ì½˜í…ì¸ ê°€ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <div id="system-tab" class="tab-content">
            <div class="management-section">
                <h2>ì‹œìŠ¤í…œ ê´€ë¦¬</h2>
                <div class="system-content">
                    <!-- ì‹œìŠ¤í…œ ê´€ë¦¬ ì½˜í…ì¸ ê°€ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
            </div>
        </div>
    </div>

    <!-- ìƒˆ íšŒì‚¬ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="addCompanyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ìƒˆ íšŒì‚¬ ì¶”ê°€</h2>
                <button class="close-btn" onclick="hideAddCompanyModal()">&times;</button>
            </div>
            
            <form id="addCompanyForm" onsubmit="handleAddCompany(event)">
                <div class="form-group">
                    <label for="companyName">ë²•ì¸ëª…(ë‹¨ì²´ëª…) *</label>
                    <input type="text" id="companyName" name="companyName" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="businessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ *</label>
                        <input type="text" id="businessNumber" name="businessNumber" placeholder="000-00-00000" required>
                    </div>
                    <div class="form-group">
                        <label for="corporateNumber">ë²•ì¸ë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" id="corporateNumber" name="corporateNumber" placeholder="000000-0000000">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="representative">ëŒ€í‘œì *</label>
                        <input type="text" id="representative" name="representative" required>
                    </div>
                    <div class="form-group">
                        <label for="openingDate">ê°œì—…ì—°ì›”ì¼ *</label>
                        <input type="date" id="openingDate" name="openingDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="businessAddress">ì‚¬ì—…ì ì†Œì¬ì§€ *</label>
                    <input type="text" id="businessAddress" name="businessAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œ ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œ" required>
                </div>
                
                <div class="form-group">
                    <label for="businessType">ì‚¬ì—…ì˜ ì¢…ë¥˜ *</label>
                    <input type="text" id="businessType" name="businessType" placeholder="ì˜ˆ: ì² ê°• ì œì¡°ì—…, ìë™ì°¨ ë¶€í’ˆ ì œì¡°ì—…" required>
                </div>
                
                
                <div class="form-group">
                    <label for="websiteUrl">í™ˆí˜ì´ì§€ ì£¼ì†Œ</label>
                    <input type="url" id="websiteUrl" name="websiteUrl" placeholder="ì˜ˆ: https://consil800.com">
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 5px;">í™ˆí˜ì´ì§€ ì „ì²´ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (http:// ë˜ëŠ” https:// í¬í•¨)</small>
                </div>
                
                <div class="form-group">
                    <label for="domainUrl">íšŒì‚¬ ë„ë©”ì¸ ì£¼ì†Œ</label>
                    <input type="url" id="domainUrl" name="domainUrl" placeholder="https://www.example.com">
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 5px;">
                        íšŒì‚¬ ê³µì‹ í™ˆí˜ì´ì§€ ë„ë©”ì¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)
                    </small>
                </div>
                
                <button type="submit" class="btn-submit">íšŒì‚¬ ë“±ë¡</button>
                <button type="button" class="btn-cancel" onclick="hideAddCompanyModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <!-- íšŒì‚¬ í¸ì§‘ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="editCompanyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>íšŒì‚¬ ì •ë³´ í¸ì§‘</h2>
                <button class="close-btn" onclick="hideEditCompanyModal()">&times;</button>
            </div>
            
            <form id="editCompanyForm" onsubmit="handleEditCompany(event)">
                <input type="hidden" id="editCompanyId" name="editCompanyId">
                
                <div class="form-group">
                    <label for="editCompanyName">ë²•ì¸ëª…(ë‹¨ì²´ëª…) *</label>
                    <input type="text" id="editCompanyName" name="editCompanyName" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group half-width">
                        <label for="editBusinessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ *</label>
                        <input type="text" id="editBusinessNumber" name="editBusinessNumber" placeholder="000-00-00000" required>
                    </div>
                    <div class="form-group half-width">
                        <label for="editCorporateNumber">ë²•ì¸ë“±ë¡ë²ˆí˜¸</label>
                        <input type="text" id="editCorporateNumber" name="editCorporateNumber" placeholder="000000-0000000">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group half-width">
                        <label for="editRepresentative">ëŒ€í‘œì *</label>
                        <input type="text" id="editRepresentative" name="editRepresentative" required>
                    </div>
                    <div class="form-group half-width">
                        <label for="editOpeningDate">ê°œì—…ì—°ì›”ì¼ *</label>
                        <input type="date" id="editOpeningDate" name="editOpeningDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editBusinessAddress">ì‚¬ì—…ì ì†Œì¬ì§€ *</label>
                    <input type="text" id="editBusinessAddress" name="editBusinessAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œ ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œ" required>
                </div>
                
                <div class="form-group">
                    <label for="editBusinessType">ì‚¬ì—…ì˜ ì¢…ë¥˜ *</label>
                    <input type="text" id="editBusinessType" name="editBusinessType" placeholder="ì˜ˆ: ì² ê°• ì œì¡°ì—…, ìë™ì°¨ ë¶€í’ˆ ì œì¡°ì—…" required>
                </div>
                
                <div class="form-group">
                    <label for="editWebsiteUrl">í™ˆí˜ì´ì§€ ì£¼ì†Œ</label>
                    <input type="url" id="editWebsiteUrl" name="editWebsiteUrl" placeholder="ì˜ˆ: https://consil800.com">
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 5px;">í™ˆí˜ì´ì§€ ì „ì²´ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (http:// ë˜ëŠ” https:// í¬í•¨)</small>
                </div>
                
                <div class="form-group">
                    <label for="editCompanyEmail">ì´ë©”ì¼ ì£¼ì†Œ</label>
                    <input type="email" id="editCompanyEmail" name="editCompanyEmail" placeholder="contact@company.com">
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 5px;">
                        íšŒì‚¬ ëŒ€í‘œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)
                    </small>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-submit">ìˆ˜ì • ì™„ë£Œ</button>
                    <button type="button" class="btn-cancel" onclick="hideEditCompanyModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‚¬ìš©ì í¸ì§‘ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ì‚¬ìš©ì ì •ë³´ í¸ì§‘</h2>
                <button class="close-btn" onclick="hideEditUserModal()">&times;</button>
            </div>
            
            <form id="editUserForm" onsubmit="handleEditUser(event)">
                <input type="hidden" id="editUserId" name="editUserId">
                
                <div class="form-group">
                    <label for="editUserName">ì´ë¦„ *</label>
                    <input type="text" id="editUserName" name="editUserName" required>
                </div>
                
                <div class="form-group">
                    <label for="editUserPhone">ì—°ë½ì²˜</label>
                    <input type="tel" id="editUserPhone" name="editUserPhone" placeholder="010-0000-0000">
                </div>
                
                <div class="form-group">
                    <label for="editUserDepartment">ë¶€ì„œ</label>
                    <input type="text" id="editUserDepartment" name="editUserDepartment" placeholder="ì˜ˆ: ê²½ì˜ì§„, ê°œë°œíŒ€, ì˜ì—…íŒ€">
                </div>
                
                <div class="form-group">
                    <label for="editUserEmail">ì´ë©”ì¼</label>
                    <input type="email" id="editUserEmail" name="editUserEmail" placeholder="example@company.com">
                </div>
                
                <div class="modal-buttons">
                    <button type="submit" class="btn-submit" onclick="console.log('ğŸ”¥ ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ í´ë¦­ë¨!');">ìˆ˜ì • ì™„ë£Œ</button>
                    <button type="button" class="btn-delete" onclick="handleDeleteUser()">ì‚­ì œ</button>
                    <button type="button" class="btn-cancel" onclick="hideEditUserModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allCompanies = [];
        let allUsers = [];
        let systemStats = {
            totalCompanies: 0,
            totalUsers: 0,
            activeWebsites: 0
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            // ìƒ˜í”Œ ë°ì´í„° ì •ë¦¬
            cleanupSampleData();
            
            await loadDashboardData();
            updateStatistics();
            showTab('companies'); // ê¸°ë³¸ íƒ­ ì„¤ì •
        });

        // ìƒ˜í”Œ ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜
        function cleanupSampleData() {
            console.log('ğŸ§¹ ìƒ˜í”Œ ë°ì´í„° ì •ë¦¬ ì‹œì‘...');
            
            // ìƒ˜í”Œ íšŒì‚¬ ë°ì´í„° í‚¤ë“¤
            const sampleKeys = [
                'platform_companies',
                'companies',
                'users',
                'employees',
                'company_test-company-1_employees',
                'company_test-company-2_employees', 
                'company_test-company-3_employees',
                'company_test-company-1_representative',
                'company_test-company-2_representative',
                'company_test-company-3_representative'
            ];
            
            // ìƒ˜í”Œ ë°ì´í„° ì œê±°
            sampleKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    console.log(`ğŸ—‘ï¸ ì œê±°: ${key}`);
                }
            });
            
            // test-companyë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  í‚¤ ì œê±°
            const allKeys = Object.keys(localStorage);
            allKeys.forEach(key => {
                if (key.includes('test-company') || key.includes('sample') || key.includes('demo')) {
                    localStorage.removeItem(key);
                    console.log(`ğŸ—‘ï¸ ìƒ˜í”Œ ë°ì´í„° ì œê±°: ${key}`);
                }
            });
            
            console.log('âœ… ìƒ˜í”Œ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
        }

        // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDashboardData() {
            try {
                // ë§ˆìŠ¤í„° ê¶Œí•œìœ¼ë¡œ ëª¨ë“  íšŒì‚¬ ì¡°íšŒ
                if (db && db.client) {
                    const { data: companiesData, error: companiesError } = await db.client
                        .from('companies')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (!companiesError && companiesData) {
                        allCompanies = companiesData;
                    }

                    // ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ (ë§ˆìŠ¤í„° ê¶Œí•œ)
                    const { data: usersData, error: usersError } = await db.client
                        .from('users')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (!usersError && usersData) {
                        allUsers = usersData;
                    }
                } else {
                    throw new Error('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }

                console.log('ë¡œë“œëœ íšŒì‚¬ ìˆ˜:', allCompanies.length);
                console.log('ë¡œë“œëœ ì‚¬ìš©ì ìˆ˜:', allUsers.length);
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                throw error;
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            systemStats.totalCompanies = allCompanies.length;
            systemStats.totalUsers = allUsers.length;
            systemStats.activeWebsites = allCompanies.filter(c => c.is_active !== false).length;

            console.log('ğŸ“Š updateStatistics í˜¸ì¶œë¨:');
            console.log(`  - ì´ íšŒì‚¬: ${systemStats.totalCompanies}ê°œ`);
            console.log(`  - ì´ ì‚¬ìš©ì: ${systemStats.totalUsers}ëª…`);
            console.log(`  - í™œì„± í™ˆí˜ì´ì§€: ${systemStats.activeWebsites}ê°œ`);

            // DOM ì—…ë°ì´íŠ¸
            const totalCompaniesEl = document.querySelector('#totalCompanies .value');
            const totalUsersEl = document.querySelector('#totalUsers .value');
            const activeWebsitesEl = document.querySelector('#activeWebsites .value');
            
            if (totalCompaniesEl) {
                totalCompaniesEl.textContent = systemStats.totalCompanies;
                console.log('âœ… ì´ íšŒì‚¬ ìˆ˜ ì—…ë°ì´íŠ¸:', systemStats.totalCompanies);
            } else {
                console.error('âŒ #totalCompanies .value ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            if (totalUsersEl) {
                totalUsersEl.textContent = systemStats.totalUsers;
                console.log('âœ… ì´ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸:', systemStats.totalUsers);
            } else {
                console.error('âŒ #totalUsers .value ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            if (activeWebsitesEl) {
                activeWebsitesEl.textContent = systemStats.activeWebsites;
                console.log('âœ… í™œì„± í™ˆí˜ì´ì§€ ìˆ˜ ì—…ë°ì´íŠ¸:', systemStats.activeWebsites);
            } else {
                console.error('âŒ #activeWebsites .value ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // í´ë¦­ëœ ë²„íŠ¼ ì°¾ê¸°
            const clickedBtn = event ? event.target : document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // íƒ­ë³„ ë°ì´í„° ë Œë”ë§
            switch(tabName) {
                case 'companies':
                    renderCompaniesList();
                    updateCompanyFilterDropdown();
                    break;
                case 'users':
                    setTimeout(() => {
                        renderUsersList();
                    }, 100);
                    break;
                case 'permissions':
                    renderPermissionsList();
                    break;
                case 'system':
                    renderSystemSettings();
                    break;
            }
        }

        // íšŒì‚¬ ëª©ë¡ ë Œë”ë§
        function renderCompaniesList() {
            const companiesGrid = document.querySelector('#companies-tab .company-list');
            if (!companiesGrid) return;

            if (allCompanies.length === 0) {
                companiesGrid.innerHTML = `
                    <div class="no-data" style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                        <i class="fas fa-building" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                        <h3 style="color: #64748b; margin-bottom: 1rem;">ë“±ë¡ëœ íšŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p style="color: #9ca3af; margin-bottom: 2rem;">ìƒˆë¡œìš´ íšŒì‚¬ë¥¼ ë“±ë¡í•˜ì—¬ ì‹œì‘í•´ë³´ì„¸ìš”</p>
                        <button onclick="addNewCompany()" class="btn btn-primary">
                            <i class="fas fa-plus"></i> ìƒˆ íšŒì‚¬ ë“±ë¡
                        </button>
                    </div>
                `;
                return;
            }

            companiesGrid.innerHTML = allCompanies.map(company => {
                const tier = (company.subscription_plan || 'basic').toLowerCase();
                const isActive = company.is_active !== false;
                
                return `
                    <div class="company-card tier-${tier}">
                        <div class="company-header">
                            <div class="company-info">
                                <h4>${company.company_name}</h4>
                                <div class="company-domain">${company.domain}</div>
                            </div>
                            <div class="company-tier tier-${tier}">
                                ${getTierDisplayName(tier)}
                            </div>
                        </div>
                        
                        <div class="company-details">
                            <div class="detail-item">
                                <i class="fas fa-phone detail-icon"></i>
                                <span class="detail-text">${company.phone || 'ì—°ë½ì²˜ ë¯¸ë“±ë¡'}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-envelope detail-icon"></i>
                                <span class="detail-text">${company.email || 'ì´ë©”ì¼ ë¯¸ë“±ë¡'}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-globe detail-icon"></i>
                                ${company.website ? 
                                    `<a href="${company.website}" target="_blank" class="detail-text website-link">${company.website}</a>` :
                                    `<span class="detail-text">í™ˆí˜ì´ì§€ ë¯¸ì„¤ì •</span>`
                                }
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-calendar detail-icon"></i>
                                <span class="detail-text">ë“±ë¡ì¼: ${new Date(company.created_at).toLocaleDateString('ko-KR')}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-circle detail-icon"></i>
                                <span class="status-badge ${isActive ? 'status-active' : 'status-inactive'}">
                                    ${isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="company-actions">
                            <button onclick="manageCompany('${company.domain}')" class="btn btn-primary btn-sm">
                                <i class="fas fa-cog"></i> ê´€ë¦¬
                            </button>
                            <button onclick="viewCompanyHomepage('${company.domain}')" class="btn btn-secondary btn-sm">
                                <i class="fas fa-globe"></i> í™ˆí˜ì´ì§€
                            </button>
                            <button onclick="editCompany('${company.domain}')" class="btn btn-info btn-sm">
                                <i class="fas fa-edit"></i> ìˆ˜ì •
                            </button>
                            <button onclick="deleteCompany('${company.domain}', '${company.company_name}')" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // íšŒì‚¬ í•„í„° ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateCompanyFilterDropdown() {
            const companyFilterSelect = document.getElementById('companyFilterSelect');
            if (!companyFilterSelect) return;

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ "ëª¨ë“  íšŒì‚¬" ì˜µì…˜ ì œì™¸)
            while (companyFilterSelect.children.length > 1) {
                companyFilterSelect.removeChild(companyFilterSelect.lastChild);
            }

            // ì‹¤ì œ íšŒì‚¬ ë°ì´í„°ë¡œ ì˜µì…˜ ì¶”ê°€
            allCompanies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.domain || company.id;
                option.textContent = company.company_name || company.companyName;
                companyFilterSelect.appendChild(option);
            });
        }

        // ì‚¬ìš©ì ëª©ë¡ ë Œë”ë§
        function renderUsersList() {
            console.log('ğŸ“‹ renderUsersList í˜¸ì¶œë¨');
            console.log('ğŸ‘¥ allUsers ë°°ì—´:', allUsers);
            console.log('ğŸ‘¥ allUsers ê°œìˆ˜:', allUsers.length);
            
            const usersGrid = document.getElementById('usersList');
            if (!usersGrid) {
                console.error('âŒ usersList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }

            if (allUsers.length === 0) {
                console.log('âš ï¸ ì‚¬ìš©ìê°€ ì—†ìŒ');
                usersGrid.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // íšŒì‚¬ë³„ë¡œ ê·¸ë£¹í™” (ë§ˆìŠ¤í„° ê´€ë¦¬ì ì œì™¸)
            const usersByCompany = allUsers.reduce((acc, user) => {
                // ë§ˆìŠ¤í„° ê´€ë¦¬ìëŠ” íŠ¹ì • íšŒì‚¬ì— ì†í•˜ì§€ ì•ŠìŒ
                if (user.role === 'master' || user.role === 'super_admin') {
                    return acc;
                }
                
                const domain = user.company_domain || user.company_id || user.company || 'unknown';
                if (!acc[domain]) acc[domain] = [];
                acc[domain].push(user);
                return acc;
            }, {});
            
            // ë§ˆìŠ¤í„° ê´€ë¦¬ìëŠ” ë³„ë„ ì„¹ì…˜ì— í‘œì‹œ
            const masterUsers = allUsers.filter(user => user.role === 'master' || user.role === 'super_admin');
            if (masterUsers.length > 0) {
                usersByCompany['master'] = masterUsers;
            }
            
            console.log('ğŸ¢ íšŒì‚¬ë³„ ì‚¬ìš©ì ê·¸ë£¹:', usersByCompany);

            // íšŒì‚¬ë³„ ê·¸ë£¹ì´ ì—†ëŠ” ê²½ìš° ì „ì²´ ì‚¬ìš©ìë¥¼ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ í‘œì‹œ
            if (Object.keys(usersByCompany).length === 0) {
                usersByCompany['all'] = allUsers;
            }

            usersGrid.innerHTML = Object.entries(usersByCompany).map(([domain, users]) => {
                let sectionTitle = '';
                let sectionIcon = 'fas fa-building';
                
                if (domain === 'master') {
                    sectionTitle = 'ëŒ€í‘œì´ì‚¬';
                    sectionIcon = 'fas fa-crown';
                } else {
                    // domain, company_id, id ë“± ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ íšŒì‚¬ ì°¾ê¸°
                    const company = allCompanies.find(c => 
                        c.domain === domain || 
                        c.id === domain || 
                        c.company_id === domain
                    );
                    sectionTitle = company?.company_name || company?.name || domain;
                }
                
                console.log(`ğŸ¢ ë„ë©”ì¸ ${domain}ì— ëŒ€í•œ ì„¹ì…˜:`, sectionTitle);
                console.log(`ğŸ‘¥ í•´ë‹¹ ì„¹ì…˜ì˜ ì‚¬ìš©ìë“¤:`, users);
                
                return `
                    <div class="company-users-section" data-domain="${domain}">
                        <div class="company-section-header" onclick="toggleCompanyUsers('${domain}')">
                            <div class="company-section-title">
                                <i class="${sectionIcon}"></i>
                                ${sectionTitle}
                                <span class="user-count">${users.length}ëª…</span>
                            </div>
                            <i class="fas fa-chevron-down dropdown-icon"></i>
                        </div>
                        <div class="users-table-container">
                            <table class="users-table">
                                <thead>
                                    <tr>
                                        <th>ì´ë¦„</th>
                                        <th>ì—­í• </th>
                                        <th>ë¶€ì„œ/ì§ê¸‰</th>
                                        <th>ID/ì´ë©”ì¼</th>
                                        <th>ê°€ì…ì¼</th>
                                        <th>ê´€ë¦¬</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${users.map(user => `
                                        <tr class="user-row">
                                            <td class="user-name">
                                                <strong>${user.name || user.username || 'ì´ë¦„ ì—†ìŒ'}</strong>
                                            </td>
                                            <td>
                                                <span class="role-badge ${user.role}">${getRoleText(user.role)}</span>
                                            </td>
                                            <td>${user.department || 'ë¯¸ì§€ì •'} / ${user.position || 'ë¯¸ì§€ì •'}</td>
                                            <td class="user-contact">${user.username || user.email || user.id}</td>
                                            <td>${user.created_at ? new Date(user.created_at).toLocaleDateString('ko-KR') : 'ì •ë³´ ì—†ìŒ'}</td>
                                            <td class="user-actions-cell">
                                                <div class="user-actions">
                                                    ${user.role === 'company_admin' || user.role === 'admin' ? `
                                                        <button onclick="changeUserToCEO('${user.id}')" class="btn btn-warning btn-sm" title="ëŒ€í‘œì´ì‚¬ë¡œ ë³€ê²½">
                                                            <i class="fas fa-crown"></i>
                                                        </button>
                                                    ` : ''}
                                                    <button onclick="editUser('${user.id}')" class="btn btn-info btn-sm" title="ìˆ˜ì •">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="resetUserPassword('${user.id}')" class="btn btn-secondary btn-sm" title="ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”">
                                                        <i class="fas fa-key"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // íšŒì‚¬ë³„ ì‚¬ìš©ì ëª©ë¡ í† ê¸€ í•¨ìˆ˜
        function toggleCompanyUsers(domain) {
            console.log('ğŸ”„ í† ê¸€ ë„ë©”ì¸:', domain);
            
            const section = document.querySelector(`[data-domain="${domain}"]`);
            if (!section) {
                console.error('âŒ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', domain);
                return;
            }
            
            const isExpanded = section.classList.contains('expanded');
            
            if (isExpanded) {
                // ì ‘ê¸°
                section.classList.remove('expanded');
                console.log('ğŸ“ ì„¹ì…˜ ì ‘ê¸°:', domain);
            } else {
                // í¼ì¹˜ê¸°
                section.classList.add('expanded');
                console.log('ğŸ“‚ ì„¹ì…˜ í¼ì¹˜ê¸°:', domain);
            }
        }

        // ëª¨ë“  íšŒì‚¬ ì„¹ì…˜ í¼ì¹˜ê¸°/ì ‘ê¸°
        function toggleAllCompanySections(expand = null) {
            const sections = document.querySelectorAll('.company-users-section');
            
            sections.forEach(section => {
                if (expand === true || (expand === null && !section.classList.contains('expanded'))) {
                    section.classList.add('expanded');
                } else {
                    section.classList.remove('expanded');
                }
            });
        }

        // ê¶Œí•œ ê´€ë¦¬ ë Œë”ë§
        function renderPermissionsList() {
            const permissionsContainer = document.querySelector('#permissions-tab .permissions-content');
            if (!permissionsContainer) return;

            // íšŒì‚¬ë³„ ê¶Œí•œ í†µê³„
            const companyPermissions = allCompanies.map(company => {
                const companyUsers = allUsers.filter(u => u.company_domain === company.domain);
                const adminCount = companyUsers.filter(u => u.role === 'company_admin').length;
                const managerCount = companyUsers.filter(u => u.role === 'company_manager').length;
                const employeeCount = companyUsers.filter(u => u.role === 'employee').length;

                return {
                    company,
                    adminCount,
                    managerCount,
                    employeeCount,
                    totalUsers: companyUsers.length
                };
            });

            permissionsContainer.innerHTML = `
                <div class="permissions-overview">
                    <h3>ê¶Œí•œ í˜„í™©</h3>
                    <div class="permissions-stats">
                        <div class="permission-stat">
                            <div class="stat-icon admin">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="stat-info">
                                <h4>ê´€ë¦¬ì</h4>
                                <p>${allUsers.filter(u => u.role === 'company_admin').length}ëª…</p>
                            </div>
                        </div>
                        <div class="permission-stat">
                            <div class="stat-icon manager">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-info">
                                <h4>ë§¤ë‹ˆì €</h4>
                                <p>${allUsers.filter(u => u.role === 'company_manager').length}ëª…</p>
                            </div>
                        </div>
                        <div class="permission-stat">
                            <div class="stat-icon employee">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="stat-info">
                                <h4>ì§ì›</h4>
                                <p>${allUsers.filter(u => u.role === 'employee').length}ëª…</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="company-permissions">
                    <h3>íšŒì‚¬ë³„ ê¶Œí•œ ë¶„í¬</h3>
                    ${companyPermissions.map(cp => `
                        <div class="company-permission-card">
                            <h4>${cp.company.company_name}</h4>
                            <div class="permission-breakdown">
                                <div class="permission-item">
                                    <span class="role-badge admin">ê´€ë¦¬ì</span>
                                    <span class="count">${cp.adminCount}ëª…</span>
                                </div>
                                <div class="permission-item">
                                    <span class="role-badge manager">ë§¤ë‹ˆì €</span>
                                    <span class="count">${cp.managerCount}ëª…</span>
                                </div>
                                <div class="permission-item">
                                    <span class="role-badge employee">ì§ì›</span>
                                    <span class="count">${cp.employeeCount}ëª…</span>
                                </div>
                            </div>
                            <div class="permission-actions">
                                <button onclick="manageCompanyPermissions('${cp.company.domain}')" class="btn btn-primary btn-sm">
                                    <i class="fas fa-cog"></i> ê¶Œí•œ ê´€ë¦¬
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ì‹œìŠ¤í…œ ê´€ë¦¬ ë Œë”ë§
        function renderSystemSettings() {
            const systemContainer = document.querySelector('#system-tab .system-content');
            if (!systemContainer) return;

            systemContainer.innerHTML = `
                <div class="system-overview">
                    <h3>ì‹œìŠ¤í…œ í˜„í™©</h3>
                    <div class="system-stats-grid">
                        <div class="system-stat-card">
                            <i class="fas fa-database"></i>
                            <h4>ë°ì´í„°ë² ì´ìŠ¤</h4>
                            <p class="status-text ${db && db.client ? 'connected' : 'disconnected'}">
                                ${db && db.client ? 'ì—°ê²°ë¨' : 'ì˜¤í”„ë¼ì¸'}
                            </p>
                        </div>
                        <div class="system-stat-card">
                            <i class="fas fa-server"></i>
                            <h4>ì„œë²„ ìƒíƒœ</h4>
                            <p class="status-text connected">ì •ìƒ</p>
                        </div>
                        <div class="system-stat-card">
                            <i class="fas fa-clock"></i>
                            <h4>ë§ˆì§€ë§‰ ë°±ì—…</h4>
                            <p class="status-text">${getLastBackupTime()}</p>
                        </div>
                    </div>
                </div>

                <div class="system-actions">
                    <h3>ì‹œìŠ¤í…œ ê´€ë¦¬</h3>
                    <div class="action-buttons">
                        <button onclick="backupDatabase()" class="btn btn-primary">
                            <i class="fas fa-download"></i> ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
                        </button>
                        <button onclick="clearCache()" class="btn btn-secondary">
                            <i class="fas fa-trash"></i> ìºì‹œ ì •ë¦¬
                        </button>
                        <button onclick="exportSystemLogs()" class="btn btn-info">
                            <i class="fas fa-file-download"></i> ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸°
                        </button>
                        <button onclick="showSystemSettings()" class="btn btn-warning">
                            <i class="fas fa-cog"></i> ê³ ê¸‰ ì„¤ì •
                        </button>
                    </div>
                </div>

                <div class="recent-activities">
                    <h3>ìµœê·¼ í™œë™</h3>
                    <div class="activity-list">
                        <div class="activity-item">
                            <i class="fas fa-user-plus"></i>
                            <span>ìƒˆ ì‚¬ìš©ì ë“±ë¡: ${allUsers.length > 0 ? allUsers[0].name : 'ì—†ìŒ'}</span>
                            <time>${allUsers.length > 0 ? new Date(allUsers[0].created_at).toLocaleDateString('ko-KR') : ''}</time>
                        </div>
                        <div class="activity-item">
                            <i class="fas fa-building"></i>
                            <span>ìƒˆ íšŒì‚¬ ë“±ë¡: ${allCompanies.length > 0 ? allCompanies[0].company_name : 'ì—†ìŒ'}</span>
                            <time>${allCompanies.length > 0 ? new Date(allCompanies[0].created_at).toLocaleDateString('ko-KR') : ''}</time>
                        </div>
                    </div>
                </div>
            `;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getRoleText(role) {
            const roleMap = {
                'master': 'ë§ˆìŠ¤í„° ê´€ë¦¬ì',
                'company_admin': 'íšŒì‚¬ ê´€ë¦¬ì',
                'company_manager': 'ë§¤ë‹ˆì €',
                'employee': 'ì§ì›'
            };
            return roleMap[role] || role;
        }
        
        function getTierDisplayName(tier) {
            const tierMap = {
                'basic': 'Basic',
                'standard': 'Standard',
                'premium': 'Premium',
                'enterprise': 'Enterprise'
            };
            return tierMap[tier] || 'Basic';
        }

        // ì‚¬ìš©ìë¥¼ ëŒ€í‘œì´ì‚¬ë¡œ ë³€ê²½
        async function changeUserToCEO(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìë¥¼ ëŒ€í‘œì´ì‚¬ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                if (db && db.client) {
                    const { data, error } = await db.client
                        .from('users')
                        .update({ 
                            role: 'company_admin',
                            position: 'ëŒ€í‘œì´ì‚¬'
                        })
                        .eq('id', userId);

                    if (error) throw error;
                    
                    alert('ì‚¬ìš©ìê°€ ëŒ€í‘œì´ì‚¬ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadDashboardData();
                    renderUsersList();
                } else {
                    // ì˜¤í”„ë¼ì¸ ëª¨ë“œ
                    const userIndex = allUsers.findIndex(u => u.id == userId);
                    if (userIndex !== -1) {
                        allUsers[userIndex].role = 'company_admin';
                        allUsers[userIndex].position = 'ëŒ€í‘œì´ì‚¬';
                        localStorage.setItem('users', JSON.stringify(allUsers));
                        renderUsersList();
                    }
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì˜¤ë¥˜:', error);
                alert('ê¶Œí•œ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // íšŒì‚¬ ê´€ë¦¬ í•¨ìˆ˜
        function manageCompany(domain) {
            const company = allCompanies.find(c => c.domain === domain);
            if (!company) {
                alert('íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë¡œì»¬ ì§ì› ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (íšŒì‚¬ ë„ë©”ì¸ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬)
            window.location.href = `employee-dashboard.html?company=${domain}`;
        }

        // íšŒì‚¬ í™ˆí˜ì´ì§€ ë³´ê¸° í•¨ìˆ˜
        function viewCompanyHomepage(domain) {
            const company = allCompanies.find(c => c.domain === domain);
            if (!company || !company.website) {
                alert('ë¨¼ì € íšŒì‚¬ì˜ í™ˆí˜ì´ì§€ ì£¼ì†Œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                editCompany(domain);
                return;
            }
            
            let websiteUrl = company.website;
            if (!websiteUrl.startsWith('http://') && !websiteUrl.startsWith('https://')) {
                websiteUrl = 'https://' + websiteUrl;
            }
            
            window.open(websiteUrl, '_blank');
        }

        // íšŒì‚¬ ì‚­ì œ í•¨ìˆ˜
        async function deleteCompany(domain, companyName) {
            // ì‚­ì œ í™•ì¸
            const confirmMessage = `ì •ë§ë¡œ "${companyName}" íšŒì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ë‹¤ìŒ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤:\n- íšŒì‚¬ ì •ë³´\n- ëª¨ë“  ì§ì› ê³„ì •\n- ì—…ë¬´ì¼ì§€ ë° ë¬¸ì„œ\n- ë²•ì¸ì¹´ë“œ ì‚¬ìš©ë‚´ì—­\n- ê¸°íƒ€ ê´€ë ¨ ë°ì´í„°\n\nì‚­ì œí•˜ë ¤ë©´ '${companyName}'ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`;
            
            const userInput = prompt(confirmMessage);
            if (userInput !== companyName) {
                if (userInput !== null) {
                    alert('íšŒì‚¬ëª…ì´ ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                return;
            }

            try {
                // ë¡œë”© í‘œì‹œ
                const deleteBtn = event.target.closest('button');
                const originalText = deleteBtn.innerHTML;
                deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì‚­ì œ ì¤‘...';
                deleteBtn.disabled = true;

                if (db && db.client) {
                    // Supabaseì—ì„œ íšŒì‚¬ ì‚­ì œ (CASCADEë¡œ ê´€ë ¨ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë¨)
                    const { error } = await db.client
                        .from('companies')
                        .delete()
                        .eq('domain', domain);

                    if (error) throw error;
                } else {
                    // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ íšŒì‚¬ ì‚­ì œ
                    const companyIndex = allCompanies.findIndex(c => c.domain === domain);
                    if (companyIndex !== -1) {
                        allCompanies.splice(companyIndex, 1);
                        localStorage.setItem('companies', JSON.stringify(allCompanies));
                    }

                    // ê´€ë ¨ëœ ì‚¬ìš©ì ë°ì´í„°ë„ ì‚­ì œ
                    const usersToDelete = allUsers.filter(u => u.company_domain === domain);
                    allUsers = allUsers.filter(u => u.company_domain !== domain);
                    localStorage.setItem('users', JSON.stringify(allUsers));

                    // ê´€ë ¨ëœ ë¡œì»¬ ì €ì¥ì†Œ ë°ì´í„° ì‚­ì œ
                    for (let i = localStorage.length - 1; i >= 0; i--) {
                        const key = localStorage.key(i);
                        if (key && (
                            key.includes(domain) || 
                            key.includes(`_${domain}_`) ||
                            usersToDelete.some(user => key.includes(`_user_${user.id}`))
                        )) {
                            localStorage.removeItem(key);
                        }
                    }
                }

                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                await loadDashboardData();
                updateStatistics();
                renderCompaniesList();
                renderUsersList();

                alert(`"${companyName}" íšŒì‚¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);

            } catch (error) {
                console.error('íšŒì‚¬ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('íšŒì‚¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                // ë²„íŠ¼ ë³µì›
                if (deleteBtn) {
                    deleteBtn.innerHTML = originalText;
                    deleteBtn.disabled = false;
                }
            }
        }

        // íšŒì‚¬ í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
        function editCompany(domain) {
            const company = allCompanies.find(c => c.domain === domain);
            if (!company) {
                alert('íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            console.log('ğŸ“ editCompany - íšŒì‚¬ ì •ë³´:', company);
            console.log('ğŸ“‹ tenant_settings:', company.tenant_settings);

            // tenant_settingsì—ì„œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const settings = company.tenant_settings || {};

            // ê¸°ì¡´ ëª¨ë‹¬ì— í˜„ì¬ íšŒì‚¬ ì •ë³´ ì±„ìš°ê¸° (domainì„ ì‹ë³„ìë¡œ ì‚¬ìš©)
            document.getElementById('editCompanyId').value = domain;
            document.getElementById('editCompanyName').value = company.company_name || '';
            document.getElementById('editBusinessNumber').value = company.business_number || '';
            
            // tenant_settingsì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•„ë“œë“¤
            document.getElementById('editCorporateNumber').value = settings.corporate_number || '';
            document.getElementById('editRepresentative').value = settings.representative || '';
            document.getElementById('editOpeningDate').value = settings.opening_date || '';
            document.getElementById('editBusinessType').value = settings.business_type || '';
            
            // ê¸°ë³¸ í•„ë“œë“¤
            document.getElementById('editBusinessAddress').value = company.address || '';
            document.getElementById('editWebsiteUrl').value = company.website || '';
            document.getElementById('editCompanyEmail').value = company.email || '';

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('editCompanyModal').style.display = 'flex';
        }

        // íšŒì‚¬ í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        function hideEditCompanyModal() {
            document.getElementById('editCompanyModal').style.display = 'none';
        }

        // íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì²˜ë¦¬
        async function handleEditCompany(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const companyId = formData.get('editCompanyId');
            
            const updateData = {
                company_name: formData.get('editCompanyName').trim(),
                business_number: formData.get('editBusinessNumber').trim(),
                corporate_number: formData.get('editCorporateNumber').trim(),
                representative: formData.get('editRepresentative').trim(),
                opening_date: formData.get('editOpeningDate'),
                address: formData.get('editBusinessAddress').trim(),
                business_type: formData.get('editBusinessType').trim(),
                website: formData.get('editWebsiteUrl').trim(),
                email: formData.get('editCompanyEmail').trim()
            };

            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (!updateData.company_name) {
                alert('ë²•ì¸ëª…(ë‹¨ì²´ëª…)ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            if (!updateData.business_number) {
                alert('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            if (!updateData.representative) {
                alert('ëŒ€í‘œìëª…ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }

            try {
                // domainìœ¼ë¡œ íšŒì‚¬ ì°¾ê¸°
                const companyIndex = allCompanies.findIndex(c => c.domain === companyId);
                
                if (companyIndex !== -1) {
                    companies[companyIndex] = { ...companies[companyIndex], ...updateData };
                    localStorage.setItem('companies', JSON.stringify(companies));
                    
                    // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                    allCompanies = companies;
                    
                    // UI ì—…ë°ì´íŠ¸
                    renderCompaniesList();
                    updateCompanyFilterDropdown();
                    updateStatistics();
                    
                    // ëª¨ë‹¬ ë‹«ê¸°
                    hideEditCompanyModal();
                    
                    alert('íšŒì‚¬ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì˜¤ë¥˜:', error);
                alert('íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function addNewCompany() {
            const companyName = prompt('ìƒˆ íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!companyName) return;

            const domain = prompt('íšŒì‚¬ ë„ë©”ì¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: company.com):');
            if (!domain) return;

            const website = prompt('íšŒì‚¬ í™ˆí˜ì´ì§€ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”:\n(ì˜ˆ: https://consil800.com ë˜ëŠ” consil800.com)', '');
            // websiteê°€ nullì´ë©´ ì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥¸ ê²ƒ
            if (website === null) return;

            try {
                const result = await domainManager.registerCompany({
                    companyName,
                    domain,
                    website,
                    adminData: {
                        username: 'admin',
                        password: 'admin123',
                        name: 'ê´€ë¦¬ì'
                    }
                });

                if (result.success) {
                    alert('ìƒˆ íšŒì‚¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadDashboardData();
                    updateStatistics();
                    renderCompaniesList();
                } else {
                    alert('íšŒì‚¬ ë“±ë¡ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                console.error('íšŒì‚¬ ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('íšŒì‚¬ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function editUser(userId) {
            const user = allUsers.find(u => u.id == userId);
            if (!user) return;

            const newName = prompt('ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', user.name);
            if (!newName) return;

            try {
                if (db && db.client) {
                    const { error } = await db.client
                        .from('users')
                        .update({ name: newName })
                        .eq('id', userId);

                    if (error) throw error;
                    await loadDashboardData();
                    renderUsersList();
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    const userIndex = allUsers.findIndex(u => u.id == userId);
                    if (userIndex !== -1) {
                        allUsers[userIndex].name = newName;
                        localStorage.setItem('users', JSON.stringify(allUsers));
                        renderUsersList();
                        alert('ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function resetUserPassword(userId) {
            if (!confirm('ì´ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const newPassword = 'reset123';

            try {
                if (db && db.client) {
                    const { error } = await db.client
                        .from('users')
                        .update({ password: newPassword })
                        .eq('id', userId);

                    if (error) throw error;
                    alert(`ë¹„ë°€ë²ˆí˜¸ê°€ "${newPassword}"ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    const userIndex = allUsers.findIndex(u => u.id == userId);
                    if (userIndex !== -1) {
                        allUsers[userIndex].password = newPassword;
                        localStorage.setItem('users', JSON.stringify(allUsers));
                        alert(`ë¹„ë°€ë²ˆí˜¸ê°€ "${newPassword}"ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    }
                }
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function manageCompanyPermissions(domain) {
            alert(`${domain} íšŒì‚¬ì˜ ê¶Œí•œì„ ê´€ë¦¬í•©ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)`);
        }

        function backupDatabase() {
            alert('ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)');
        }

        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            alert('ìºì‹œê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function exportSystemLogs() {
            alert('ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)');
        }

        function showSystemSettings() {
            alert('ê³ ê¸‰ ì„¤ì • í™”ë©´ì…ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)');
        }

        function showAddCompanyModal() {
            addNewCompany();
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userRole');
                sessionStorage.clear();
                window.location.href = 'index.html';
            }
        }

        function viewCompanyDashboard(companyId) {
            console.log('Viewing company dashboard:', companyId);
            window.location.href = `../3-company-dashboards/${companyId}/admin/index.html`;
        }



        // ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜
        function editUser(userId) {
            console.log('Editing user:', userId);
            console.log('allUsers ë°°ì—´:', allUsers);
            console.log('ì°¾ëŠ” ì‚¬ìš©ì ID:', userId, typeof userId);
            
            // allUsers ë°°ì—´ì—ì„œ ì‚¬ìš©ì ì°¾ê¸° (ë¬¸ìì—´ ë° ìˆ«ì ë¹„êµ ëª¨ë‘ ì‹œë„)
            const user = allUsers.find(u => {
                console.log(`ë¹„êµ: ${u.id} (${typeof u.id}) === ${userId} (${typeof userId})`);
                return String(u.id) === String(userId) || u.id === userId;
            });
            
            console.log('ì°¾ì€ ì‚¬ìš©ì:', user);
            
            if (!user) {
                console.error('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. allUsers:', allUsers);
                alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ì— í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
            const editUserIdEl = document.getElementById('editUserId');
            const editUserNameEl = document.getElementById('editUserName');
            const editUserPhoneEl = document.getElementById('editUserPhone');
            const editUserDepartmentEl = document.getElementById('editUserDepartment');
            const editUserEmailEl = document.getElementById('editUserEmail');
            
            console.log('ğŸ” ëª¨ë‹¬ ìš”ì†Œë“¤ í™•ì¸:', {
                editUserId: editUserIdEl,
                editUserName: editUserNameEl,
                editUserPhone: editUserPhoneEl,
                editUserDepartment: editUserDepartmentEl,
                editUserEmail: editUserEmailEl
            });
            
            if (!editUserIdEl || !editUserNameEl || !editUserPhoneEl || !editUserDepartmentEl || !editUserEmailEl) {
                console.error('âŒ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                alert('í¸ì§‘ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            editUserIdEl.value = user.id;
            editUserNameEl.value = user.name || user.username || '';
            editUserPhoneEl.value = user.phone || '';
            editUserDepartmentEl.value = user.department || '';
            // ì´ë©”ì¼ì€ usernameì— @ í¬í•¨ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •, ì—†ìœ¼ë©´ ë¹ˆê°’
            editUserEmailEl.value = user.email || (user.username && user.username.includes('@') ? user.username : '');
            
            console.log('âœ… ëª¨ë‹¬ì— ì‚¬ìš©ì ì •ë³´ ì„¤ì • ì™„ë£Œ:', {
                id: editUserIdEl.value,
                name: editUserNameEl.value,
                phone: editUserPhoneEl.value,
                department: editUserDepartmentEl.value,
                email: editUserEmailEl.value
            });
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('editUserModal').style.display = 'flex';
        }

        // ì‚¬ìš©ì í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        function hideEditUserModal() {
            const modal = document.getElementById('editUserModal');
            modal.style.display = 'none';
            
            // ë°ì´í„° ì†ì„± ì •ë¦¬
            modal.removeAttribute('data-company-id');
            modal.removeAttribute('data-representative-key');
        }

        // ì‚¬ìš©ì í¸ì§‘ í¼ ì²˜ë¦¬
        async function handleEditUser(event) {
            event.preventDefault();
            console.log('ğŸ”¥ğŸ”¥ğŸ”¥ handleEditUser í•¨ìˆ˜ ì‹¤í–‰ë¨!');
            
            // í¼ ë°ì´í„° ì§ì ‘ ê°€ì ¸ì˜¤ê¸° (ë” ì•ˆì „í•œ ë°©ë²•)
            const form = event.target;
            const userId = form.querySelector('#editUserId').value;
            const newName = form.querySelector('#editUserName').value.trim();
            const newPhone = form.querySelector('#editUserPhone').value.trim();
            const newDepartment = form.querySelector('#editUserDepartment').value.trim();
            const newEmail = form.querySelector('#editUserEmail').value.trim();
            
            console.log('ğŸ“ í¼ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°:', { userId, newName, newPhone, newDepartment, newEmail });
            
            // FormDataë¡œë„ í™•ì¸ (ë””ë²„ê¹…ìš©)
            const formData = new FormData(event.target);
            console.log('ğŸ“‹ FormData ê²€ì¦:', {
                userId: formData.get('editUserId'),
                name: formData.get('editUserName'),
                phone: formData.get('editUserPhone'),
                department: formData.get('editUserDepartment'),
                email: formData.get('editUserEmail')
            });
            
            if (!newName) {
                alert('ì´ë¦„ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ì—ì„œ íšŒì‚¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const modal = document.getElementById('editUserModal');
            const companyId = modal.getAttribute('data-company-id');
            const representativeKey = modal.getAttribute('data-representative-key');
            
            console.log('ğŸ¢ íšŒì‚¬ ì •ë³´:', { companyId, representativeKey });
            
            // íšŒì‚¬ ëŒ€í‘œ í¸ì§‘ ì²˜ë¦¬
            if (companyId && representativeKey) {
                console.log('âœ… íšŒì‚¬ ëŒ€í‘œ í¸ì§‘ í™•ì¸ë¨');
                
                const representative = JSON.parse(localStorage.getItem(representativeKey) || 'null');
                console.log('ğŸ“‹ ê¸°ì¡´ ëŒ€í‘œ ì •ë³´:', representative);
                
                if (!representative) {
                    alert('ëŒ€í‘œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ëŒ€í‘œ ì •ë³´ ì—…ë°ì´íŠ¸
                const updatedRepresentative = {
                    ...representative,
                    name: newName,
                    phone: newPhone,
                    email: newEmail,
                    updatedAt: new Date().toISOString()
                };
                
                console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„°:', updatedRepresentative);
                console.log('ğŸ”‘ ì €ì¥í•  í‚¤:', representativeKey);
                
                // ì €ì¥ ì „ ê¸°ì¡´ ë°ì´í„° ë°±ì—…
                const backupKey = representativeKey + '_backup';
                localStorage.setItem(backupKey, JSON.stringify(representative));
                
                // ë©”ì¸ ë°ì´í„° ì €ì¥
                localStorage.setItem(representativeKey, JSON.stringify(updatedRepresentative));
                
                // ì¦‰ì‹œ í™•ì¸
                const check = JSON.parse(localStorage.getItem(representativeKey));
                console.log('âœ… ì €ì¥ í™•ì¸:', check);
                
                if (check && check.name === newName && check.phone === newPhone && check.email === newEmail) {
                    console.log('âœ… ë°ì´í„° ì €ì¥ ì„±ê³µ í™•ì¸ë¨');
                    
                    // ëª¨ë‹¬ ë‹«ê¸°
                    hideEditUserModal();
                    
                    // ì•½ê°„ì˜ ì§€ì—° í›„ ë Œë”ë§ (localStorage ë°˜ì˜ ì‹œê°„ í™•ë³´)
                    console.log('ğŸ”„ í¸ì§‘ ì™„ë£Œ í›„ ë Œë”ë§ ì‹œì‘');
                    setTimeout(() => {
                        renderUsersList();
                        console.log('ğŸ‰ í¸ì§‘ ì™„ë£Œ ë° ë Œë”ë§ ì™„ë£Œ!');
                    }, 150);
                    
                } else {
                    console.log('âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨ - ë°±ì—…ì—ì„œ ë³µì›');
                    localStorage.setItem(representativeKey, localStorage.getItem(backupKey));
                    alert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
                
                return;
            }
            
            // ì¼ë°˜ ì‚¬ìš©ì í¸ì§‘ ì²˜ë¦¬ (ë°ì´í„°ë² ì´ìŠ¤)
            console.log('ğŸ“ ì¼ë°˜ ì‚¬ìš©ì í¸ì§‘ ì²˜ë¦¬ ì‹œì‘');
            
            // allUsers ë°°ì—´ì—ì„œ ì‚¬ìš©ì ì°¾ê¸°
            const userIndex = allUsers.findIndex(u => String(u.id) === String(userId));
            
            if (userIndex === -1) {
                console.error('âŒ allUsersì—ì„œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', userId);
                alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const user = allUsers[userIndex];
            console.log('âœ… í¸ì§‘í•  ì‚¬ìš©ì ì°¾ìŒ:', user);
            
            // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
            const updatedUser = {
                ...user,
                name: newName,
                phone: newPhone || user.phone,
                department: newDepartment || user.department,
                email: newEmail || user.email,
                updated_at: new Date().toISOString()
            };
            
            console.log('ğŸ’¾ ì—…ë°ì´íŠ¸í•  ì‚¬ìš©ì ë°ì´í„°:', updatedUser);
            
            // allUsers ë°°ì—´ ì—…ë°ì´íŠ¸
            allUsers[userIndex] = updatedUser;
            
            // ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹œë„
            if (typeof db !== 'undefined' && db.updateUser) {
                console.log('ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹œë„');
                
                try {
                    const updateData = {
                        name: newName,
                        updated_at: new Date().toISOString()
                    };
                    
                    // departmentëŠ” users í…Œì´ë¸”ì— ìˆëŠ” ì»¬ëŸ¼ì´ë¯€ë¡œ í¬í•¨
                    if (newDepartment !== undefined) {
                        updateData.department = newDepartment;
                    }
                    
                    // phoneê³¼ email ì»¬ëŸ¼ì´ ì´ì œ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ í¬í•¨
                    if (newPhone !== undefined) {
                        updateData.phone = newPhone;
                    }
                    
                    if (newEmail !== undefined) {
                        updateData.email = newEmail;
                    }
                    
                    const result = await db.updateUser(userId, updateData);
                    
                    if (result.success) {
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì„±ê³µ');
                        
                        // ëª¨ë‹¬ ë‹«ê¸°
                        hideEditUserModal();
                        
                        // ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => {
                            renderUsersList();
                            console.log('ğŸ‰ ì‚¬ìš©ì í¸ì§‘ ì™„ë£Œ!');
                        }, 150);
                    } else {
                        console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', result.error);
                        // ë°°ì—´ ë¡¤ë°±
                        allUsers[userIndex] = user;
                        alert('ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
                    }
                } catch (error) {
                    console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                    // ë°°ì—´ ë¡¤ë°±
                    allUsers[userIndex] = user;
                    alert('ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } else {
                console.error('âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì—†ìŒ');
                alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì‚­ì œ ì²˜ë¦¬
        async function handleDeleteUser() {
            const userId = document.getElementById('editUserId').value;
            const userName = document.getElementById('editUserName').value;
            
            // ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
            const confirmDelete = confirm(`ì •ë§ë¡œ '${userName}' ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            
            if (!confirmDelete) {
                return;
            }
            
            console.log('ğŸ—‘ï¸ ì‚¬ìš©ì ì‚­ì œ ì‹œì‘:', userId, userName);
            
            try {
                // allUsers ë°°ì—´ì—ì„œ ì‚¬ìš©ì ì°¾ê¸°
                const userIndex = allUsers.findIndex(u => String(u.id) === String(userId));
                
                if (userIndex === -1) {
                    console.error('âŒ allUsersì—ì„œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', userId);
                    alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const user = allUsers[userIndex];
                console.log('âœ… ì‚­ì œí•  ì‚¬ìš©ì ì°¾ìŒ:', user);
                
                // ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ì‹œë„
                if (typeof db !== 'undefined' && db.deleteUser) {
                    console.log('ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì‹œë„');
                    
                    const result = await db.deleteUser(userId);
                    
                    if (result.success) {
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì„±ê³µ');
                        
                        // allUsers ë°°ì—´ì—ì„œ ì œê±°
                        allUsers.splice(userIndex, 1);
                        
                        // ëª¨ë‹¬ ë‹«ê¸°
                        hideEditUserModal();
                        
                        // ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => {
                            renderUsersList();
                            console.log('ğŸ‰ ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ!');
                            alert('ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }, 150);
                    } else {
                        console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ì‹¤íŒ¨:', result.error);
                        alert('ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.error);
                    }
                } else {
                    console.error('âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì—†ìŒ');
                    alert('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function viewUserActivity(userId) {
            console.log('Viewing user activity:', userId);
            
            const users = JSON.parse(localStorage.getItem('platform_users') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                showNotification('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ê°„ë‹¨í•œ í™œë™ ë‚´ì—­ í‘œì‹œ
            const activity = [
                'ë¡œê·¸ì¸: 2024-06-12 09:00',
                'í™ˆí˜ì´ì§€ ìˆ˜ì •: 2024-06-11 14:30',
                'ì§ì› ì¶”ê°€: 2024-06-10 16:45'
            ];
            
            alert(`${user.name}ì˜ ìµœê·¼ í™œë™:\n\n${activity.join('\n')}`);
        }

        // [ì‚­ì œë¨ - ì¤‘ë³µ renderUsersList í•¨ìˆ˜]
        /* êµ¬ë²„ì „ renderUsersList ì‚­ì œ ì‹œì‘
        function renderUsersList() {
            console.log('ğŸ”„ ì‚¬ìš©ì ëª©ë¡ ë Œë”ë§ ì‹œì‘');
            
            // ê°•ì œë¡œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            const usersList = document.getElementById('usersList');
            
            if (!usersList) {
                console.log('âŒ usersList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            if (companies.length === 0) {
                usersList.innerHTML = '<p style="text-align: center; color: #9ca3af;">ë“±ë¡ëœ íšŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ëŒ€í‘œ ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ ìƒì„± (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
            console.log('ğŸ”§ ì‚¬ìš©ì ëª©ë¡ ë Œë”ë§ - ëŒ€í‘œ ë°ì´í„° í™•ì¸ ë° í•„ìš”ì‹œ ìƒì„±');
            ensureRepresentativesExistOnce();
            
            // ê° íšŒì‚¬ì˜ ëŒ€í‘œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë³„ë„ ì €ì¥ëœ ëŒ€í‘œ ë°ì´í„° ì‚¬ìš©)
            const representativeUsers = [];
            
            console.log('ğŸ¢ ë“±ë¡ëœ íšŒì‚¬ ëª©ë¡:', companies.map(c => c.companyName));
            
            companies.forEach(company => {
                const representativeKey = `company_${company.id}_representative`;
                // ê°•ì œë¡œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë‹¤ì‹œ localStorageì—ì„œ ì½ê¸°
                const representative = JSON.parse(localStorage.getItem(representativeKey) || 'null');
                
                console.log(`ğŸ“Š ${company.companyName} (${company.id}) ëŒ€í‘œ:`, representative?.name || 'ì—†ìŒ');
                console.log(`ğŸ”‘ ì €ì¥ í‚¤: ${representativeKey}`);
                console.log(`ğŸ“ ëŒ€í‘œ ì „ì²´ ì •ë³´:`, representative);
                
                if (representative) {
                    representativeUsers.push({
                        ...representative,
                        companyName: company.companyName,
                        companyId: company.id
                    });
                    console.log(`âœ… ${company.companyName} ëŒ€í‘œ ì¶”ê°€ë¨: ${representative.name} (${representative.phone || 'ì—°ë½ì²˜ ì—†ìŒ'}) (${representative.email || 'ì´ë©”ì¼ ì—†ìŒ'})`);
                } else {
                    console.log(`âŒ ${company.companyName}ì— ëŒ€í‘œê°€ ì—†ìŠµë‹ˆë‹¤`);
                }
            });
            
            console.log('ğŸ‘¥ ëŒ€í‘œ ì‚¬ìš©ì ëª©ë¡:', representativeUsers);
            
            if (representativeUsers.length === 0) {
                usersList.innerHTML = '<p style="text-align: center; color: #9ca3af;">ë“±ë¡ëœ ëŒ€í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
                
                // ì¦‰ì‹œ ëŒ€í‘œ ë°ì´í„° ìƒì„± ì‹œë„ (ìë™ ì¬ì‹œë„ ì œê±°)
                console.log('ğŸ”„ ëŒ€í‘œ ë°ì´í„° ì¦‰ì‹œ ìƒì„± ì‹œë„');
                ensureCompanyRepresentativesExist();
                ensureRepresentativesExistOnce();
                // ìë™ ì¬ì‹œë„ ì œê±° - ì‚¬ìš©ìê°€ ì§ì ‘ íƒ­ì„ ë‹¤ì‹œ í´ë¦­í•˜ë„ë¡ ì•ˆë‚´
                return;
            }
            
            const htmlContent = representativeUsers.map(user => `
                <div class="company-item">
                    <div class="company-info">
                        <h3>${user.name} (${user.position || 'ëŒ€í‘œì´ì‚¬'})</h3>
                        <p>${user.companyName} | ${user.email || 'ì´ë©”ì¼ ì—†ìŒ'} | íšŒì‚¬ ëŒ€í‘œ</p>
                        <p>ì—°ë½ì²˜: ${user.phone || 'ë¯¸ì„¤ì •'} | ë¶€ì„œ: ${user.department || 'ê²½ì˜ì§„'}</p>
                    </div>
                    <div class="company-actions">
                        <button class="btn btn-primary" onclick="editCompanyRepresentative('${user.companyId}', '${user.id}')">
                            <i class="fas fa-edit"></i> í¸ì§‘
                        </button>
                    </div>
                </div>
            `).join('');
            
            // ì¦‰ì‹œ DOM ì—…ë°ì´íŠ¸
            usersList.innerHTML = htmlContent;
            console.log('âœ… ì‚¬ìš©ì ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
            console.log('ğŸ¨ ë Œë”ë§ëœ HTML:', htmlContent.substring(0, 200) + '...');
            
            // ê°•ì œë¡œ ë¸Œë¼ìš°ì € ë¦¬í”Œë¡œìš° ë°œìƒ
            usersList.offsetHeight;
        }
        êµ¬ë²„ì „ renderUsersList ì‚­ì œ ë */
        
        // ë””ë²„ê¹… ë° ë¬¸ì œ í•´ê²° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        window.debugEditFunction = function() {
            console.log('ğŸ”§ í¸ì§‘ ê¸°ëŠ¥ ë””ë²„ê¹… ì •ë³´');
            
            // ëª¨ë‹¬ ìƒíƒœ í™•ì¸
            const modal = document.getElementById('editUserModal');
            console.log('ğŸ“Š ëª¨ë‹¬ ìƒíƒœ:', {
                ì¡´ì¬í•¨: !!modal,
                í‘œì‹œë¨: modal?.style.display,
                companyId: modal?.getAttribute('data-company-id'),
                representativeKey: modal?.getAttribute('data-representative-key')
            });
            
            // í¼ ìƒíƒœ í™•ì¸
            const form = document.getElementById('editUserForm');
            console.log('ğŸ“Š í¼ ìƒíƒœ:', {
                ì¡´ì¬í•¨: !!form,
                onsubmit: form?.getAttribute('onsubmit'),
                ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆ: form?._eventListeners
            });
            
            // localStorage ë°ì´í„° í™•ì¸
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            companies.forEach(company => {
                const key = `company_${company.id}_representative`;
                const data = localStorage.getItem(key);
                console.log(`ğŸ“Š ${company.companyName} ëŒ€í‘œ ë°ì´í„°:`, JSON.parse(data || 'null'));
            });
        };
        
        window.forceFixRepresentatives = function() {
            console.log('ğŸ”§ ëŒ€í‘œ ë°ì´í„° ê°•ì œ ìˆ˜ì •');
            
            // ê³ ê°•ì„ ëŒ€í‘œ ê°•ì œ ì—…ë°ì´íŠ¸
            const testCompanyKey = 'company_test-company-1_representative';
            const newData = {
                id: 'test-company-1-rep',
                name: 'ê³ ê°•ì„',
                position: 'ëŒ€í‘œì´ì‚¬', 
                department: 'ê²½ì˜ì§„',
                email: 'ceo123@testcompany1.co.kr',
                phone: '010-1234-1234',
                role: 'company_representative',
                companyId: 'test-company-1',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                status: 'active'
            };
            
            localStorage.setItem(testCompanyKey, JSON.stringify(newData));
            console.log('âœ… ê³ ê°•ì„ ëŒ€í‘œ ë°ì´í„° ê°•ì œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            
            renderUsersList();
        };

        // íšŒì‚¬ ëŒ€í‘œ ë°ì´í„° ìƒì„± ë° í™•ì¸ (ìƒ˜í”Œ ë°ì´í„° ì œê±°ë¨)
        function ensureCompanyRepresentativesExist() {
            console.log('ğŸ” íšŒì‚¬ ëŒ€í‘œ ë°ì´í„° ì¡´ì¬ í™•ì¸');
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ íšŒì‚¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë¯€ë¡œ í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„° ì œê±°
            console.log('ğŸ“Š ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ íšŒì‚¬ ì •ë³´ ì‚¬ìš©');
        }
        
        // ëŒ€í‘œ ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ ìƒì„± (ìƒ˜í”Œ ë°ì´í„° ì œê±°ë¨)
        function ensureRepresentativesExistOnce() {
            console.log('ğŸ”§ ëŒ€í‘œ ë°ì´í„° ì¡´ì¬ í™•ì¸ ë° í•„ìš”ì‹œ ìƒì„±');
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            
            companies.forEach(company => {
                const representativeKey = `company_${company.id}_representative`;
                const existing = localStorage.getItem(representativeKey);
                
                if (!existing) {
                    console.log(`ğŸ†• ${company.companyName}ì— ëŒ€í‘œ ë°ì´í„°ê°€ ì—†ì–´ì„œ ê¸°ë³¸ ìƒì„±í•©ë‹ˆë‹¤`);
                    
                    // ê¸°ë³¸ ëŒ€í‘œ ì •ë³´ (í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„° ì œê±°)
                    const defaultRepresentative = {
                        id: `${company.id}-rep`,
                        name: 'ëŒ€í‘œì´ì‚¬',
                        position: 'ëŒ€í‘œì´ì‚¬',
                        department: 'ê²½ì˜ì§„',
                        email: `ceo@${company.id}.co.kr`,
                        phone: '010-0000-0000',
                        role: 'company_representative',
                        companyId: company.id,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        status: 'active'
                    };
                    
                    localStorage.setItem(representativeKey, JSON.stringify(defaultRepresentative));
                    console.log(`âœ… ëŒ€í‘œ ìƒì„±: ${defaultRepresentative.name} (${representativeKey})`);
                } else {
                    console.log(`ğŸ“‹ ${company.companyName}ì— ê¸°ì¡´ ëŒ€í‘œ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤ - ë³´ì¡´`);
                }
            });
        }
        
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„± í•¨ìˆ˜ ì œê±°ë¨ - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì œ ë°ì´í„° ì‚¬ìš©
        
        // ë””ë²„ê¹…ìš© - localStorage í™•ì¸
        function debugLocalStorage() {
            console.log('ğŸ”§ localStorage ë””ë²„ê¹…:');
            const keys = Object.keys(localStorage);
            const repKeys = keys.filter(key => key.includes('_representative'));
            console.log('ëŒ€í‘œ ê´€ë ¨ í‚¤ë“¤:', repKeys);
            
            repKeys.forEach(key => {
                const data = localStorage.getItem(key);
                console.log(`${key}:`, JSON.parse(data));
            });
        }
        
        // ë””ë²„ê¹…ìš© - ëŒ€í‘œ ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
        function resetRepresentativeData() {
            console.log('ğŸ”§ ëŒ€í‘œ ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”');
            const keys = Object.keys(localStorage);
            const repKeys = keys.filter(key => key.includes('_representative'));
            
            repKeys.forEach(key => {
                localStorage.removeItem(key);
                console.log(`âŒ ì‚­ì œë¨: ${key}`);
            });
            
            console.log('âœ… ëŒ€í‘œ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
            forceCreateRepresentatives();
            renderUsersList();
        }

        function editCompanyRepresentative(companyId, userId) {
            console.log('ğŸ“ íšŒì‚¬ ëŒ€í‘œ í¸ì§‘:', companyId, userId);
            
            const representativeKey = `company_${companyId}_representative`;
            const representative = JSON.parse(localStorage.getItem(representativeKey) || 'null');
            
            console.log('ğŸ” ë¡œë“œëœ ëŒ€í‘œ ì •ë³´:', representative);
            console.log('ğŸ”‘ ì‚¬ìš©ëœ í‚¤:', representativeKey);
            
            if (!representative) {
                alert('ëŒ€í‘œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.log('âŒ ëŒ€í‘œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ëª¨ë‹¬ì— í˜„ì¬ ëŒ€í‘œ ì •ë³´ ì„¤ì •
            document.getElementById('editUserId').value = representative.id;
            document.getElementById('editUserName').value = representative.name || '';
            document.getElementById('editUserPhone').value = representative.phone || '';
            document.getElementById('editUserEmail').value = representative.email || '';
            
            console.log('ğŸ“‹ ëª¨ë‹¬ì— ì„¤ì •ëœ ê°’ë“¤:', {
                id: representative.id,
                name: representative.name,
                phone: representative.phone,
                email: representative.email
            });
            
            // íšŒì‚¬ ì •ë³´ë„ ì €ì¥ (í¼ ì²˜ë¦¬ì—ì„œ ì‚¬ìš©)
            const modal = document.getElementById('editUserModal');
            modal.setAttribute('data-company-id', companyId);
            modal.setAttribute('data-representative-key', representativeKey);
            
            console.log('ğŸ¢ ëª¨ë‹¬ì— ì„¤ì •ëœ íšŒì‚¬ ì •ë³´:', {
                companyId: companyId,
                representativeKey: representativeKey
            });
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.display = 'flex';
            console.log('âœ… ëª¨ë‹¬ í‘œì‹œ ì™„ë£Œ');
        }


        // íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸ (ìƒ˜í”Œ ë°ì´í„° ìë™ ìƒì„± ì œê±°)
        function updateCompanyList() {
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            
            // ìƒ˜í”Œ íšŒì‚¬ ìë™ ìƒì„± ë¡œì§ ì œê±° - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë§Œ ì‹¤ì œ íšŒì‚¬ ë°ì´í„° ì‚¬ìš©
            console.log('ğŸ“Š ì‹¤ì œ ë“±ë¡ëœ íšŒì‚¬ë§Œ í‘œì‹œ:', companies.length, 'ê°œ');
            
            // íšŒì‚¬ ëª©ë¡ ë™ì  ë Œë”ë§
            const companyListContainer = document.querySelector('.company-list');
            if (companyListContainer) {
                const currentCompanies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
                console.log('ğŸ¢ ë Œë”ë§í•  íšŒì‚¬ ëª©ë¡:', currentCompanies);
                
                companyListContainer.innerHTML = currentCompanies.map(company => `
                    <div class="company-item">
                        <div class="company-info">
                            <h3>${company.companyName || company.name}</h3>
                            <p>ê°€ì…ì¼: ${new Date(company.createdAt).toLocaleDateString('ko-KR')} | ì‚¬ìš©ì: ${company.users || 0}ëª… | ìƒíƒœ: ${company.status === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}</p>
                            ${company.businessType ? `<p>ì—…ì¢…: ${company.businessType}</p>` : ''}
                            ${company.domainUrl ? `<p>ë„ë©”ì¸: <a href="${company.domainUrl}" target="_blank" style="color: #667eea;">${company.domainUrl}</a></p>` : ''}
                        </div>
                        <div class="company-actions">
                            <button class="btn btn-primary" onclick="manageCompany('${company.id}')">
                                <i class="fas fa-cog"></i> ê´€ë¦¬
                            </button>
                            <button class="btn btn-secondary" onclick="viewCompanyHomepage('${company.id}', '${company.templateSelect}')">
                                <i class="fas fa-globe"></i> í™ˆí˜ì´ì§€
                            </button>
                            <button class="btn btn-secondary" onclick="showEditCompanyModal('${company.id}')">
                                <i class="fas fa-edit"></i> í¸ì§‘
                            </button>
                            <button class="btn btn-danger" onclick="deleteCompany('${company.id}', '${company.companyName || company.name}')">
                                <i class="fas fa-trash"></i> ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            const currentCompanies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            const totalCompanies = currentCompanies.length || 3;
            const totalUsers = currentCompanies.reduce((sum, company) => sum + (company.users || 0), 0) || 248;
            
            document.querySelector('#totalCompanies .value').textContent = totalCompanies;
            document.querySelector('#totalUsers .value').textContent = totalUsers;
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ í†µê³„ ë™ê¸°í™”
            updateStatistics();
        }

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 12px;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ•' : 'â„¹';
            const color = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
            
            notification.innerHTML = `
                <div style="width: 24px; height: 24px; background: ${color}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                    ${icon}
                </div>
                <div style="flex: 1; color: #1f2937;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ì„¤ì • ì €ì¥ í•¨ìˆ˜
        function savePermissions() {
            console.log('Saving permissions');
            showNotification('ê¶Œí•œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function saveSystemSettings() {
            console.log('Saving system settings');
            showNotification('ì‹œìŠ¤í…œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userRole');
                localStorage.removeItem('userName');
                window.location.href = '../../1-homepage/templates/index.html';
            }
        }

        // ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜
        function showAddCompanyModal() {
            const modal = document.getElementById('addCompanyModal');
            modal.style.display = 'flex';
        }

        function hideAddCompanyModal() {
            const modal = document.getElementById('addCompanyModal');
            modal.style.display = 'none';
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('addCompanyForm').reset();
        }

        // íšŒì‚¬ ë“±ë¡ ì²˜ë¦¬ í•¨ìˆ˜
        function handleAddCompany(event) {
            console.log('ğŸš€ handleAddCompany í•¨ìˆ˜ ì‹œì‘');
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const companyData = {
                id: generateCompanyId(formData.get('companyName')),
                companyName: formData.get('companyName'),
                businessNumber: formData.get('businessNumber'),
                corporateNumber: formData.get('corporateNumber'),
                representative: formData.get('representative'),
                openingDate: formData.get('openingDate'),
                businessAddress: formData.get('businessAddress'),
                businessType: formData.get('businessType'),
                templateSelect: formData.get('templateSelect'),
                domainUrl: formData.get('domainUrl') || '',
                status: 'active',
                createdAt: new Date().toISOString(),
                users: 0
            };
            
            console.log('ğŸ“‹ ìˆ˜ì§‘ëœ íšŒì‚¬ ë°ì´í„°:', companyData);
            
            // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
            console.log('âœ… ìœ íš¨ì„± ê²€ì‚¬ ì‹œì‘');
            const validationResult = validateCompanyData(companyData);
            if (!validationResult.isValid) {
                console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:', validationResult.message);
                showNotification(validationResult.message, 'error');
                return;
            }
            console.log('âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼');
            
            // ì¤‘ë³µ ì²´í¬
            console.log('ğŸ” ì¤‘ë³µ ì²´í¬ ì‹œì‘');
            const duplicateCheck = checkDuplicateCompany(companyData);
            if (!duplicateCheck.isValid) {
                console.log('âŒ ì¤‘ë³µ ì²´í¬ ì‹¤íŒ¨:', duplicateCheck.message);
                showNotification(duplicateCheck.message, 'error');
                return;
            }
            console.log('âœ… ì¤‘ë³µ ì²´í¬ í†µê³¼');
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— íšŒì‚¬ ì •ë³´ ì €ì¥
            console.log('ğŸ’¾ localStorageì— íšŒì‚¬ ì •ë³´ ì €ì¥ ì‹œì‘');
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            console.log('ğŸ“‚ ê¸°ì¡´ íšŒì‚¬ ëª©ë¡:', companies);
            companies.push(companyData);
            localStorage.setItem('platform_companies', JSON.stringify(companies));
            console.log('ğŸ’¾ íšŒì‚¬ ì •ë³´ ì €ì¥ ì™„ë£Œ. ì´ íšŒì‚¬ ìˆ˜:', companies.length);
            
            // ì„ íƒí•œ í…œí”Œë¦¿ì— íšŒì‚¬ ì •ë³´ ì ìš©
            console.log('ğŸ¨ í…œí”Œë¦¿ì— íšŒì‚¬ ì •ë³´ ì ìš© ì‹œì‘');
            applyCompanyDataToTemplate(companyData);
            
            // ì„±ê³µ ë©”ì‹œì§€
            console.log('ğŸ‰ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ');
            showNotification(`${companyData.companyName} íšŒì‚¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            
            // ëª¨ë‹¬ ë‹«ê¸°
            console.log('âŒ ëª¨ë‹¬ ë‹«ê¸°');
            hideAddCompanyModal();
            
            // íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
            console.log('ğŸ”„ íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸ ì‹œì‘');
            updateCompanyList();
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ í†µê³„ ë™ê¸°í™”
            console.log('ğŸ“Š í†µê³„ ë™ê¸°í™” ì‹œì‘');
            updateStatistics();
            
            console.log('âœ… handleAddCompany í•¨ìˆ˜ ì™„ë£Œ');
        }

        // íšŒì‚¬ ID ìƒì„± í•¨ìˆ˜
        function generateCompanyId(companyName) {
            return companyName
                .toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^a-z0-9ê°€-í£-]/g, '')
                .substring(0, 20);
        }

        // íšŒì‚¬ ë°ì´í„°ë¥¼ ì„ íƒí•œ í…œí”Œë¦¿ì— ì ìš©í•˜ëŠ” í•¨ìˆ˜
        function applyCompanyDataToTemplate(companyData) {
            const templateKey = `template_${companyData.templateSelect}_settings`;
            
            // ì „í™”ë²ˆí˜¸ ìƒì„± (ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ê¸°ë°˜ìœ¼ë¡œ ê°„ë‹¨í•œ ë¡œì§)
            const phoneNumber = generatePhoneNumber(companyData.businessNumber);
            
            // í…œí”Œë¦¿ë³„ ë§ì¶¤í˜• ë©”ì‹œì§€ ìƒì„±
            const templateMessages = {
                'scout': `${companyData.companyName}ê³¼ í•¨ê»˜í•˜ëŠ” ê¸€ë¡œë²Œ ì² ê°• ì†”ë£¨ì…˜`,
                'dewi': `ì „í†µê³¼ ì‹ ë¢°ì˜ ì² ê°•ì „ë¬¸ê¸°ì—… ${companyData.companyName}`,
                'visible': `ì²¨ë‹¨ ê¸°ìˆ ë¡œ ë¯¸ë˜ë¥¼ ì—°ê²°í•˜ëŠ” ${companyData.companyName}`,
                'nice-restaurant': `ìµœê³  í’ˆì§ˆì˜ ì² ê°• ì†Œì¬ë¡œ ë‹¹ì‹ ì˜ ê¿ˆì„ ì‹¤í˜„í•˜ëŠ” ${companyData.companyName}`,
                'instant': `ë¯¿ì„ ìˆ˜ ìˆëŠ” ì² ê°• ì†”ë£¨ì…˜ ${companyData.companyName}`,
                'upconstruction': `ê±´ì„¤ìš© ì² ê°•ì¬ ì „ë¬¸ê¸°ì—… ${companyData.companyName}`,
                'gp': `ê¸€ë¡œë²Œ íŒŒíŠ¸ë„ˆì‹­ìœ¼ë¡œ ì„±ì¥í•˜ëŠ” ${companyData.companyName}`,
                'blogy': `ì² ê°• ì‚°ì—…ì˜ ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ë§Œë“œëŠ” ${companyData.companyName}`,
                'iportfolio': `ì² ê°• ê¸°ìˆ  í˜ì‹ ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ${companyData.companyName}`
            };
            
            const subTitleMessages = {
                'scout': `${companyData.businessType} ë¶„ì•¼ì˜ ê¸€ë¡œë²Œ ë¦¬ë”ë¡œì„œ ìµœê³  í’ˆì§ˆì˜ ì œí’ˆê³¼ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.`,
                'dewi': `35ë…„ ì „í†µì˜ ì² ê°• ì œì¡° ê¸°ìˆ ë¡œ ìµœê³  í’ˆì§ˆì˜ ì œí’ˆì„ ë§Œë“¤ì–´ê°€ëŠ” ${companyData.companyName}ì…ë‹ˆë‹¤.`,
                'visible': `4ì°¨ ì‚°ì—…í˜ëª… ì‹œëŒ€ì— ë§ì¶˜ ì²¨ë‹¨ ì² ê°• ê¸°ìˆ ë¡œ í˜ì‹ ì ì¸ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.`,
                'nice-restaurant': `ìë™ì°¨ ì‚°ì—…ì˜ í•µì‹¬ ì†Œì¬ë¡œ ê³ ê°ì˜ ì„±ê³µì„ í•¨ê»˜ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.`,
                'instant': `30ë…„ ì „í†µì˜ ê¸°ìˆ ë ¥ê³¼ í˜ì‹ ìœ¼ë¡œ ê³ ê°ì˜ ì„±ê³µì„ ì§€ì›í•˜ëŠ” ìµœê³ ì˜ ì² ê°• ì œí’ˆì„ ì œê³µí•©ë‹ˆë‹¤.`,
                'upconstruction': `ê±´ì„¤ í˜„ì¥ì˜ ë“ ë“ í•œ íŒŒíŠ¸ë„ˆë¡œì„œ ìµœê³  í’ˆì§ˆì˜ ê±´ì„¤ìš© ì² ê°•ì¬ë¥¼ ê³µê¸‰í•©ë‹ˆë‹¤.`,
                'gp': `ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ì™€ ì²¨ë‹¨ ê¸°ìˆ ë ¥ìœ¼ë¡œ ì„¸ê³„ ì‹œì¥ì—ì„œ ê²½ìŸë ¥ì„ í™•ë³´í•˜ê³  ìˆìŠµë‹ˆë‹¤.`,
                'blogy': `ì² ê°• ì‚°ì—…ì˜ íŠ¸ë Œë“œì™€ í˜ì‹  ê¸°ìˆ ì„ ì„ ë„í•˜ëŠ” ì „ë¬¸ ê¸°ì—…ì…ë‹ˆë‹¤.`,
                'iportfolio': `ë‹¤ì–‘í•œ ì‚°ì—… ë¶„ì•¼ì˜ ì² ê°• ì†”ë£¨ì…˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì œê³µí•˜ëŠ” ì „ë¬¸ ê¸°ì—…ì…ë‹ˆë‹¤.`
            };
            
            const templateSettings = {
                basic: {
                    companyName: companyData.companyName,
                    mainTitle: templateMessages[companyData.templateSelect] || `${companyData.companyName}ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤`,
                    subTitle: subTitleMessages[companyData.templateSelect] || `${companyData.businessType} ë¶„ì•¼ì˜ ì „ë¬¸ê¸°ì—… ${companyData.companyName}ì…ë‹ˆë‹¤.`,
                    phone: phoneNumber,
                    address: companyData.businessAddress,
                    email: `info@${companyData.id}.co.kr`,
                    representative: companyData.representative
                },
                company: {
                    businessNumber: companyData.businessNumber,
                    corporateNumber: companyData.corporateNumber,
                    openingDate: companyData.openingDate,
                    businessType: companyData.businessType
                },
                applied: true,
                appliedAt: new Date().toISOString()
            };
            
            localStorage.setItem(templateKey, JSON.stringify(templateSettings));
            console.log(`í…œí”Œë¦¿ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${templateKey}`, templateSettings);
        }
        
        // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „í™”ë²ˆí˜¸ ìƒì„±
        function generatePhoneNumber(businessNumber) {
            if (!businessNumber) return '02-1234-5678';
            
            // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
            const numbers = businessNumber.replace(/[^0-9]/g, '');
            if (numbers.length >= 10) {
                // ì•ìë¦¬ 3ê°œ, ì¤‘ê°„ 4ê°œ, ë’·ìë¦¬ 4ê°œë¡œ ë¶„í• 
                const area = numbers.substring(0, 3);
                const middle = numbers.substring(3, 7);
                const last = numbers.substring(7, 11);
                
                // ì§€ì—­ë²ˆí˜¸ ë§¤í•‘ (ê°„ë‹¨í•œ ë¡œì§)
                const areaCode = ['02', '031', '032', '033', '041', '042', '043', '051', '052', '053', '054', '055', '061', '062', '063', '064'][parseInt(area.charAt(0)) % 16];
                
                return `${areaCode}-${middle.substring(0, 4)}-${last.substring(0, 4)}`;
            }
            
            return '02-1234-5678'; // ê¸°ë³¸ê°’
        }

        // íšŒì‚¬ ì‚­ì œ í•¨ìˆ˜
        function deleteCompany(companyId, companyName) {
            if (confirm(`ì •ë§ë¡œ "${companyName}" íšŒì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, í•´ë‹¹ íšŒì‚¬ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                // localStorageì—ì„œ íšŒì‚¬ ì •ë³´ ì‚­ì œ
                const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
                const updatedCompanies = companies.filter(company => company.id !== companyId);
                localStorage.setItem('platform_companies', JSON.stringify(updatedCompanies));
                
                // í•´ë‹¹ íšŒì‚¬ì˜ í…œí”Œë¦¿ ì„¤ì •ë„ ì‚­ì œ
                const templateKey = `template_${companies.find(c => c.id === companyId)?.templateSelect}_settings`;
                localStorage.removeItem(templateKey);
                
                // ì„±ê³µ ë©”ì‹œì§€
                showNotification(`${companyName} íšŒì‚¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                // íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
                updateCompanyList();
                
                // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ í†µê³„ ë™ê¸°í™”
                updateStatistics();
            }
        }

        // íšŒì‚¬ í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showEditCompanyModal(companyId) {
            console.log('ğŸ”§ í¸ì§‘ ëª¨ë‹¬ ì—´ê¸° - ì „ë‹¬ë°›ì€ íšŒì‚¬ ID:', companyId, typeof companyId);
            
            // allCompanies ë³€ìˆ˜ì—ì„œ íšŒì‚¬ ì°¾ê¸° (ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¡œë“œëœ ì‹¤ì œ ë°ì´í„°)
            console.log('ğŸ“Š allCompanies ì „ì²´ ëª©ë¡:', allCompanies);
            console.log('ğŸ“Š ê° íšŒì‚¬ì˜ ID ì •ë³´:', allCompanies.map(c => ({id: c.id, name: c.company_name, domain: c.domain, type: typeof c.id})));
            
            const company = allCompanies.find(c => {
                console.log(`ID ë¹„êµ: ${c.id} (${typeof c.id}) === ${companyId} (${typeof companyId}) || ${c.domain} === ${companyId}`);
                return String(c.id) === String(companyId) || String(c.domain) === String(companyId);
            });
            
            console.log('ğŸ¯ ì°¾ì€ íšŒì‚¬:', company);
            
            if (!company) {
                console.error('âŒ íšŒì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                showNotification('íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // í¸ì§‘ í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸° (ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì— ë§ê²Œ)
            console.log('ğŸ“ í¸ì§‘ í¼ì— ì„¤ì •í•  íšŒì‚¬ ì •ë³´:', company);
            const settings = company.tenant_settings || {};
            
            document.getElementById('editCompanyId').value = company.domain; // domainì„ IDë¡œ ì‚¬ìš©
            document.getElementById('editCompanyName').value = company.company_name || '';
            document.getElementById('editBusinessNumber').value = company.business_number || '';
            document.getElementById('editCorporateNumber').value = settings.corporate_number || '';
            document.getElementById('editRepresentative').value = settings.representative || '';
            document.getElementById('editOpeningDate').value = settings.opening_date || '';
            document.getElementById('editBusinessAddress').value = company.address || '';
            document.getElementById('editBusinessType').value = settings.business_type || '';
            document.getElementById('editWebsiteUrl').value = company.website || '';
            document.getElementById('editCompanyEmail').value = company.email || '';
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modal = document.getElementById('editCompanyModal');
            modal.style.display = 'flex';
        }

        // íšŒì‚¬ í¸ì§‘ ëª¨ë‹¬ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
        function hideEditCompanyModal() {
            const modal = document.getElementById('editCompanyModal');
            modal.style.display = 'none';
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('editCompanyForm').reset();
        }

        // íšŒì‚¬ í¸ì§‘ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleEditCompany(event) {
            event.preventDefault();
            
            console.log('ğŸš€ í¸ì§‘ í¼ ì œì¶œ ì‹œì‘');
            console.log('ğŸ“‹ ì œì¶œëœ í¼:', event.target);
            
            const formData = new FormData(event.target);
            
            // ëª¨ë“  í¼ ë°ì´í„° í™•ì¸
            console.log('ğŸ“ í¼ì—ì„œ ë°›ì€ ëª¨ë“  ë°ì´í„°:');
            for (let [key, value] of formData.entries()) {
                console.log(`  ${key}: ${value} (${typeof value})`);
            }
            
            const companyId = formData.get('editCompanyId');
            
            console.log('ğŸ” í¸ì§‘í•  íšŒì‚¬ ID:', companyId, typeof companyId);
            console.log('ğŸ” í¸ì§‘í•  íšŒì‚¬ IDê°€ ë¹„ì–´ìˆë‚˜?', !companyId || companyId === '');
            
            if (!companyId || companyId === '') {
                console.error('âŒ íšŒì‚¬ IDê°€ ì—†ìŒ');
                showNotification('íšŒì‚¬ IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // allCompaniesì—ì„œ íšŒì‚¬ ì°¾ê¸° (ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¡œë“œëœ ì‹¤ì œ ë°ì´í„°)
            console.log('ğŸ“Š allCompaniesì—ì„œ íšŒì‚¬ ê²€ìƒ‰:', allCompanies.map(c => ({id: c.id, name: c.company_name, domain: c.domain, type: typeof c.id})));
            
            const companyIndex = allCompanies.findIndex(c => {
                console.log(`ë„ë©”ì¸ ë¹„êµ: ${c.domain} === ${companyId} ë˜ëŠ” ID ë¹„êµ: ${c.id} === ${companyId}`);
                return String(c.domain) === String(companyId) || String(c.id) === String(companyId);
            });
            
            console.log('ğŸ¯ ì°¾ì€ íšŒì‚¬ ì¸ë±ìŠ¤:', companyIndex);
            
            if (companyIndex === -1) {
                showNotification('ìˆ˜ì •í•  íšŒì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ì—…ë°ì´íŠ¸í•  íšŒì‚¬ ì •ë³´ ì¤€ë¹„ (ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì— ë§ê²Œ)
            const updatedCompany = {
                ...allCompanies[companyIndex],
                company_name: formData.get('editCompanyName'),
                business_number: formData.get('editBusinessNumber'),
                corporate_number: formData.get('editCorporateNumber'),
                representative: formData.get('editRepresentative'),
                opening_date: formData.get('editOpeningDate'),
                business_address: formData.get('editBusinessAddress'),
                business_type: formData.get('editBusinessType'),
                template_select: formData.get('editTemplateSelect'),
                domain_url: formData.get('editDomainUrl') || '',
                updated_at: new Date().toISOString()
            };
            
            console.log('ğŸ“ ì—…ë°ì´íŠ¸í•  íšŒì‚¬ ì •ë³´:', updatedCompany);
            
            try {
                // ì‹¤ì œ íšŒì‚¬ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                const company = allCompanies[companyIndex];
                console.log('ğŸ¢ ì—…ë°ì´íŠ¸í•  íšŒì‚¬ ê°ì²´:', company);
                
                // ë°ì´í„°ë² ì´ìŠ¤ì— ì—…ë°ì´íŠ¸ (ê¸°ì¡´ íšŒì‚¬ ê°ì²´ì˜ í•„ë“œëª… í™•ì¸ í›„ ì—…ë°ì´íŠ¸)
                console.log('ğŸ” ê¸°ì¡´ íšŒì‚¬ ê°ì²´ì˜ ëª¨ë“  í•„ë“œ:', Object.keys(company));
                
                if (db && db.client) {
                    // ì‹¤ì œ ì¡´ì¬í•˜ëŠ” í•„ë“œë§Œ ì—…ë°ì´íŠ¸ (ìŠ¤í‚¤ë§ˆì— í™•ì‹¤íˆ ìˆëŠ” í•„ë“œë“¤ë§Œ)
                    const updateFields = {
                        company_name: formData.get('editCompanyName'),
                        updated_at: new Date().toISOString()
                    };
                    
                    // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì— ì¡´ì¬í•˜ëŠ” í•„ë“œë“¤ë§Œ ì¶”ê°€
                    if ('business_number' in company) updateFields.business_number = formData.get('editBusinessNumber');
                    if ('address' in company) updateFields.address = formData.get('editBusinessAddress');
                    if ('phone' in company) updateFields.phone = formData.get('editPhone') || company.phone;
                    if ('email' in company) updateFields.email = formData.get('editCompanyEmail');
                    if ('website' in company) updateFields.website = formData.get('editWebsiteUrl');
                    
                    // tenant_settingsì— ì¶”ê°€ ì •ë³´ ì €ì¥
                    if ('tenant_settings' in company) {
                        const currentSettings = company.tenant_settings || {};
                        updateFields.tenant_settings = {
                            ...currentSettings,
                            representative: formData.get('editRepresentative'),
                            opening_date: formData.get('editOpeningDate'),
                            business_type: formData.get('editBusinessType'),
                            corporate_number: formData.get('editCorporateNumber')
                        };
                    }
                    
                    console.log('ğŸ“¤ ì‹¤ì œ ì—…ë°ì´íŠ¸í•  í•„ë“œë“¤:', updateFields);
                    
                    const { data, error } = await db.client
                        .from('companies')
                        .update(updateFields)
                        .eq('id', company.id)
                        .select();
                    
                    if (error) {
                        console.error('ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                        showNotification('íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì„±ê³µ:', data);
                    
                    // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°˜í™˜ëœ ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ì‚¬ìš©
                    if (data && data.length > 0) {
                        allCompanies[companyIndex] = data[0];
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°˜í™˜ëœ ì—…ë°ì´íŠ¸ëœ íšŒì‚¬ ì •ë³´:', data[0]);
                    }
                } else {
                    // ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ë¡œì»¬ì—ì„œë§Œ ì—…ë°ì´íŠ¸
                    const updatedCompanyForArray = {
                        ...company,
                        company_name: formData.get('editCompanyName'),
                        updated_at: new Date().toISOString()
                    };
                    
                    // ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì— ì¡´ì¬í•˜ëŠ” í•„ë“œë“¤ë§Œ ì—…ë°ì´íŠ¸
                    if ('business_number' in company) updatedCompanyForArray.business_number = formData.get('editBusinessNumber');
                    if ('address' in company) updatedCompanyForArray.address = formData.get('editBusinessAddress');
                    if ('email' in company) updatedCompanyForArray.email = formData.get('editCompanyEmail');
                    if ('website' in company) updatedCompanyForArray.website = formData.get('editWebsiteUrl');
                    
                    // tenant_settingsì— ì¶”ê°€ ì •ë³´ ì €ì¥
                    if ('tenant_settings' in company) {
                        const currentSettings = company.tenant_settings || {};
                        updatedCompanyForArray.tenant_settings = {
                            ...currentSettings,
                            representative: formData.get('editRepresentative'),
                            opening_date: formData.get('editOpeningDate'),
                            business_type: formData.get('editBusinessType'),
                            corporate_number: formData.get('editCorporateNumber')
                        };
                    }
                    
                    allCompanies[companyIndex] = updatedCompanyForArray;
                    console.log('âœ… allCompanies ì—…ë°ì´íŠ¸ ì™„ë£Œ (ì˜¤í”„ë¼ì¸):', updatedCompanyForArray);
                }
                
                // ì„±ê³µ ë©”ì‹œì§€
                const updatedCompanyName = allCompanies[companyIndex].company_name || formData.get('editCompanyName');
                showNotification(`${updatedCompanyName} íšŒì‚¬ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                // ëª¨ë‹¬ ë‹«ê¸°
                hideEditCompanyModal();
                
                // íšŒì‚¬ ëª©ë¡ ì—…ë°ì´íŠ¸
                if (typeof renderCompaniesList === 'function') {
                    renderCompaniesList();
                }
                
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                await loadDashboardData();
                updateStatistics();
                
            } catch (error) {
                console.error('âŒ íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                showNotification('íšŒì‚¬ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        function validateCompanyData(companyData) {
            // í•„ìˆ˜ í•„ë“œ ê²€ì‚¬
            if (!companyData.companyName || companyData.companyName.trim() === '') {
                return { isValid: false, message: 'ë²•ì¸ëª…(ë‹¨ì²´ëª…)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.businessNumber || companyData.businessNumber.trim() === '') {
                return { isValid: false, message: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.representative || companyData.representative.trim() === '') {
                return { isValid: false, message: 'ëŒ€í‘œìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.openingDate) {
                return { isValid: false, message: 'ê°œì—…ì—°ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.businessAddress || companyData.businessAddress.trim() === '') {
                return { isValid: false, message: 'ì‚¬ì—…ì ì†Œì¬ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.businessType || companyData.businessType.trim() === '') {
                return { isValid: false, message: 'ì‚¬ì—…ì˜ ì¢…ë¥˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!companyData.templateSelect) {
                return { isValid: false, message: 'í™ˆí˜ì´ì§€ í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' };
            }
            
            // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ í˜•ì‹ ê²€ì‚¬ (000-00-00000)
            const businessNumberPattern = /^\d{3}-\d{2}-\d{5}$/;
            if (!businessNumberPattern.test(companyData.businessNumber)) {
                return { isValid: false, message: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ëŠ” 000-00-00000 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            // ë²•ì¸ë“±ë¡ë²ˆí˜¸ í˜•ì‹ ê²€ì‚¬ (ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ ì…ë ¥ëœ ê²½ìš°)
            if (companyData.corporateNumber && companyData.corporateNumber.trim() !== '') {
                const corporateNumberPattern = /^\d{6}-\d{7}$/;
                if (!corporateNumberPattern.test(companyData.corporateNumber)) {
                    return { isValid: false, message: 'ë²•ì¸ë“±ë¡ë²ˆí˜¸ëŠ” 000000-0000000 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
                }
            }
            
            // ê°œì—…ì—°ì›”ì¼ ìœ íš¨ì„± ê²€ì‚¬ (ë¯¸ë˜ ë‚ ì§œ ë¶ˆê°€)
            const openingDate = new Date(companyData.openingDate);
            const today = new Date();
            if (openingDate > today) {
                return { isValid: false, message: 'ê°œì—…ì—°ì›”ì¼ì€ ì˜¤ëŠ˜ ë‚ ì§œ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.' };
            }
            
            // íšŒì‚¬ëª… ê¸¸ì´ ê²€ì‚¬
            if (companyData.companyName.length > 50) {
                return { isValid: false, message: 'ë²•ì¸ëª…(ë‹¨ì²´ëª…)ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            return { isValid: true, message: 'ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼' };
        }
        
        // ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜
        function checkDuplicateCompany(companyData) {
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            console.log('ğŸ” ê¸°ì¡´ íšŒì‚¬ ëª©ë¡ í™•ì¸:', companies);
            
            // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬
            const duplicateBusinessNumber = companies.find(company => 
                company.businessNumber === companyData.businessNumber
            );
            if (duplicateBusinessNumber) {
                const companyName = duplicateBusinessNumber.companyName || duplicateBusinessNumber.name || 'ì´ë¦„ ì—†ìŒ';
                return { 
                    isValid: false, 
                    message: `ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ${companyData.businessNumber}ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (íšŒì‚¬ëª…: ${companyName})` 
                };
            }
            
            // ë²•ì¸ë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ)
            if (companyData.corporateNumber && companyData.corporateNumber.trim() !== '') {
                const duplicateCorporateNumber = companies.find(company => 
                    company.corporateNumber === companyData.corporateNumber
                );
                if (duplicateCorporateNumber) {
                    const companyName = duplicateCorporateNumber.companyName || duplicateCorporateNumber.name || 'ì´ë¦„ ì—†ìŒ';
                    return { 
                        isValid: false, 
                        message: `ë²•ì¸ë“±ë¡ë²ˆí˜¸ ${companyData.corporateNumber}ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (íšŒì‚¬ëª…: ${companyName})` 
                    };
                }
            }
            
            // íšŒì‚¬ëª… ì¤‘ë³µ ì²´í¬ (ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°)
            const duplicateCompanyName = companies.find(company => {
                const existingName = company.companyName || company.name || '';
                const newName = companyData.companyName || '';
                return existingName.toLowerCase() === newName.toLowerCase();
            });
            if (duplicateCompanyName) {
                return { 
                    isValid: false, 
                    message: `íšŒì‚¬ëª… "${companyData.companyName}"ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.` 
                };
            }
            
            console.log('âœ… ì¤‘ë³µ ì²´í¬ ì™„ë£Œ - ì¤‘ë³µ ì—†ìŒ');
            return { isValid: true, message: 'ì¤‘ë³µ ì²´í¬ í†µê³¼' };
        }

        // í¸ì§‘ìš© ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜ (ìê¸° ìì‹  ì œì™¸)
        function checkDuplicateCompanyForEdit(companyData, editingCompanyId) {
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            console.log('ğŸ” í¸ì§‘ìš© ì¤‘ë³µ ì²´í¬ - í¸ì§‘ ì¤‘ì¸ íšŒì‚¬ ID:', editingCompanyId);
            
            // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ (ìê¸° ìì‹  ì œì™¸)
            const duplicateBusinessNumber = companies.find(company => 
                String(company.id) !== String(editingCompanyId) && 
                company.businessNumber === companyData.businessNumber
            );
            if (duplicateBusinessNumber) {
                const companyName = duplicateBusinessNumber.companyName || duplicateBusinessNumber.name || 'ì´ë¦„ ì—†ìŒ';
                return { 
                    isValid: false, 
                    message: `ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ${companyData.businessNumber}ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (íšŒì‚¬ëª…: ${companyName})` 
                };
            }
            
            // ë²•ì¸ë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ, ìê¸° ìì‹  ì œì™¸)
            if (companyData.corporateNumber && companyData.corporateNumber.trim() !== '') {
                const duplicateCorporateNumber = companies.find(company => 
                    String(company.id) !== String(editingCompanyId) && 
                    company.corporateNumber === companyData.corporateNumber
                );
                if (duplicateCorporateNumber) {
                    const companyName = duplicateCorporateNumber.companyName || duplicateCorporateNumber.name || 'ì´ë¦„ ì—†ìŒ';
                    return { 
                        isValid: false, 
                        message: `ë²•ì¸ë“±ë¡ë²ˆí˜¸ ${companyData.corporateNumber}ê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (íšŒì‚¬ëª…: ${companyName})` 
                    };
                }
            }
            
            // íšŒì‚¬ëª… ì¤‘ë³µ ì²´í¬ (ìê¸° ìì‹  ì œì™¸)
            const duplicateCompanyName = companies.find(company => {
                if (String(company.id) === String(editingCompanyId)) return false;
                const existingName = company.companyName || company.name || '';
                const newName = companyData.companyName || '';
                return existingName.toLowerCase() === newName.toLowerCase();
            });
            if (duplicateCompanyName) {
                return { 
                    isValid: false, 
                    message: `íšŒì‚¬ëª… "${companyData.companyName}"ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.` 
                };
            }
            
            console.log('âœ… í¸ì§‘ìš© ì¤‘ë³µ ì²´í¬ ì™„ë£Œ - ì¤‘ë³µ ì—†ìŒ');
            return { isValid: true, message: 'í¸ì§‘ìš© ì¤‘ë³µ ì²´í¬ í†µê³¼' };
        }

        // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ í†µê³„ ê³„ì‚° í•¨ìˆ˜ (ì •í™•í•œ ê³„ì‚°)
        function updateMasterDashboardStats() {
            console.log('ğŸ“Š ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸');
            
            // allCompaniesì™€ allUsers ë°°ì—´ ì‚¬ìš© (ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ë°ì´í„°)
            const totalCompanies = allCompanies.length;
            const totalUsers = allUsers.length;
            
            // í™œì„± í™ˆí˜ì´ì§€ ìˆ˜ ê³„ì‚° (is_activeê°€ falseê°€ ì•„ë‹Œ íšŒì‚¬ë“¤)
            const activeWebsites = allCompanies.filter(company => 
                company.is_active !== false
            ).length;
            
            console.log(`ğŸ“Š ì´ íšŒì‚¬: ${totalCompanies}ê°œ`);
            console.log(`ğŸ“Š ì´ ì‚¬ìš©ì: ${totalUsers}ëª…`);
            console.log(`ğŸ“Š í™œì„± í™ˆí˜ì´ì§€: ${activeWebsites}ê°œ`);
            
            // UI ì—…ë°ì´íŠ¸
            updateStatCard('totalCompanies', totalCompanies);
            updateStatCard('totalUsers', totalUsers);
            updateStatCard('activeWebsites', activeWebsites);
            updateSystemStatus(totalCompanies > 0 ? 100 : 0);
            
            // systemStats ì „ì—­ ê°ì²´ë„ ì—…ë°ì´íŠ¸
            systemStats.totalCompanies = totalCompanies;
            systemStats.totalUsers = totalUsers;
            systemStats.activeWebsites = activeWebsites;
        }
        
        // updateMasterDashboardStatsë¥¼ ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.updateMasterDashboardStats = updateMasterDashboardStats;
        
        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatCard(cardId, value) {
            const card = document.getElementById(cardId);
            if (card) {
                const valueElement = card.querySelector('.value');
                if (valueElement) {
                    // ìˆ«ì ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                    animateNumber(valueElement, parseInt(valueElement.textContent) || 0, value);
                }
            }
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSystemStatus(uptime) {
            const statusCard = document.getElementById('systemStatus');
            if (statusCard) {
                const trendElement = statusCard.querySelector('.trend');
                if (trendElement) {
                    trendElement.textContent = `${uptime.toFixed(1)}% ê°€ë™ë¥ `;
                }
            }
        }
        
        // ìˆ«ì ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function animateNumber(element, start, end, duration = 1000) {
            const startTime = performance.now();
            const difference = end - start;
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // easeOutQuart ì´ì§• í•¨ìˆ˜
                const easedProgress = 1 - Math.pow(1 - progress, 4);
                const current = Math.round(start + (difference * easedProgress));
                
                element.textContent = current;
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        // ì‹œìŠ¤í…œ ê´€ë¦¬ í•¨ìˆ˜ë“¤

        // ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… í•¨ìˆ˜
        async function backupDatabase() {
            console.log('ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹œì‘');
            
            try {
                // ì§„í–‰ ìƒí™© í‘œì‹œ
                showNotification('ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                
                // ëª¨ë“  í…Œì´ë¸”ì˜ ë°ì´í„° ìˆ˜ì§‘
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    companies: allCompanies,
                    users: allUsers
                };
                
                // localStorage ë°ì´í„°ë„ í¬í•¨
                const localStorageData = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    localStorageData[key] = localStorage.getItem(key);
                }
                backupData.localStorage = localStorageData;
                
                // JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `steelworks_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì™„ë£Œ');
                showNotification('ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                // ë°±ì—… ì‹œê°„ ì—…ë°ì´íŠ¸
                updateLastBackupTime();
                
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ìºì‹œ ì •ë¦¬ í•¨ìˆ˜
        function clearCache() {
            console.log('ğŸ§¹ ìºì‹œ ì •ë¦¬ ì‹œì‘');
            
            try {
                // localStorage ìºì‹œ ë°ì´í„° ì •ë¦¬ (ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ì œì™¸)
                const preserveKeys = ['platform_companies', 'users', 'system_settings'];
                const keysToRemove = [];
                
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && !preserveKeys.some(preserve => key.includes(preserve))) {
                        // ì„ì‹œ ìºì‹œë‚˜ ì„¸ì…˜ ë°ì´í„°ë§Œ ì œê±°
                        if (key.includes('temp_') || key.includes('cache_') || key.includes('session_')) {
                            keysToRemove.push(key);
                        }
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                // ë¸Œë¼ìš°ì € ìºì‹œ ì •ë¦¬ (ê°€ëŠ¥í•œ ê²½ìš°)
                if ('caches' in window) {
                    caches.keys().then(cacheNames => {
                        cacheNames.forEach(cacheName => {
                            caches.delete(cacheName);
                        });
                    });
                }
                
                console.log(`âœ… ìºì‹œ ì •ë¦¬ ì™„ë£Œ (${keysToRemove.length}ê°œ í•­ëª© ì œê±°)`);
                showNotification(`ìºì‹œê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. (${keysToRemove.length}ê°œ í•­ëª© ì œê±°)`, 'success');
                
                // ì‹œìŠ¤í…œ ì„¤ì • ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    renderSystemSettings();
                }, 1000);
                
            } catch (error) {
                console.error('âŒ ìºì‹œ ì •ë¦¬ ì‹¤íŒ¨:', error);
                showNotification('ìºì‹œ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜
        function exportSystemLogs() {
            console.log('ğŸ“‹ ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸° ì‹œì‘');
            
            try {
                // ì‹œìŠ¤í…œ ë¡œê·¸ ë°ì´í„° ìˆ˜ì§‘
                const logs = {
                    timestamp: new Date().toISOString(),
                    systemInfo: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        language: navigator.language,
                        cookieEnabled: navigator.cookieEnabled,
                        onLine: navigator.onLine
                    },
                    databaseStatus: {
                        connected: !!(db && db.client),
                        companiesCount: allCompanies.length,
                        usersCount: allUsers.length
                    },
                    performanceInfo: {
                        memoryUsage: performance.memory ? {
                            usedJSHeapSize: performance.memory.usedJSHeapSize,
                            totalJSHeapSize: performance.memory.totalJSHeapSize,
                            jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
                        } : 'Not available',
                        timing: performance.timing
                    },
                    localStorageInfo: {
                        itemCount: localStorage.length,
                        estimatedSize: JSON.stringify(localStorage).length
                    },
                    recentActivities: [
                        {
                            type: 'system_start',
                            message: 'ì‹œìŠ¤í…œ ì‹œì‘',
                            timestamp: new Date().toISOString()
                        },
                        {
                            type: 'companies_loaded',
                            message: `${allCompanies.length}ê°œ íšŒì‚¬ ë¡œë“œë¨`,
                            timestamp: new Date().toISOString()
                        },
                        {
                            type: 'users_loaded',
                            message: `${allUsers.length}ëª… ì‚¬ìš©ì ë¡œë“œë¨`,
                            timestamp: new Date().toISOString()
                        }
                    ]
                };
                
                // ë¡œê·¸ë¥¼ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                const logText = `=== SteelWorks Platform ì‹œìŠ¤í…œ ë¡œê·¸ ===
ìƒì„± ì‹œê°„: ${logs.timestamp}

=== ì‹œìŠ¤í…œ ì •ë³´ ===
ì‚¬ìš©ì ì—ì´ì „íŠ¸: ${logs.systemInfo.userAgent}
í”Œë«í¼: ${logs.systemInfo.platform}
ì–¸ì–´: ${logs.systemInfo.language}
ì¿ í‚¤ ì‚¬ìš© ê°€ëŠ¥: ${logs.systemInfo.cookieEnabled}
ì˜¨ë¼ì¸ ìƒíƒœ: ${logs.systemInfo.onLine}

=== ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ ===
ì—°ê²° ìƒíƒœ: ${logs.databaseStatus.connected ? 'ì—°ê²°ë¨' : 'ì—°ê²° ì•ˆë¨'}
ë“±ë¡ëœ íšŒì‚¬ ìˆ˜: ${logs.databaseStatus.companiesCount}
ë“±ë¡ëœ ì‚¬ìš©ì ìˆ˜: ${logs.databaseStatus.usersCount}

=== ì„±ëŠ¥ ì •ë³´ ===
ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${typeof logs.performanceInfo.memoryUsage === 'object' ? 
    `ì‚¬ìš©ëŸ‰: ${(logs.performanceInfo.memoryUsage.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB` : 
    logs.performanceInfo.memoryUsage}

=== localStorage ì •ë³´ ===
ì €ì¥ëœ í•­ëª© ìˆ˜: ${logs.localStorageInfo.itemCount}
ì˜ˆìƒ í¬ê¸°: ${(logs.localStorageInfo.estimatedSize / 1024).toFixed(2)}KB

=== ìµœê·¼ í™œë™ ===
${logs.recentActivities.map(activity => `${activity.timestamp}: ${activity.message}`).join('\n')}

=== ìƒì„¸ ë°ì´í„° (JSON) ===
${JSON.stringify(logs, null, 2)}
`;
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `steelworks_system_log_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('âœ… ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
                showNotification('ì‹œìŠ¤í…œ ë¡œê·¸ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
                
            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                showNotification('ì‹œìŠ¤í…œ ë¡œê·¸ ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³ ê¸‰ ì„¤ì • ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showSystemSettings() {
            console.log('âš™ï¸ ê³ ê¸‰ ì„¤ì • ì—´ê¸°');
            
            // ê³ ê¸‰ ì„¤ì • ëª¨ë‹¬ HTML ìƒì„±
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'advancedSettingsModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>âš™ï¸ ê³ ê¸‰ ì‹œìŠ¤í…œ ì„¤ì •</h2>
                        <button class="close-btn" onclick="hideAdvancedSettings()">&times;</button>
                    </div>
                    
                    <div style="max-height: 60vh; overflow-y: auto;">
                        <div class="form-group">
                            <h3>ğŸ”§ ì‹œìŠ¤í…œ ì„¤ì •</h3>
                            <label>
                                <input type="checkbox" id="enableDebugMode" ${localStorage.getItem('debugMode') === 'true' ? 'checked' : ''}> 
                                ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”
                            </label>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                ê°œë°œì ë„êµ¬ì— ìƒì„¸í•œ ë¡œê·¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableAutoBackup" ${localStorage.getItem('autoBackup') === 'true' ? 'checked' : ''}> 
                                ìë™ ë°±ì—… í™œì„±í™”
                            </label>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                ë§¤ì¼ ìì •ì— ìë™ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë°±ì—…í•©ë‹ˆë‹¤.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <h3>ğŸ“Š ì„±ëŠ¥ ì„¤ì •</h3>
                            <label for="cacheTimeout">ìºì‹œ ë§Œë£Œ ì‹œê°„ (ë¶„)</label>
                            <input type="number" id="cacheTimeout" value="${localStorage.getItem('cacheTimeout') || '60'}" min="1" max="1440">
                            <small style="display: block; color: #666; margin-top: 5px;">
                                ë°ì´í„° ìºì‹œê°€ ë§Œë£Œë˜ëŠ” ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxLogEntries">ìµœëŒ€ ë¡œê·¸ í•­ëª© ìˆ˜</label>
                            <input type="number" id="maxLogEntries" value="${localStorage.getItem('maxLogEntries') || '1000'}" min="100" max="10000">
                            <small style="display: block; color: #666; margin-top: 5px;">
                                ì‹œìŠ¤í…œì—ì„œ ë³´ê´€í•  ìµœëŒ€ ë¡œê·¸ í•­ëª© ìˆ˜ì…ë‹ˆë‹¤.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <h3>ğŸ›¡ï¸ ë³´ì•ˆ ì„¤ì •</h3>
                            <label>
                                <input type="checkbox" id="enableSecurityLog" ${localStorage.getItem('securityLog') === 'true' ? 'checked' : ''}> 
                                ë³´ì•ˆ ë¡œê·¸ í™œì„±í™”
                            </label>
                            <small style="display: block; color: #666; margin-top: 5px;">
                                ë¡œê·¸ì¸, ê¶Œí•œ ë³€ê²½ ë“±ì˜ ë³´ì•ˆ ê´€ë ¨ í™œë™ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <h3>ğŸ¨ UI ì„¤ì •</h3>
                            <label for="themeMode">í…Œë§ˆ ëª¨ë“œ</label>
                            <select id="themeMode">
                                <option value="light" ${localStorage.getItem('themeMode') === 'light' ? 'selected' : ''}>ë¼ì´íŠ¸ ëª¨ë“œ</option>
                                <option value="dark" ${localStorage.getItem('themeMode') === 'dark' ? 'selected' : ''}>ë‹¤í¬ ëª¨ë“œ</option>
                                <option value="auto" ${(!localStorage.getItem('themeMode') || localStorage.getItem('themeMode') === 'auto') ? 'selected' : ''}>ìë™</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                            <div class="action-buttons" style="gap: 10px;">
                                <button onclick="resetAllData()" class="btn btn-danger">
                                    <i class="fas fa-exclamation-triangle"></i> ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                                </button>
                                <button onclick="repairDatabase()" class="btn btn-warning">
                                    <i class="fas fa-wrench"></i> ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬
                                </button>
                                <button onclick="optimizeDatabase()" class="btn btn-info">
                                    <i class="fas fa-tachometer-alt"></i> ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group" style="margin-top: 20px;">
                        <button onclick="saveAdvancedSettings()" class="btn-submit">ì„¤ì • ì €ì¥</button>
                        <button onclick="hideAdvancedSettings()" class="btn-cancel">ì·¨ì†Œ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        // ê³ ê¸‰ ì„¤ì • ì €ì¥ í•¨ìˆ˜
        function saveAdvancedSettings() {
            try {
                localStorage.setItem('debugMode', document.getElementById('enableDebugMode').checked);
                localStorage.setItem('autoBackup', document.getElementById('enableAutoBackup').checked);
                localStorage.setItem('cacheTimeout', document.getElementById('cacheTimeout').value);
                localStorage.setItem('maxLogEntries', document.getElementById('maxLogEntries').value);
                localStorage.setItem('securityLog', document.getElementById('enableSecurityLog').checked);
                localStorage.setItem('themeMode', document.getElementById('themeMode').value);
                
                console.log('âœ… ê³ ê¸‰ ì„¤ì • ì €ì¥ ì™„ë£Œ');
                showNotification('ì‹œìŠ¤í…œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                hideAdvancedSettings();
                
                // ì„¤ì • ì ìš©
                applySystemSettings();
                
            } catch (error) {
                console.error('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                showNotification('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ê³ ê¸‰ ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
        function hideAdvancedSettings() {
            const modal = document.getElementById('advancedSettingsModal');
            if (modal) {
                modal.remove();
            }
        }

        // ì‹œìŠ¤í…œ ì„¤ì • ì ìš© í•¨ìˆ˜
        function applySystemSettings() {
            // í…Œë§ˆ ì ìš©
            const themeMode = localStorage.getItem('themeMode') || 'auto';
            if (themeMode === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (themeMode === 'light') {
                document.body.classList.remove('dark-theme');
            } else {
                // ìë™ ëª¨ë“œ - ì‹œìŠ¤í…œ ì„¤ì •ì— ë”°ë¼
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
            }
        }

        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
        function resetAllData() {
            if (!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            if (!confirm('ğŸ”´ ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n- ëª¨ë“  íšŒì‚¬ ì •ë³´\n- ëª¨ë“  ì‚¬ìš©ì ì •ë³´\n- ëª¨ë“  ì„¤ì •\n- ëª¨ë“  ë¡œê·¸')) {
                return;
            }
            
            try {
                // localStorage ì™„ì „ ì´ˆê¸°í™”
                localStorage.clear();
                
                // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
                allCompanies = [];
                allUsers = [];
                
                console.log('ğŸ”´ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                showNotification('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.', 'success');
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„° ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ í•¨ìˆ˜
        async function repairDatabase() {
            console.log('ğŸ”§ ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ ì‹œì‘');
            showNotification('ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            try {
                // ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ë° ë³µêµ¬
                let repairedCount = 0;
                
                // 1. íšŒì‚¬ ë°ì´í„° ê²€ì‚¬
                allCompanies.forEach((company, index) => {
                    if (!company.id || !company.company_name) {
                        console.log(`ğŸ”§ íšŒì‚¬ ë°ì´í„° ë³µêµ¬: ì¸ë±ìŠ¤ ${index}`);
                        if (!company.id) company.id = Date.now() + index;
                        if (!company.company_name) company.company_name = `íšŒì‚¬ ${index + 1}`;
                        repairedCount++;
                    }
                });
                
                // 2. ì‚¬ìš©ì ë°ì´í„° ê²€ì‚¬
                allUsers.forEach((user, index) => {
                    if (!user.id || !user.name) {
                        console.log(`ğŸ”§ ì‚¬ìš©ì ë°ì´í„° ë³µêµ¬: ì¸ë±ìŠ¤ ${index}`);
                        if (!user.id) user.id = Date.now() + index;
                        if (!user.name) user.name = `ì‚¬ìš©ì ${index + 1}`;
                        repairedCount++;
                    }
                });
                
                console.log(`âœ… ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ ì™„ë£Œ (${repairedCount}ê°œ í•­ëª© ë³µêµ¬)`);
                showNotification(`ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (${repairedCount}ê°œ í•­ëª© ë³µêµ¬)`, 'success');
                
                // UI ìƒˆë¡œê³ ì¹¨
                await loadDashboardData();
                updateStatistics();
                
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” í•¨ìˆ˜
        function optimizeDatabase() {
            console.log('âš¡ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” ì‹œì‘');
            showNotification('ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            try {
                let optimizedCount = 0;
                
                // ì¤‘ë³µ ì œê±°
                const uniqueCompanies = allCompanies.filter((company, index, self) => 
                    index === self.findIndex(c => c.id === company.id)
                );
                const uniqueUsers = allUsers.filter((user, index, self) => 
                    index === self.findIndex(u => u.id === user.id)
                );
                
                optimizedCount += (allCompanies.length - uniqueCompanies.length);
                optimizedCount += (allUsers.length - uniqueUsers.length);
                
                allCompanies = uniqueCompanies;
                allUsers = uniqueUsers;
                
                // ë¶ˆí•„ìš”í•œ localStorage í•­ëª© ì •ë¦¬
                const unnecessary = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('temp_') || key.includes('cache_old_'))) {
                        unnecessary.push(key);
                    }
                }
                unnecessary.forEach(key => localStorage.removeItem(key));
                optimizedCount += unnecessary.length;
                
                console.log(`âš¡ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” ì™„ë£Œ (${optimizedCount}ê°œ í•­ëª© ì •ë¦¬)`);
                showNotification(`ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (${optimizedCount}ê°œ í•­ëª© ì •ë¦¬)`, 'success');
                
                // UI ìƒˆë¡œê³ ì¹¨
                updateStatistics();
                
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë§ˆì§€ë§‰ ë°±ì—… ì‹œê°„ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getLastBackupTime() {
            const lastBackup = localStorage.getItem('lastBackupTime');
            if (lastBackup) {
                return new Date(lastBackup).toLocaleDateString('ko-KR');
            }
            return 'ë°±ì—… ì—†ìŒ';
        }

        // ë§ˆì§€ë§‰ ë°±ì—… ì‹œê°„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLastBackupTime() {
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            renderSystemSettings(); // ì‹œìŠ¤í…œ ì„¤ì • í™”ë©´ ìƒˆë¡œê³ ì¹¨
        }


        // ëª¨ë“  íšŒì‚¬ë¥¼ Scout í…œí”Œë¦¿ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
        function setAllCompaniesToScout() {
            console.log('ğŸ¨ ëª¨ë“  íšŒì‚¬ë¥¼ Scout í…œí”Œë¦¿ìœ¼ë¡œ ì„¤ì • ì‹œì‘');
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            let updatedCount = 0;
            
            companies.forEach(company => {
                if (company.templateSelect !== 'scout') {
                    company.templateSelect = 'scout';
                    updatedCount++;
                }
            });
            
            localStorage.setItem('platform_companies', JSON.stringify(companies));
            
            if (updatedCount > 0) {
                console.log(`âœ… ${updatedCount}ê°œ íšŒì‚¬ì˜ í…œí”Œë¦¿ì„ Scoutìœ¼ë¡œ ë³€ê²½ ì™„ë£Œ`);
                showNotification(`${updatedCount}ê°œ íšŒì‚¬ì˜ í…œí”Œë¦¿ì´ Scoutìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                updateCompanyList();
            } else {
                console.log('â„¹ï¸ ëª¨ë“  íšŒì‚¬ê°€ ì´ë¯¸ Scout í…œí”Œë¦¿ ì‚¬ìš© ì¤‘');
                showNotification('ëª¨ë“  íšŒì‚¬ê°€ ì´ë¯¸ Scout í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤', 'info');
            }
        }

        // ê¸°ì¡´ íšŒì‚¬ ë°ì´í„° ì •ë¦¬
        function cleanupOldCompanyData() {
            console.log('ğŸ§¹ ê¸°ì¡´ íšŒì‚¬ ë°ì´í„° ì •ë¦¬ ì‹œì‘...');
            
            // ê¸°ì¡´ 5ê°œ íšŒì‚¬ ë°ì´í„° ì‚­ì œ
            localStorage.removeItem('platform_companies');
            
            console.log('âœ… ê¸°ì¡´ íšŒì‚¬ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
        }
        
        // STEP 1: ëª¨ë“  ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì •ë¦¬
        function cleanAllEmployeeData() {
            console.log('ğŸ§¹ ëª¨ë“  ê¸°ì¡´ ì§ì› ë°ì´í„° ì™„ì „ ì •ë¦¬ ì‹œì‘...');
            
            // ëª¨ë“  í”Œë˜ê·¸ ì œê±°
            localStorage.removeItem('employees_reset_v2');
            localStorage.removeItem('employees_reset_v3');
            localStorage.removeItem('employees_fixed_v4');
            localStorage.removeItem('employees_initialized');
            
            // ëª¨ë“  íšŒì‚¬ë³„ ì§ì› ë°ì´í„° ì‚­ì œ
            const companyIds = ['test-company-1', 'test-company-2', 'test-company-3', 'seokyoung-snt', 'posco', 'hyundai-steel', 'namkyung-steel', 'new-test-company'];
            companyIds.forEach(companyId => {
                localStorage.removeItem(`company_${companyId}_employees`);
                console.log(`ğŸ—‘ï¸ ${companyId} ì§ì› ë°ì´í„° ì‚­ì œ`);
            });
            
            // í†µí•© ì§ì› ëª©ë¡ ì‚­ì œ
            localStorage.removeItem('employees');
            console.log('ğŸ—‘ï¸ í†µí•© ì§ì› ëª©ë¡ ì‚­ì œ');
            
            console.log('âœ… ëª¨ë“  ê¸°ì¡´ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
        }
        
        // ìƒ˜í”Œ ì§ì› ë°ì´í„° ìƒì„± í•¨ìˆ˜ ì œê±°ë¨ - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì œ ì§ì› ë°ì´í„° ì‚¬ìš©
        function createExactEmployeeData() {
            console.log('ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì œ ì§ì› ë°ì´í„° ì‚¬ìš© - ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì•ˆí•¨');
            return 0;
        }
        
        // STEP 3: íšŒì‚¬ë³„ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateCompanyUserCounts() {
            console.log('ğŸ“Š íšŒì‚¬ë³„ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            
            companies.forEach(company => {
                const companyKey = `company_${company.id}_employees`;
                const employees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                company.users = employees.length;
                console.log(`ğŸ“Š ${company.companyName || company.name}: ${employees.length}ëª…`);
            });
            
            localStorage.setItem('platform_companies', JSON.stringify(companies));
            console.log('âœ… íšŒì‚¬ë³„ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            
            return companies.reduce((sum, company) => sum + company.users, 0);
        }
        
        // STEP 4: ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
        function fixAllCompanyEmployees() {
            console.log('ğŸ”§ ì§ì› ë°ì´í„° ì •ë¦¬ í”„ë¡œì„¸ìŠ¤ ì‹œì‘...');
            
            try {
                // 1ë‹¨ê³„: ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì •ë¦¬
                cleanAllEmployeeData();
                
                // 2ë‹¨ê³„: ì •í™•í•œ ì§ì› ë°ì´í„° ìƒì„±
                const totalEmployees = createExactEmployeeData();
                
                // 3ë‹¨ê³„: íšŒì‚¬ë³„ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
                const totalUsers = updateCompanyUserCounts();
                
                // 4ë‹¨ê³„: UI ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    updateStatistics();
                    updateCompanyList();
                }, 300);
                
                console.log(`ğŸ‰ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ! ì´ ${totalUsers}ëª… (3ê°œ íšŒì‚¬ Ã— 3ëª…)`);
                showNotification(`ì§ì› ë°ì´í„° ì •ë¦¬ ì™„ë£Œ: ì´ ${totalUsers}ëª…`, 'success');
                
            } catch (error) {
                console.error('âŒ ì§ì› ë°ì´í„° ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                showNotification('ì§ì› ë°ì´í„° ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¦¬ì…‹ í•¨ìˆ˜
        function resetTestData() {
            if (confirm('ëª¨ë“  í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì¶”ê°€í•œ ì§ì› ì •ë³´ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                console.log('ğŸ”„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¦¬ì…‹ ì‹œì‘');
                
                // ì´ˆê¸°í™” í”Œë˜ê·¸ ì œê±°
                localStorage.removeItem('test_companies_initialized_v1');
                
                // ëª¨ë“  ë°ì´í„° ì •ë¦¬
                cleanupOldCompanyData();
                cleanAllEmployeeData();
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                window.location.reload();
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¶Œí•œ ì²´í¬
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('steelplatform_currentUser') || localStorage.getItem('currentUser') || '{}');
            
            console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser); // ë””ë²„ê¹…ìš©
            
            // ë§ˆìŠ¤í„°ê°€ ì•„ë‹ˆë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸
            if (!currentUser || currentUser.role !== 'master') {
                console.log('ë§ˆìŠ¤í„° ê¶Œí•œ ì—†ìŒ:', currentUser.role); // ë””ë²„ê¹…ìš©
                alert('ë§ˆìŠ¤í„° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '../../1-homepage/templates/index.html';
                return;
            }
            
            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            const userInfoElement = document.querySelector('.user-info');
            if (userInfoElement) {
                userInfoElement.innerHTML = `
                    <i class="fas fa-crown" style="color: gold;"></i> ${currentUser.name || 'ë§ˆìŠ¤í„° ê´€ë¦¬ì'}
                `;
            }
            
            // ì •í™•í•œ ìˆœì„œë¡œ ì´ˆê¸°í™” ì‹¤í–‰
            console.log('ğŸš€ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
            
            // ì´ˆê¸° ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
            const isInitialized = localStorage.getItem('test_companies_initialized_v1');
            
            if (!isInitialized) {
                console.log('ğŸ”„ ìµœì´ˆ ì‹¤í–‰ - ë°ì´í„° ì´ˆê¸°í™”');
                
                // 1. ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì •ë¦¬
                cleanupOldCompanyData();
                
                // 2. íšŒì‚¬ ëª©ë¡ ì´ˆê¸°í™” (users: 0ìœ¼ë¡œ ì„¤ì •)
                updateCompanyList();
                
                // 3. ì§ì› ë°ì´í„° ì •ë¦¬ (ê° íšŒì‚¬ë‹¹ ì •í™•íˆ 3ëª…)
                fixAllCompanyEmployees();
                
                // 4. ëŒ€í‘œ ë°ì´í„° ìƒì„± (ìµœì´ˆ ì‹¤í–‰ ì‹œì—ë§Œ)
                console.log('ğŸ”„ ìµœì´ˆ ì‹¤í–‰ - ëŒ€í‘œ ë°ì´í„° ìƒì„±');
                ensureRepresentativesExistOnce();
                
                // ì´ˆê¸°í™” ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì •
                localStorage.setItem('test_companies_initialized_v1', 'true');
                
                console.log('âœ… ìµœì´ˆ ì´ˆê¸°í™” ì™„ë£Œ');
            } else {
                console.log('âœ… ì´ë¯¸ ì´ˆê¸°í™”ë¨ - ê¸°ì¡´ ë°ì´í„° ìœ ì§€');
                
                // íšŒì‚¬ ëª©ë¡ë§Œ ì—…ë°ì´íŠ¸ (ì§ì› ë°ì´í„°ëŠ” ìœ ì§€)
                updateCompanyList();
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStatistics();
                
                // íšŒì‚¬ ëŒ€í‘œ ë°ì´í„° í™•ì¸ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
                console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€í‘œ ë°ì´í„° í™•ì¸');
                ensureRepresentativesExistOnce();
                
                // ì‚¬ìš©ì ëª©ë¡ ì´ˆê¸°í™”
                renderUsersList();
            }
            
            console.log('âœ… ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ì‚¬ìš©ì í¸ì§‘ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ë°±ì—…ìš©)
            const editUserForm = document.getElementById('editUserForm');
            if (editUserForm) {
                editUserForm.addEventListener('submit', function(e) {
                    console.log('ğŸ”¥ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë°œìƒ! (ë°±ì—… ë¦¬ìŠ¤ë„ˆ)');
                    handleEditUser(e);
                });
                console.log('âœ… í¸ì§‘ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ë¨');
            }
            
            // ìë™ ì¬ìƒì„± ì œê±° - ì´ì œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œì—ë§Œ ì—…ë°ì´íŠ¸
        });

        // ì´ë²¤íŠ¸ ê¸°ë°˜ í†µê³„ ì—…ë°ì´íŠ¸ (ìë™ ìƒˆë¡œê³ ì¹¨ ì œê±°)
        // setInterval ì œê±° - ì´ì œ ì´ë²¤íŠ¸ ë°œìƒ ì‹œì—ë§Œ ì—…ë°ì´íŠ¸
        
        // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œ í†µê³„ ì—…ë°ì´íŠ¸
        document.addEventListener('click', function(e) {
            // íŠ¹ì • ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í†µê³„ ì—…ë°ì´íŠ¸
            if (e.target.closest('.tab-btn') || 
                e.target.closest('.btn-primary') || 
                e.target.closest('.btn-secondary') ||
                e.target.closest('.add-new-btn')) {
                
                console.log('ğŸ”„ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ìœ¼ë¡œ ì¸í•œ í†µê³„ ì—…ë°ì´íŠ¸');
                setTimeout(() => {
                    updateStatistics();
                }, 100);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
            
            // ìƒ˜í”Œ ë°ì´í„° ì •ë¦¬
            cleanupSampleData();
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ë¡œë“œ
            await loadDashboardData();
            
            // ë°ì´í„° ë¡œë“œ í™•ì¸
            console.log('ğŸ“Š ë¡œë“œëœ ë°ì´í„° í™•ì¸:');
            console.log(`  - allCompanies: ${allCompanies.length}ê°œ`);
            console.log(`  - allUsers: ${allUsers.length}ëª…`);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStatistics();
            
            // ê¸°ë³¸ íƒ­ í™œì„±í™”
            showTab('companies');
            
            console.log('âœ… ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>

</body>
</html>