<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant 템플릿 관리자 대시보드 - SteelWorks Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 50%, #003d7a 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .admin-dashboard {
            display: block;
            min-height: 100vh;
        }

        .admin-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .admin-content {
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .data-grid {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .grid-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
        }

        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            font-weight: 600;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #2d3748;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 1);
        }

        .form-select option {
            background: #ffffff;
            color: #2d3748;
            padding: 0.5rem;
            font-weight: 500;
        }

        .form-select option:hover {
            background: #e2e8f0;
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(45, 55, 72, 0.6);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .employee-table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-table th,
        .employee-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-weight: 700;
        }

        .employee-table td {
            color: #e2e8f0;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .role-master {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .role-admin {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .role-manager {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .role-employee {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal[style*="block"] {
            display: flex !important;
        }

        .modal-content {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            padding: 2rem;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            color: white;
            max-height: 95vh;
            overflow-y: auto;
            min-height: 700px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .employee-card, .permission-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-info h4, .permission-info h4 {
            margin: 0 0 0.5rem 0;
            color: #ffffff;
            font-size: 1.2rem;
        }

        .employee-info p, .permission-info p {
            margin: 0.25rem 0;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .employee-actions, .permission-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-actions .btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            min-width: 120px;
        }

        /* 메인 관리 카드 스타일 */
        .management-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        .management-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 3rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .management-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .management-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .management-card i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }

        .management-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .management-card p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .homepage-card {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .homepage-management-card {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .employees-card {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .permissions-card {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .status-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
            }

            .admin-nav {
                justify-content: center;
            }

            .form-row {
                flex-direction: column;
            }

            .admin-content {
                padding: 1rem;
            }

            .management-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .management-title {
                font-size: 2rem;
            }

            .management-card {
                min-height: 150px;
                padding: 1.5rem;
            }

            .management-card i {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .management-card h3 {
                font-size: 1.25rem;
            }

            .management-card p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-cogs"></i>
                <span id="companyTitle">Instant 템플릿 - 관리자 대시보드</span>
            </div>
            <div class="admin-nav">
            </div>
        </header>

        <!-- Content -->
        <main class="admin-content">
            <div class="management-container" style="display: flex;">
                <h1 class="management-title">Instant 템플릿 관리</h1>
                
                <div class="management-grid">
                    <a href="../../1-homepage/templates/index.html" class="management-card homepage-card" target="_blank">
                        <i class="fas fa-home"></i>
                        <h3>홈페이지</h3>
                        <p>실제 웹사이트를 확인하고 변경된 내용을 미리 볼 수 있습니다.</p>
                    </a>
                    
                    <a href="../../1-homepage/management/instant-homepage-management.html" class="management-card homepage-management-card" id="homepageManagementLink">
                        <i class="fas fa-globe"></i>
                        <h3>홈페이지 관리</h3>
                        <p>메인페이지와 상세페이지의 콘텐츠를 편집하고 관리합니다.</p>
                    </a>
                    
                    <button class="management-card employees-card" onclick="showEmployeeManagement()">
                        <i class="fas fa-users"></i>
                        <h3>직원 관리</h3>
                        <p>직원 정보를 추가, 수정, 삭제하고 역할을 관리합니다.</p>
                    </button>
                    
                    <button class="management-card permissions-card" onclick="showPermissionManagement()">
                        <i class="fas fa-shield-alt"></i>
                        <h3>권한 설정</h3>
                        <p>사용자별 접근 권한과 기능 권한을 설정합니다.</p>
                    </button>
                </div>
            </div>
            <section class="content-section" id="employees" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> 대시보드로 돌아가기
                </button>
                <h2 class="section-title">직원 관리</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">직원 목록</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="console.log('⚙️ 설정 버튼 클릭됨'); window.openEmployeeSettingsModal(); return false;" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                                <i class="fas fa-cog"></i> 설정
                            </button>
                            <button class="btn" onclick="console.log('➕ 직원 추가 버튼 클릭됨'); window.openEmployeeModal(); return false;">
                                <i class="fas fa-plus"></i> 직원 추가
                            </button>
                        </div>
                    </div>
                    <div style="padding: 2rem;">
                        <div id="employeeList">
                            <!-- 직원 목록이 여기에 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 권한 설정 섹션 -->
            <section class="content-section" id="permissions" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> 대시보드로 돌아가기
                </button>
                <h2 class="section-title">권한 설정</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">권한 관리</h3>
                        <button class="btn" onclick="openPermissionModal()">
                            <i class="fas fa-plus"></i> 권한 추가
                        </button>
                    </div>
                    <div style="padding: 2rem;">
                        <div id="permissionList">
                            <!-- 권한 목록이 여기에 로드됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 권한 모달 -->
                <div id="permissionModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>권한 설정</h3>
                            <button class="close" onclick="closePermissionModal()">&times;</button>
                        </div>
                        <form id="permissionForm">
                            <div class="form-group">
                                <label class="form-label">권한명</label>
                                <input type="text" class="form-input" id="permissionName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">설명</label>
                                <textarea class="form-textarea" id="permissionDescription"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">접근 권한</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="canRead"> 읽기</label>
                                    <label><input type="checkbox" id="canWrite"> 쓰기</label>
                                    <label><input type="checkbox" id="canDelete"> 삭제</label>
                                    <label><input type="checkbox" id="canManage"> 관리</label>
                                </div>
                            </div>
                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" onclick="closePermissionModal()">취소</button>
                                <button type="submit" class="btn btn-primary">저장</button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </main>

        <!-- 직원 모달 (최상위 레벨) -->
        <div id="employeeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">직원 정보</h3>
                    <button class="close" onclick="window.closeEmployeeModal()">&times;</button>
                </div>
                <form id="employeeForm" onsubmit="event.preventDefault(); console.log('📤 폼 제출됨'); window.saveEmployee(); return false;">
                    <!-- 첫 번째 행: 이름과 이메일 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">이름</label>
                            <input type="text" class="form-input" id="employeeName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">이메일</label>
                            <input type="email" class="form-input" id="employeeEmail" required>
                        </div>
                    </div>
                    
                    <!-- 두 번째 행: 권한과 연락처 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">권한</label>
                            <select class="form-select" id="employeeRole" required>
                                <option value="">권한을 선택하세요</option>
                                <option value="employee">직원</option>
                                <option value="manager">관리자</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">연락처</label>
                            <input type="tel" class="form-input" id="employeePhone">
                        </div>
                    </div>
                    
                    <!-- 세 번째 행: 소속 부서와 직책 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">소속 부서</label>
                            <select class="form-select" id="employeeDepartment" required>
                                <option value="">부서를 선택하세요</option>
                                <!-- 동적으로 로드됩니다 -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">직책</label>
                            <select class="form-select" id="employeePosition" required>
                                <option value="">직책을 선택하세요</option>
                                <!-- 동적으로 로드됩니다 -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- 버튼 영역 -->
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.closeEmployeeModal()">취소</button>
                        <button type="submit" class="btn btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 직원 설정 모달 -->
        <div id="employeeSettingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>직원 관리 설정</h3>
                    <button class="close" onclick="closeEmployeeSettingsModal()">&times;</button>
                </div>
                <div style="padding: 1rem;">
                    <!-- 부서 관리 -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #e2e8f0; margin-bottom: 1rem;">부서 관리</h4>
                        <div id="departmentsList" style="margin-bottom: 1rem;">
                            <!-- 현재 부서들이 여기에 표시됩니다 -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newDepartmentInput" class="form-input" placeholder="새 부서명 입력" style="flex: 1;">
                            <button class="btn" onclick="addDepartment()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-plus"></i> 추가
                            </button>
                        </div>
                    </div>
                    
                    <!-- 직책 관리 -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #e2e8f0; margin-bottom: 1rem;">직책 관리</h4>
                        <div id="positionsList" style="margin-bottom: 1rem;">
                            <!-- 현재 직책들이 여기에 표시됩니다 -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newPositionInput" class="form-input" placeholder="새 직책명 입력" style="flex: 1;">
                            <button class="btn" onclick="addPosition()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-plus"></i> 추가
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEmployeeSettingsModal()">닫기</button>
                </div>
            </div>
        </div>

        <!-- 상태 표시 -->
        <div id="statusIndicator" class="status-indicator">
            <div class="status-item">
                <span id="dataStatus">💾 데이터: 로딩 중...</span>
            </div>
        </div>
    </div>

    <script>
        // 인증 관리자 (AuthManager) - Scout와 동일한 기능
        class AuthManager {
            static setCurrentUser(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            }

            static getCurrentUser() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            }

            static logout() {
                localStorage.removeItem('currentUser');
                window.location.href = '../employee/employee-dashboard.html';
            }
        }

        // 전역 변수
        let currentTemplate = 'instant';
        let currentEditingEmployee = null;
        let currentEditingPermission = null;

        // 회사명 업데이트 함수
        function updateCompanyTitle(companyId) {
            console.log('🏢 Instant 템플릿 회사명 업데이트:', companyId);
            
            if (!companyId) {
                console.log('❌ companyId가 없습니다');
                return;
            }
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            const company = companies.find(c => c.id === companyId);
            
            const companyNameMap = {
                'seokyoung-snt': '서경 S&T',
                'posco': '포스코 철강',
                'hyundai-steel': '현대제철',
                'namkyung-steel': '남경스틸',
                'new-test-company': '새로운테스트회사',
                '': '대한철강' // Instant 템플릿 기본값
            };
            
            const companyName = company?.companyName || companyNameMap[companyId] || companyId;
            const titleElement = document.getElementById('companyTitle');
            
            console.log('📋 찾은 회사 정보:', {
                companyId,
                company,
                companyName,
                titleElement: !!titleElement
            });
            
            if (titleElement) {
                const newTitle = `${companyName} - Instant 템플릿 관리`;
                titleElement.textContent = newTitle;
                document.title = newTitle;
                console.log('✅ 회사명 업데이트 완료:', newTitle);
                
                // 홈페이지 관리 링크도 업데이트
                const homepageLink = document.getElementById('homepageManagementLink');
                if (homepageLink) {
                    homepageLink.href = `instant-homepage-management.html?company=${companyId}`;
                    console.log('🔗 홈페이지 관리 링크 업데이트:', homepageLink.href);
                }
            } else {
                console.log('❌ titleElement를 찾을 수 없습니다');
            }
        }

        // 상태 업데이트 함수
        function updateStatus() {
            const statusElement = document.getElementById('dataStatus');
            const data = localStorage.getItem(`template_instant_settings`);
            
            if (data) {
                const parsed = JSON.parse(data);
                const companyName = parsed.basic?.companyName || '미설정';
                statusElement.innerHTML = `💾 데이터: ✅ 저장됨 (${companyName})`;
            } else {
                statusElement.innerHTML = '💾 데이터: ❌ 없음';
            }
        }
        
        // 이벤트 핸들러 함수들 (Scout과 동일)
        function handleEditClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('📝 수정 버튼 클릭 (핸들러):', employeeId);
            editEmployee(employeeId);
        }

        function handleDeleteClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('🗑️ 삭제 버튼 클릭 (핸들러):', employeeId);
            deleteEmployee(employeeId);
        }

        // 전역 함수 등록 (Scout과 동일)
        window.editEmployee = editEmployee;
        window.simpleEditEmployee = simpleEditEmployee;
        window.deleteEmployee = deleteEmployee;
        window.openEmployeeModal = openEmployeeModal;
        window.closeEmployeeModal = closeEmployeeModal;
        window.saveEmployee = saveEmployee;
        window.backToDashboard = backToDashboard;
        window.showEmployeeManagement = showEmployeeManagement;
        window.showPermissionManagement = showPermissionManagement;
        window.handleEditClick = handleEditClick;
        window.handleDeleteClick = handleDeleteClick;
        window.openEmployeeSettingsModal = openEmployeeSettingsModal;
        window.closeEmployeeSettingsModal = closeEmployeeSettingsModal;
        window.addDepartment = addDepartment;
        window.addPosition = addPosition;
        window.removeDepartment = removeDepartment;
        window.removePosition = removePosition;

        // 페이지 로드 시 초기화 (Scout과 동일하지만 Instant 용으로 수정)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Instant 템플릿 관리자 대시보드 시작');
            
            const masterAccess = JSON.parse(localStorage.getItem('master_company_access') || '{}');
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            console.log('🔍 초기화 정보:', {
                masterAccess,
                companyId,
                currentUrl: window.location.href
            });
            
            let user = AuthManager.getCurrentUser();
            
            if (masterAccess.role === 'master' && companyId === masterAccess.companyId) {
                console.log('🔑 마스터 권한으로 Instant 템플릿 접근:', companyId);
                const masterUser = JSON.parse(localStorage.getItem('steelplatform_currentUser') || localStorage.getItem('currentUser') || '{}');
                if (masterUser.role === 'master') {
                    AuthManager.setCurrentUser(masterUser);
                    user = masterUser;
                    console.log('✅ 마스터 사용자 권한 설정 완료');
                }
                
                updateCompanyTitle(companyId);
            }
            
            if (!user) {
                const testMasterUser = {
                    id: 'master-001',
                    name: '시스템 관리자',
                    email: 'master@daehaniron.co.kr',
                    role: 'master',
                    department: '관리부',
                    position: '시스템 관리자'
                };
                AuthManager.setCurrentUser(testMasterUser);
                user = testMasterUser;
                console.log('✅ 테스트용 마스터 사용자 자동 로그인');
            }
            
            if (!hasAdminPermission(user)) {
                alert('관리자 권한이 필요합니다.');
                console.log('❌ 권한 없음:', user);
                return;
            }
            
            console.log('✅ 현재 사용자:', user);
            
            if (companyId) {
                updateCompanyTitle(companyId);
            } else {
                const titleElement = document.getElementById('companyTitle');
                if (titleElement) {
                    titleElement.textContent = 'Instant 템플릿 - 관리자 대시보드';
                    document.title = 'Instant 템플릿 - 관리자 대시보드';
                }
            }
            
            loadData();
            initializeTestEmployees();
            setupEventListeners();
            updateStatus();
            updateEmployeeFormOptions();
            
            setTimeout(() => {
                console.log('🔄 직원 목록 강제 렌더링 시작');
                renderEmployeeList();
                
                setTimeout(() => {
                    const employeeList = document.getElementById('employeeList');
                    console.log('📋 직원 목록 컨테이너:', employeeList);
                    console.log('🔄 직원 목록 HTML:', employeeList?.innerHTML?.substring(0, 200) + '...');
                    
                    const editButtons = document.querySelectorAll('.edit-employee-btn');
                    console.log('📝 수정 버튼 개수:', editButtons.length);
                    editButtons.forEach((btn, index) => {
                        console.log(`수정 버튼 ${index}:`, btn);
                    });
                    
                    const modal = document.getElementById('employeeModal');
                    console.log('🎭 모달 요소:', modal);
                    
                    console.log('🔧 simpleEditEmployee 함수:', window.simpleEditEmployee);
                    console.log('➕ openEmployeeModal 함수:', window.openEmployeeModal);
                }, 200);
            }, 500);
            
            document.addEventListener('click', function(e) {
                if (e.target.closest('.management-card, .btn, .nav-btn')) {
                    setTimeout(updateStatus, 100);
                }
            });
            
            document.addEventListener('submit', function(e) {
                setTimeout(updateStatus, 100);
            });
        });

        function hasAdminPermission(user) {
            const adminRoles = ['master', 'company_admin', 'company_manager'];
            return adminRoles.includes(user.role);
        }

        function canManageEmployees(user) {
            const managerRoles = ['master', 'company_admin', 'company_manager'];
            return managerRoles.includes(user.role);
        }

        function isSystemUser(role) {
            return ['master', 'company_admin'].includes(role);
        }

        function updateRoleOptions(currentUser, employeeId = null) {
            const roleSelect = document.getElementById('employeeRole');
            
            let options = '<option value="">권한을 선택하세요</option>';
            options += '<option value="employee">직원</option>';
            options += '<option value="manager">관리자</option>';
            
            roleSelect.innerHTML = options;
        }

        // Scout의 직원 관리 함수들을 그대로 사용하되 Instant용 키 사용
        function renderEmployeeList() {
            console.log('🔄 Instant 템플릿 직원 목록 렌더링 시작');
            
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            console.log('🏢 현재 회사 ID:', companyId);
            
            let employees = [];
            
            if (companyId) {
                const companyKey = `instant_company_${companyId}_employees`;
                const companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log(`📁 ${companyKey}에서 ${companyEmployees.length}명 발견`);
                
                if (companyEmployees.length > 0) {
                    employees = companyEmployees;
                } else {
                    const allEmployees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
                    employees = allEmployees.filter(emp => emp.companyId === companyId);
                    console.log(`📁 통합 목록에서 ${employees.length}명 필터링`);
                }
            } else {
                employees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
                console.log(`📁 모든 직원: ${employees.length}명`);
            }
            
            const employeeList = document.getElementById('employeeList');
            const currentUser = AuthManager.getCurrentUser();
            
            console.log('👥 표시할 직원 수:', employees.length);
            console.log('👤 현재 사용자:', currentUser);
            
            if (employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #9ca3af;">등록된 직원이 없습니다.</p>';
                return;
            }
            
            const htmlContent = employees.map(emp => {
                const isSystemUser = ['master', 'company_admin'].includes(emp.role);
                const canEdit = canManageEmployees(currentUser) && (!isSystemUser || currentUser.role === 'master');
                const canDelete = canManageEmployees(currentUser) && !isSystemUser;
                
                console.log(`👤 ${emp.name}: canEdit=${canEdit}, canDelete=${canDelete}, isSystemUser=${isSystemUser}`);
                
                return `
                    <div class="employee-card" data-employee-id="${emp.id}">
                        <div class="employee-info">
                            <h4>${emp.name} ${isSystemUser ? '<i class="fas fa-shield-alt" style="color: #f59e0b; margin-left: 0.5rem;" title="시스템 사용자"></i>' : ''}</h4>
                            <p>${emp.email}</p>
                            <p>${emp.department || '미설정'} | ${emp.position || '미설정'}</p>
                            <span class="role-badge role-${emp.role}">${getRoleText(emp.role)}</span>
                        </div>
                        <div class="employee-actions">
                            ${canEdit ? `
                                <button type="button" class="btn btn-small edit-employee-btn" data-employee-id="${emp.id}" onclick="console.log('📝 수정 버튼 클릭: ${emp.id}'); try { window.simpleEditEmployee('${emp.id}'); } catch(e) { console.error('수정 오류:', e); alert('수정 오류: ' + e.message); } return false;">
                                    <i class="fas fa-edit"></i> 수정
                                </button>
                            ` : ''}
                            ${canDelete ? `
                                <button type="button" class="btn btn-small btn-danger delete-employee-btn" data-employee-id="${emp.id}" onclick="console.log('🗑️ 삭제 버튼 클릭: ${emp.id}'); window.deleteEmployee('${emp.id}'); return false;">
                                    <i class="fas fa-trash"></i> 삭제
                                </button>
                            ` : ''}
                            ${!canEdit && !canDelete ? `
                                <span style="color: #6b7280; font-size: 0.8rem;">권한 없음</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            employeeList.innerHTML = htmlContent;
            
            setTimeout(() => {
                const editButtons = document.querySelectorAll('.edit-employee-btn');
                console.log('📝 수정 버튼 찾음:', editButtons.length);
                
                editButtons.forEach((btn, index) => {
                    console.log(`수정 버튼 ${index}:`, btn.getAttribute('data-employee-id'));
                    btn.removeEventListener('click', handleEditClick);
                    btn.addEventListener('click', handleEditClick);
                });
                
                const deleteButtons = document.querySelectorAll('.delete-employee-btn');
                console.log('🗑️ 삭제 버튼 찾음:', deleteButtons.length);
                
                deleteButtons.forEach((btn, index) => {
                    console.log(`삭제 버튼 ${index}:`, btn.getAttribute('data-employee-id'));
                    btn.removeEventListener('click', handleDeleteClick);
                    btn.addEventListener('click', handleDeleteClick);
                });
                
                console.log('✅ Instant 템플릿 직원 목록 렌더링 및 이벤트 리스너 등록 완료');
            }, 100);
        }

        function initializeTestEmployees() {
            console.log('💡 Instant 템플릿 직원 데이터는 master-dashboard.html에서 관리됩니다.');
            renderEmployeeList();
            return;
        }

        function getTemplateName(templateId) {
            const names = {
                'instant': '대한철강',
                'scout': '한국철강',
                'visible': '비전스틸',
                'dewi': '동양철강',
                'nice-restaurant': '한일철강',
                'iportfolio': '포항철강',
                'blogy': '한국산업',
                'gp': '글로벌철강',
                'upconstruction': '대한중공업'
            };
            return names[templateId] || templateId;
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            document.getElementById('employeeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEmployee();
            });

            document.getElementById('permissionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                savePermission();
            });
        }

        function switchSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            const targetBtn = document.querySelector(`[data-section="${sectionId}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
        }

        function loadData() {
            loadEmployees();
            loadPermissions();
        }

        function loadEmployees() {
            renderEmployeeList();
        }

        function getRoleText(role) {
            const roleTexts = {
                'employee': '직원',
                'manager': '매니저',
                'company_admin': '회사 관리자',
                'master': '마스터'
            };
            return roleTexts[role] || role;
        }

        function openEmployeeModal(employeeId = null) {
            console.log('🔵 Instant 템플릿 openEmployeeModal 호출됨. employeeId:', employeeId);
            
            try {
                const currentUser = AuthManager.getCurrentUser();
                console.log('👤 현재 사용자:', currentUser);
                
                if (!canManageEmployees(currentUser)) {
                    alert('직원 관리 권한이 없습니다.');
                    console.log('❌ 권한 체크 실패');
                    return;
                }
                
                console.log('✅ 권한 체크 통과');
                
                currentEditingEmployee = employeeId;
                const modal = document.getElementById('employeeModal');
                const form = document.getElementById('employeeForm');
                
                console.log('🎯 모달 요소:', modal);
                console.log('📝 폼 요소:', form);
                
                if (!modal) {
                    console.error('❌ 모달 요소를 찾을 수 없습니다!');
                    alert('모달을 찾을 수 없습니다. 페이지를 새로고침해주세요.');
                    return;
                }
                
                if (!form) {
                    console.error('❌ 폼 요소를 찾을 수 없습니다!');
                    alert('폼을 찾을 수 없습니다. 페이지를 새로고침해주세요.');
                    return;
                }
                
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                console.log('📖 모달 표시됨');
                
                form.reset();
                console.log('🔄 폼 초기화 완료');
                
                try {
                    updateRoleOptions(currentUser, employeeId);
                    updateEmployeeFormOptions();
                    console.log('⚙️ 권한 옵션 설정 완료');
                } catch (error) {
                    console.error('❌ 권한 옵션 설정 실패:', error);
                }
                
                if (employeeId) {
                    console.log('📝 직원 수정 모드');
                    
                    const urlParams = new URLSearchParams(window.location.search);
                    const companyId = urlParams.get('company');
                    
                    let employee = null;
                    
                    if (companyId) {
                        const companyKey = `instant_company_${companyId}_employees`;
                        const companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                        employee = companyEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    if (!employee) {
                        const allEmployees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
                        employee = allEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    console.log('👤 수정할 직원:', employee);
                    
                    if (employee) {
                        const nameEl = document.getElementById('employeeName');
                        const emailEl = document.getElementById('employeeEmail');
                        const deptEl = document.getElementById('employeeDepartment');
                        const posEl = document.getElementById('employeePosition');
                        const phoneEl = document.getElementById('employeePhone');
                        const roleEl = document.getElementById('employeeRole');
                        
                        if (nameEl) nameEl.value = employee.name || '';
                        if (emailEl) emailEl.value = employee.email || '';
                        if (deptEl) deptEl.value = employee.department || '';
                        if (posEl) posEl.value = employee.position || '';
                        if (phoneEl) phoneEl.value = employee.phone || '';
                        if (roleEl) roleEl.value = employee.role || '';
                        
                        if (roleEl && isSystemUser(employee.role) && currentUser.role !== 'master') {
                            roleEl.disabled = true;
                        } else if (roleEl) {
                            roleEl.disabled = false;
                        }
                        
                        console.log('✅ 직원 정보 로드 완료');
                    }
                } else {
                    console.log('➕ 직원 추가 모드');
                    const roleEl = document.getElementById('employeeRole');
                    if (roleEl) roleEl.disabled = false;
                }
                
                console.log('🎉 모달 열기 완료');
                
            } catch (error) {
                console.error('❌ openEmployeeModal 오류:', error);
                alert('모달을 여는 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function closeEmployeeModal() {
            console.log('❌ 직원 모달 닫기');
            const modal = document.getElementById('employeeModal');
            modal.style.display = 'none';
            currentEditingEmployee = null;
            
            const form = document.getElementById('employeeForm');
            if (form) {
                form.reset();
            }
            
            const roleSelect = document.getElementById('employeeRole');
            if (roleSelect) {
                roleSelect.disabled = false;
            }
        }

        function saveEmployee() {
            const currentUser = AuthManager.getCurrentUser();
            
            if (!canManageEmployees(currentUser)) {
                alert('직원 관리 권한이 없습니다.');
                return;
            }
            
            const name = document.getElementById('employeeName').value.trim();
            const email = document.getElementById('employeeEmail').value.trim();
            const role = document.getElementById('employeeRole').value;
            const department = document.getElementById('employeeDepartment').value.trim();
            const position = document.getElementById('employeePosition').value.trim();
            const phone = document.getElementById('employeePhone').value.trim();
            
            if (!name || !email || !role) {
                alert('이름, 이메일, 권한은 필수 입력 항목입니다.');
                return;
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `instant_company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
            }
            const allEmployees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
            
            if (currentEditingEmployee) {
                const companyIndex = companyEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                const allIndex = allEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                
                if (companyIndex !== -1) {
                    const originalEmployee = companyEmployees[companyIndex];
                    
                    if (isSystemUser(originalEmployee.role) && currentUser.role !== 'master') {
                        alert('마스터만 시스템 사용자의 권한을 변경할 수 있습니다.');
                        return;
                    }
                    
                    if (isSystemUser(role) && currentUser.role !== 'master') {
                        alert('마스터만 시스템 권한(마스터, 회사대표)을 부여할 수 있습니다.');
                        return;
                    }
                    
                    const updatedEmployee = {
                        ...originalEmployee,
                        name,
                        email,
                        role,
                        department,
                        position,
                        phone,
                        updatedAt: new Date().toISOString()
                    };
                    
                    companyEmployees[companyIndex] = updatedEmployee;
                    
                    if (allIndex !== -1) {
                        allEmployees[allIndex] = updatedEmployee;
                    }
                }
            } else {
                if (isSystemUser(role) && currentUser.role !== 'master') {
                    alert('마스터만 시스템 권한(마스터, 회사대표)을 부여할 수 있습니다.');
                    return;
                }
                
                const newEmployee = {
                    id: Date.now().toString(),
                    name,
                    email,
                    role,
                    department,
                    position,
                    phone,
                    companyId: companyId,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (companyId) {
                    companyEmployees.push(newEmployee);
                }
                
                allEmployees.push(newEmployee);
            }
            
            if (companyId) {
                const companyKey = `instant_company_${companyId}_employees`;
                localStorage.setItem(companyKey, JSON.stringify(companyEmployees));
            }
            localStorage.setItem('instant_employees', JSON.stringify(allEmployees));
            
            renderEmployeeList();
            
            if (typeof window.syncEmployeeCount === 'function') {
                window.syncEmployeeCount(companyId);
                console.log('🔄 마스터 대시보드에 직원 수 동기화');
            }
            
            closeEmployeeModal();
            
            console.log('💾 Instant 템플릿 직원 데이터 저장 완료:', companyEmployees.find(emp => emp.id === (currentEditingEmployee || companyEmployees[companyEmployees.length - 1]?.id)));
        }

        function editEmployee(employeeId) {
            console.log('🔧🔧🔧 Instant 템플릿 editEmployee 함수 호출됨! employeeId:', employeeId);
            
            try {
                console.log('⚡ 즉시 모달 열기 시도');
                openEmployeeModal(employeeId);
                
            } catch (error) {
                console.error('❌ editEmployee 오류:', error);
                alert('수정 중 오류 발생: ' + error.message);
            }
        }

        function simpleEditEmployee(employeeId) {
            console.log('🔥 Instant 템플릿 simpleEditEmployee 호출됨:', employeeId);
            openEmployeeModal(employeeId);
        }

        function deleteEmployee(employeeId) {
            const currentUser = AuthManager.getCurrentUser();
            
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `instant_company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
            }
            const allEmployees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
            
            const employee = companyEmployees.find(emp => emp.id === employeeId) || 
                           allEmployees.find(emp => emp.id === employeeId);
            
            if (!employee) {
                return;
            }
            
            if (!canManageEmployees(currentUser)) {
                alert('직원 삭제 권한이 없습니다.');
                return;
            }
            
            if (isSystemUser(employee.role)) {
                alert('시스템 사용자(마스터, 회사대표)는 삭제할 수 없습니다.');
                return;
            }
            
            if (!confirm(`정말로 ${employee.name} 직원을 삭제하시겠습니까?`)) {
                return;
            }
            
            if (companyId) {
                const filteredCompanyEmployees = companyEmployees.filter(emp => emp.id !== employeeId);
                const companyKey = `instant_company_${companyId}_employees`;
                localStorage.setItem(companyKey, JSON.stringify(filteredCompanyEmployees));
            }
            
            const filteredAllEmployees = allEmployees.filter(emp => emp.id !== employeeId);
            localStorage.setItem('instant_employees', JSON.stringify(filteredAllEmployees));
            
            renderEmployeeList();
            
            if (typeof window.syncEmployeeCount === 'function') {
                window.syncEmployeeCount(companyId);
                console.log('🔄 마스터 대시보드에 직원 수 동기화');
            }
            
            alert('직원이 삭제되었습니다.');
        }

        // 권한 관리 함수들 (Scout과 동일하지만 Instant용 키 사용)
        function loadPermissions() {
            const permissions = JSON.parse(localStorage.getItem('instant_permissions') || '[]');
            const permissionList = document.getElementById('permissionList');
            
            if (permissions.length === 0) {
                permissionList.innerHTML = '<p style="text-align: center; color: #9ca3af;">설정된 권한이 없습니다.</p>';
                return;
            }
            
            permissionList.innerHTML = permissions.map(perm => `
                <div class="permission-card">
                    <div class="permission-info">
                        <h4>${perm.name}</h4>
                        <p>${perm.description || '설명 없음'}</p>
                        <div class="permission-badges">
                            ${perm.canRead ? '<span class="badge">읽기</span>' : ''}
                            ${perm.canWrite ? '<span class="badge">쓰기</span>' : ''}
                            ${perm.canDelete ? '<span class="badge">삭제</span>' : ''}
                            ${perm.canManage ? '<span class="badge">관리</span>' : ''}
                        </div>
                    </div>
                    <div class="permission-actions">
                        <button class="btn btn-small" onclick="editPermission('${perm.id}')">
                            <i class="fas fa-edit"></i> 수정
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deletePermission('${perm.id}')">
                            <i class="fas fa-trash"></i> 삭제
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openPermissionModal(permissionId = null) {
            currentEditingPermission = permissionId;
            const modal = document.getElementById('permissionModal');
            const form = document.getElementById('permissionForm');
            
            form.reset();
            
            if (permissionId) {
                const permissions = JSON.parse(localStorage.getItem('instant_permissions') || '[]');
                const permission = permissions.find(perm => perm.id === permissionId);
                
                if (permission) {
                    document.getElementById('permissionName').value = permission.name;
                    document.getElementById('permissionDescription').value = permission.description || '';
                    document.getElementById('canRead').checked = permission.canRead || false;
                    document.getElementById('canWrite').checked = permission.canWrite || false;
                    document.getElementById('canDelete').checked = permission.canDelete || false;
                    document.getElementById('canManage').checked = permission.canManage || false;
                }
            }
            
            modal.style.display = 'block';
        }

        function closePermissionModal() {
            document.getElementById('permissionModal').style.display = 'none';
            currentEditingPermission = null;
        }

        function savePermission() {
            const name = document.getElementById('permissionName').value.trim();
            const description = document.getElementById('permissionDescription').value.trim();
            const canRead = document.getElementById('canRead').checked;
            const canWrite = document.getElementById('canWrite').checked;
            const canDelete = document.getElementById('canDelete').checked;
            const canManage = document.getElementById('canManage').checked;
            
            if (!name) {
                alert('권한명은 필수 입력 항목입니다.');
                return;
            }
            
            const permissions = JSON.parse(localStorage.getItem('instant_permissions') || '[]');
            
            if (currentEditingPermission) {
                const index = permissions.findIndex(perm => perm.id === currentEditingPermission);
                if (index !== -1) {
                    permissions[index] = {
                        ...permissions[index],
                        name,
                        description,
                        canRead,
                        canWrite,
                        canDelete,
                        canManage,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                const newPermission = {
                    id: Date.now().toString(),
                    name,
                    description,
                    canRead,
                    canWrite,
                    canDelete,
                    canManage,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                permissions.push(newPermission);
            }
            
            localStorage.setItem('instant_permissions', JSON.stringify(permissions));
            loadPermissions();
            closePermissionModal();
            
            alert(currentEditingPermission ? '권한이 수정되었습니다.' : '권한이 추가되었습니다.');
        }

        function editPermission(permissionId) {
            openPermissionModal(permissionId);
        }

        function deletePermission(permissionId) {
            if (!confirm('정말로 이 권한을 삭제하시겠습니까?')) {
                return;
            }
            
            const permissions = JSON.parse(localStorage.getItem('instant_permissions') || '[]');
            const filteredPermissions = permissions.filter(perm => perm.id !== permissionId);
            
            localStorage.setItem('instant_permissions', JSON.stringify(filteredPermissions));
            loadPermissions();
            
            alert('권한이 삭제되었습니다.');
        }

        function showEmployeeManagement() {
            const user = AuthManager.getCurrentUser();
            if (!user || !canManageEmployees(user)) {
                alert('직원 관리 권한이 없습니다. 마스터, 회사대표, 관리자만 접근 가능합니다.');
                return;
            }

            document.querySelector('.management-container').style.display = 'none';
            document.getElementById('employees').style.display = 'block';
        }

        function showPermissionManagement() {
            window.location.href = 'instant-company-admin.html';
        }

        function backToDashboard() {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.querySelector('.management-container').style.display = 'flex';
        }

        // 직원 설정 모달 관련 함수들 (Scout과 동일하지만 Instant용 키 사용)
        function openEmployeeSettingsModal() {
            console.log('⚙️ Instant 템플릿 직원 설정 모달 열기');
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'flex';
                loadDepartmentsAndPositions();
            } else {
                console.error('❌ 설정 모달을 찾을 수 없습니다');
            }
        }

        function closeEmployeeSettingsModal() {
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function loadDepartmentsAndPositions() {
            const departments = getDepartments();
            const positions = getPositions();
            
            renderDepartmentsList(departments);
            renderPositionsList(positions);
        }

        function getDepartments() {
            const saved = localStorage.getItem('instant_employee_departments');
            return saved ? JSON.parse(saved) : ['영업부', '관리부', '물류부'];
        }

        function getPositions() {
            const saved = localStorage.getItem('instant_employee_positions');
            return saved ? JSON.parse(saved) : ['이사', '부장', '차장', '과장', '대리', '계장'];
        }

        function saveDepartments(departments) {
            localStorage.setItem('instant_employee_departments', JSON.stringify(departments));
            updateEmployeeFormOptions();
        }

        function savePositions(positions) {
            localStorage.setItem('instant_employee_positions', JSON.stringify(positions));
            updateEmployeeFormOptions();
        }

        function renderDepartmentsList(departments) {
            const container = document.getElementById('departmentsList');
            if (!container) return;
            
            container.innerHTML = departments.map((dept, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${dept}</span>
                    <button class="btn btn-danger btn-small" onclick="removeDepartment('${dept}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderPositionsList(positions) {
            const container = document.getElementById('positionsList');
            if (!container) return;
            
            container.innerHTML = positions.map((pos, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${pos}</span>
                    <button class="btn btn-danger btn-small" onclick="removePosition('${pos}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function addDepartment() {
            const input = document.getElementById('newDepartmentInput');
            const newDept = input.value.trim();
            
            if (!newDept) {
                alert('부서명을 입력해주세요.');
                return;
            }
            
            const departments = getDepartments();
            if (departments.includes(newDept)) {
                alert('이미 존재하는 부서입니다.');
                return;
            }
            
            departments.push(newDept);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            input.value = '';
            
            alert('새 부서가 추가되었습니다.');
        }

        function addPosition() {
            const input = document.getElementById('newPositionInput');
            const newPos = input.value.trim();
            
            if (!newPos) {
                alert('직책명을 입력해주세요.');
                return;
            }
            
            const positions = getPositions();
            if (positions.includes(newPos)) {
                alert('이미 존재하는 직책입니다.');
                return;
            }
            
            positions.push(newPos);
            savePositions(positions);
            renderPositionsList(positions);
            input.value = '';
            
            alert('새 직책이 추가되었습니다.');
        }

        function removeDepartment(deptToRemove) {
            const employees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
            const employeesUsingDept = employees.filter(emp => emp.department === deptToRemove);
            
            if (employeesUsingDept.length > 0) {
                alert(`'${deptToRemove}' 부서를 사용하는 직원이 ${employeesUsingDept.length}명 있습니다. 먼저 해당 직원들의 부서를 변경해주세요.`);
                return;
            }
            
            if (!confirm(`'${deptToRemove}' 부서를 삭제하시겠습니까?`)) {
                return;
            }
            
            const departments = getDepartments().filter(dept => dept !== deptToRemove);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            
            alert('부서가 삭제되었습니다.');
        }

        function removePosition(posToRemove) {
            const employees = JSON.parse(localStorage.getItem('instant_employees') || '[]');
            const employeesUsingPos = employees.filter(emp => emp.position === posToRemove);
            
            if (employeesUsingPos.length > 0) {
                alert(`'${posToRemove}' 직책을 사용하는 직원이 ${employeesUsingPos.length}명 있습니다. 먼저 해당 직원들의 직책을 변경해주세요.`);
                return;
            }
            
            if (!confirm(`'${posToRemove}' 직책을 삭제하시겠습니까?`)) {
                return;
            }
            
            const positions = getPositions().filter(pos => pos !== posToRemove);
            savePositions(positions);
            renderPositionsList(positions);
            
            alert('직책이 삭제되었습니다.');
        }

        function updateEmployeeFormOptions() {
            const departments = getDepartments();
            const positions = getPositions();
            
            const deptSelect = document.getElementById('employeeDepartment');
            const posSelect = document.getElementById('employeePosition');
            
            if (deptSelect) {
                const currentValue = deptSelect.value;
                let deptOptions = '<option value="">부서를 선택하세요</option>';
                departments.forEach(dept => {
                    deptOptions += `<option value="${dept}">${dept}</option>`;
                });
                deptSelect.innerHTML = deptOptions;
                deptSelect.value = currentValue;
            }
            
            if (posSelect) {
                const currentValue = posSelect.value;
                let posOptions = '<option value="">직책을 선택하세요</option>';
                positions.forEach(pos => {
                    posOptions += `<option value="${pos}">${pos}</option>`;
                });
                posSelect.innerHTML = posOptions;
                posSelect.value = currentValue;
            }
        }

        function goToMasterDashboard() {
            const currentUser = AuthManager.getCurrentUser();
            
            if (currentUser.role === 'master') {
                window.location.href = 'master-dashboard.html';
            } else {
                alert('마스터 권한이 필요합니다.');
            }
        }
        
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                AuthManager.logout();
                window.location.href = '../../1-homepage/templates/index.html';
            }
        }

    </script>
    <script src="../../shared-assets/js/platform.js"></script>
</body>
</html>