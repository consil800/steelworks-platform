<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - SteelWorks Platform</title>
    
    <!-- Supabase JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Database Manager -->
    <script src="database.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .admin-dashboard {
            display: block;
            min-height: 100vh;
        }

        .admin-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .admin-content {
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .data-grid {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .grid-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
        }

        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            font-weight: 600;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #ffffff !important;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.7);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff !important;
        }

        /* ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì˜µì…˜ ìŠ¤íƒ€ì¼ë§ */
        .form-select option {
            background: #2d3748;
            color: #ffffff;
            padding: 0.5rem;
            font-weight: 500;
        }

        .form-select option:hover {
            background: #4a5568;
            color: #ffffff;
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input::-webkit-input-placeholder, .form-textarea::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input::-moz-placeholder, .form-textarea::-moz-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-input:-ms-input-placeholder, .form-textarea:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .image-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload-area:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
        }

        .image-upload-area i {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1rem;
        }

        .employee-table {
            width: 100%;
            border-collapse: collapse;
        }

        .employee-table th,
        .employee-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-table th {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-weight: 700;
        }

        .employee-table td {
            color: #e2e8f0;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .role-master {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .role-admin {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .role-manager {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .role-employee {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .permission-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .permission-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .permission-item input[type="checkbox"] {
            margin-right: 0.75rem;
            transform: scale(1.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal[style*="block"] {
            display: flex !important;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 2rem;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            color: white;
            max-height: 95vh;
            overflow-y: auto;
            min-height: 700px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .employee-card, .permission-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .employee-info h4, .permission-info h4 {
            margin: 0 0 0.5rem 0;
            color: #ffffff;
            font-size: 1.2rem;
        }

        .employee-info p, .permission-info p {
            margin: 0.25rem 0;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .employee-actions, .permission-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-actions .btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            min-width: 120px;
        }

        /* ë©”ì¸ ê´€ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .management-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        .management-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 3rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .management-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .management-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .management-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .management-card i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }

        .management-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .management-card p {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .homepage-card {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .homepage-management-card {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .employees-card {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .permissions-card {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }

        .permission-badges {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        /* ì•Œë¦¼ ë°°ì§€ */
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
            }

            .admin-nav {
                justify-content: center;
            }

            .form-row {
                flex-direction: column;
            }

            .admin-content {
                padding: 1rem;
            }

            .management-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .management-title {
                font-size: 2rem;
            }

            .management-card {
                min-height: 150px;
                padding: 1.5rem;
            }

            .management-card i {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .management-card h3 {
                font-size: 1.25rem;
            }

            .management-card p {
                font-size: 0.9rem;
            }
        }

        /* ê¶Œí•œ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .permission-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .permission-tab {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .permission-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .permission-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
        }

        .permission-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem;
        }

        .permission-panel {
            display: none;
        }

        .permission-panel.active {
            display: block;
        }

        .permission-checkbox {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .permission-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .permission-checkbox input[type="checkbox"] {
            margin-right: 0.75rem;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .permission-checkbox label {
            color: #e2e8f0;
            cursor: pointer;
            flex: 1;
            margin: 0;
        }

        /* ë¬¸ì„œ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .document-management {
            width: 100%;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .template-header {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .template-actions {
            display: flex;
            gap: 0.5rem;
        }

        .template-content {
            padding: 1.5rem;
        }

        .template-preview {
            position: relative;
        }

        .btn-small {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a5568;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #10b981;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .document-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .document-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .document-template {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: #ffffff !important;
            resize: vertical;
            font-family: 'Noto Sans KR', sans-serif;
            padding: 1rem;
            line-height: 1.5;
        }

        .document-template:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff !important;
        }

        .document-template::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template::-moz-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .document-template:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ ìŠ¤íƒ€ì¼ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #10b981;
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #10b981;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .documents-grid {
                grid-template-columns: 1fr;
            }
            
            .document-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-cogs"></i>
                <span id="companyTitle">ë‚¨ê²½ìŠ¤í‹¸(ì£¼) - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</span>
            </div>
            <div class="admin-nav">
                <a href="employee-dashboard.html" class="nav-btn">
                    <i class="fas fa-users"></i>
                    ì§ì› ëŒ€ì‹œë³´ë“œ
                </a>
            </div>
        </header>

        <!-- Content -->
        <main class="admin-content">
            <div class="management-container" style="display: flex;">
                <h1 class="management-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                
                <div class="management-grid">
                    <a href="index.html" class="management-card homepage-card" target="_blank">
                        <i class="fas fa-home"></i>
                        <h3>í™ˆí˜ì´ì§€</h3>
                        <p>ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ê³  ë³€ê²½ëœ ë‚´ìš©ì„ ë¯¸ë¦¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </a>
                    
                    <button class="management-card employees-card" onclick="showEmployeeManagement()">
                        <i class="fas fa-users"></i>
                        <h3>ì§ì› ê´€ë¦¬</h3>
                        <p>ì§ì› ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ê³  ì—­í• ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card permissions-card" onclick="showPermissionManagement()">
                        <i class="fas fa-shield-alt"></i>
                        <h3>ê¶Œí•œ ì„¤ì •</h3>
                        <p>ì‚¬ìš©ìë³„ ì ‘ê·¼ ê¶Œí•œê³¼ ê¸°ëŠ¥ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card pending-members-card" onclick="showPendingMembers()">
                        <i class="fas fa-user-clock"></i>
                        <h3>ê°€ì… ìŠ¹ì¸</h3>
                        <p>ì‹ ê·œ ê°€ì… ì‹ ì²­ì„ ê²€í† í•˜ê³  ìŠ¹ì¸ ë˜ëŠ” ê±°ë¶€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card documents-card" onclick="showDocumentManagement()">
                        <i class="fas fa-file-alt"></i>
                        <h3>ë¬¸ì„œ ê´€ë¦¬</h3>
                        <p>ê°ì¢… ì„œë¥˜ í…œí”Œë¦¿ì„ ê´€ë¦¬í•˜ê³  ê²°ì¬ ì‹œìŠ¤í…œ í‘œì‹œ ì—¬ë¶€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </button>
                    
                    <button class="management-card corporate-card-card" onclick="openCorporateCardManagement()" style="position: relative;">
                        <i class="fas fa-credit-card"></i>
                        <span id="adminCardNotificationBadge" class="notification-badge" style="display: none;">0</span>
                        <h3>ë²•ì¸ì¹´ë“œ ê´€ë¦¬</h3>
                        <p>ë²•ì¸ì¹´ë“œ ì‚¬ìš© ë‚´ì—­ì„ ì¡°íšŒí•˜ê³  ìŠ¹ì¸/ë°˜ë ¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
                    </button>
                </div>
            </div>
            <section class="content-section" id="employees" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
                <h2 class="section-title">ì§ì› ê´€ë¦¬</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">ì§ì› ëª©ë¡</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="console.log('âš™ï¸ ì„¤ì • ë²„íŠ¼ í´ë¦­ë¨'); window.openEmployeeSettingsModal(); return false;" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                                <i class="fas fa-cog"></i> ì„¤ì •
                            </button>
                            <button class="btn" onclick="console.log('â• ì§ì› ì¶”ê°€ ë²„íŠ¼ í´ë¦­ë¨'); window.openEmployeeModal(); return false;">
                                <i class="fas fa-plus"></i> ì§ì› ì¶”ê°€
                            </button>
                        </div>
                    </div>
                    <div style="padding: 2rem;">
                        <div id="employeeList">
                            <!-- ì§ì› ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ê¶Œí•œ ì„¤ì • ì„¹ì…˜ -->
            <section class="content-section" id="permissions" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
                <h2 class="section-title">ê¶Œí•œ ì„¤ì •</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">ë©”ë‰´ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬</h3>
                        <button class="btn" onclick="savePermissions()" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i class="fas fa-save"></i> ê¶Œí•œ ì €ì¥
                        </button>
                    </div>
                    <div style="padding: 2rem;">
                        <!-- ë©”ë‰´ë³„ ê¶Œí•œ ì„¤ì • -->
                        <div style="margin-bottom: 2rem;">
                            <h4 style="color: #e2e8f0; margin-bottom: 1rem;">ë©”ë‰´ë³„ ì ‘ê·¼ ê¶Œí•œ</h4>
                            <div id="menuPermissions">
                                <!-- ì—…ë¬´ì¼ì§€ -->
                                <div class="permission-menu-item" style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                    <h5 style="color: #fff; margin-bottom: 1rem;">
                                        <i class="fas fa-file-alt"></i> ì—…ë¬´ì¼ì§€
                                    </h5>
                                    <div class="permission-tabs">
                                        <button class="permission-tab active" onclick="switchPermissionTab('worklog', 'department')">ë¶€ì„œë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('worklog', 'position')">ì§ê¸‰ë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('worklog', 'individual')">ê°œì¸ë³„</button>
                                    </div>
                                    <div id="worklog-permissions" class="permission-content">
                                        <div id="worklog-department" class="permission-panel active"></div>
                                        <div id="worklog-position" class="permission-panel" style="display: none;"></div>
                                        <div id="worklog-individual" class="permission-panel" style="display: none;"></div>
                                    </div>
                                </div>

                                <!-- ë²•ì¸ì¹´ë“œ ì‚¬ìš© -->
                                <div class="permission-menu-item" style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                    <h5 style="color: #fff; margin-bottom: 1rem;">
                                        <i class="fas fa-credit-card"></i> ë²•ì¸ì¹´ë“œ ì‚¬ìš©
                                    </h5>
                                    <div class="permission-tabs">
                                        <button class="permission-tab active" onclick="switchPermissionTab('corporate-card', 'department')">ë¶€ì„œë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('corporate-card', 'position')">ì§ê¸‰ë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('corporate-card', 'individual')">ê°œì¸ë³„</button>
                                    </div>
                                    <div id="corporate-card-permissions" class="permission-content">
                                        <div id="corporate-card-department" class="permission-panel active"></div>
                                        <div id="corporate-card-position" class="permission-panel" style="display: none;"></div>
                                        <div id="corporate-card-individual" class="permission-panel" style="display: none;"></div>
                                    </div>
                                </div>

                                <!-- ê²°ì œ ì„œë¥˜ -->
                                <div class="permission-menu-item" style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                                    <h5 style="color: #fff; margin-bottom: 1rem;">
                                        <i class="fas fa-file-invoice"></i> ê²°ì œ ì„œë¥˜
                                    </h5>
                                    <div class="permission-tabs">
                                        <button class="permission-tab active" onclick="switchPermissionTab('documents', 'department')">ë¶€ì„œë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('documents', 'position')">ì§ê¸‰ë³„</button>
                                        <button class="permission-tab" onclick="switchPermissionTab('documents', 'individual')">ê°œì¸ë³„</button>
                                    </div>
                                    <div id="documents-permissions" class="permission-content">
                                        <div id="documents-department" class="permission-panel active"></div>
                                        <div id="documents-position" class="permission-panel" style="display: none;"></div>
                                        <div id="documents-individual" class="permission-panel" style="display: none;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ê°€ì… ìŠ¹ì¸ ì„¹ì…˜ -->
            <section class="content-section" id="pendingMembers" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
                <h2 class="section-title">ê°€ì… ìŠ¹ì¸ ê´€ë¦¬</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">ì‹ ê·œ ê°€ì… ì‹ ì²­ ëª©ë¡</h3>
                        <button class="btn" onclick="refreshPendingMembers()">
                            <i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                    <div style="padding: 2rem;">
                        <div id="pendingMembersList">
                            <!-- ì‹ ì²­ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ë¬¸ì„œ ê´€ë¦¬ ì„¹ì…˜ -->
            <section class="content-section" id="documents" style="display: none;">
                <button class="btn btn-secondary" onclick="backToDashboard()" style="margin-bottom: 1rem;">
                    <i class="fas fa-arrow-left"></i> ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                </button>
                <h2 class="section-title">ë¬¸ì„œ ê´€ë¦¬</h2>
                
                <div class="data-grid">
                    <div class="grid-header">
                        <h3 class="grid-title">ì„œë¥˜ í…œí”Œë¦¿ ê´€ë¦¬</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="saveDocumentSettings()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
                            </button>
                        </div>
                    </div>
                    <div style="padding: 2rem;">
                        <div class="document-management">
                            <!-- ë¬¸ì„œ í…œí”Œë¦¿ ë¦¬ìŠ¤íŠ¸ -->
                            <div style="margin-bottom: 2rem;">
                                <h3 style="color: #ffffff; margin: 0;">ë¬¸ì„œ í…œí”Œë¦¿ ê´€ë¦¬</h3>
                            </div>

                            <!-- ë¬¸ì„œ í…œí”Œë¦¿ ì¹´ë“œë“¤ -->
                            <div id="documentTemplates" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem;">

                            </div>

                            <!-- í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ -->
                            <div id="templateEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
                                <div style="background: #2d3748; border-radius: 15px; padding: 2rem; width: 90%; max-width: 800px; max-height: 90%; overflow-y: auto;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                        <h3 style="color: #ffffff; margin: 0;">í…œí”Œë¦¿ í¸ì§‘</h3>
                                        <button onclick="closeTemplateEdit()" style="background: none; border: none; color: #ffffff; font-size: 1.5rem; cursor: pointer;">&times;</button>
                                    </div>
                                    <div style="margin-bottom: 1rem;">
                                        <label style="display: block; color: #ffffff; margin-bottom: 0.5rem;">í…œí”Œë¦¿ ì´ë¦„</label>
                                        <input type="text" id="templateEditName" style="width: 100%; padding: 0.75rem; border: 1px solid #4a5568; border-radius: 8px; background: #1a202c; color: #ffffff;">
                                    </div>
                                    <div style="margin-bottom: 2rem;">
                                        <label style="display: block; color: #ffffff; margin-bottom: 0.5rem;">í…œí”Œë¦¿ ë‚´ìš©</label>
                                        <textarea id="templateEditContent" style="width: 100%; height: 400px; padding: 0.75rem; border: 1px solid #4a5568; border-radius: 8px; background: #1a202c; color: #ffffff; font-family: monospace; font-size: 0.9rem; line-height: 1.6;"></textarea>
                                    </div>
                                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                        <button class="btn btn-secondary" onclick="closeTemplateEdit()">ì·¨ì†Œ</button>
                                        <button class="btn" onclick="saveTemplateEdit()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                            <i class="fas fa-save"></i> ì €ì¥
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
                            <div id="templatePreviewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000;">
                                <div style="background: #ffffff; border-radius: 15px; padding: 2rem; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem;">
                                        <h3 style="color: #333; margin: 0;">ë¯¸ë¦¬ë³´ê¸°</h3>
                                        <button onclick="closeTemplatePreview()" style="background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer;">&times;</button>
                                    </div>
                                    <div id="previewContent" style="color: #333; line-height: 1.8; white-space: pre-line;">
                                        <!-- ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                    </div>
                                    <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                                        <button class="btn btn-secondary" onclick="closeTemplatePreview()">ë‹«ê¸°</button>
                                        <button class="btn" onclick="printTemplate()" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                                            <i class="fas fa-print"></i> ì¸ì‡„
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ì§ì› ëª¨ë‹¬ (ìµœìƒìœ„ ë ˆë²¨) -->
        <div id="employeeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">ì§ì› ì •ë³´</h3>
                    <button class="close" onclick="window.closeEmployeeModal()">&times;</button>
                </div>
                <form id="employeeForm" onsubmit="event.preventDefault(); console.log('ğŸ“¤ í¼ ì œì¶œë¨'); window.saveEmployee(); return false;" novalidate>
                    <!-- ì²« ë²ˆì§¸ í–‰: ì´ë¦„ê³¼ ì´ë©”ì¼ -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì´ë¦„ *</label>
                            <input type="text" class="form-input" id="employeeName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì´ë©”ì¼ *</label>
                            <input type="email" class="form-input" id="employeeEmail" placeholder="example@company.com">
                        </div>
                    </div>
                    
                    <!-- ë‘ ë²ˆì§¸ í–‰: ê¶Œí•œê³¼ ì—°ë½ì²˜ -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ê¶Œí•œ *</label>
                            <select class="form-select" id="employeeRole">
                                <option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="employee">ì§ì›</option>
                                <option value="manager">ê´€ë¦¬ì</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì—°ë½ì²˜</label>
                            <input type="tel" class="form-input" id="employeePhone" placeholder="010-1234-5678">
                        </div>
                    </div>
                    
                    <!-- ì„¸ ë²ˆì§¸ í–‰: ì†Œì† ë¶€ì„œì™€ ì§ì±… -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì†Œì† ë¶€ì„œ</label>
                            <select class="form-select" id="employeeDepartment">
                                <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì§ì±…</label>
                            <select class="form-select" id="employeePosition">
                                <option value="">ì§ì±…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- ë²„íŠ¼ ì˜ì—­ -->
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.closeEmployeeModal()">ì·¨ì†Œ</button>
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ì§ì› ì„¤ì • ëª¨ë‹¬ -->
        <div id="employeeSettingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ì§ì› ê´€ë¦¬ ì„¤ì •</h3>
                    <button class="close" onclick="closeEmployeeSettingsModal()">&times;</button>
                </div>
                <div style="padding: 1rem;">
                    <!-- ë¶€ì„œ ê´€ë¦¬ -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #e2e8f0; margin-bottom: 1rem;">ë¶€ì„œ ê´€ë¦¬</h4>
                        <div id="departmentsList" style="margin-bottom: 1rem;">
                            <!-- í˜„ì¬ ë¶€ì„œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newDepartmentInput" class="form-input" placeholder="ìƒˆ ë¶€ì„œëª… ì…ë ¥" style="flex: 1;">
                            <button class="btn" onclick="addDepartment()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-plus"></i> ì¶”ê°€
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì§ì±… ê´€ë¦¬ -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #e2e8f0; margin-bottom: 1rem;">ì§ì±… ê´€ë¦¬</h4>
                        <div id="positionsList" style="margin-bottom: 1rem;">
                            <!-- í˜„ì¬ ì§ì±…ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newPositionInput" class="form-input" placeholder="ìƒˆ ì§ì±…ëª… ì…ë ¥" style="flex: 1;">
                            <button class="btn" onclick="addPosition()" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-plus"></i> ì¶”ê°€
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEmployeeSettingsModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>

        <!-- ìƒíƒœ í‘œì‹œ -->
        <div id="statusIndicator" class="status-indicator">
            <div class="status-item">
                <span id="dataStatus">ğŸ’¾ ë°ì´í„°: ë¡œë”© ì¤‘...</span>
            </div>
        </div>
    </div>

    <script>
        // ì¸ì¦ ê´€ë¦¬ì (AuthManager)
        class AuthManager {
            static setCurrentUser(user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
            }

            static getCurrentUser() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            }

            static logout() {
                localStorage.removeItem('currentUser');
                window.location.href = 'employee-dashboard.html';
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentTemplate = null;
        let currentEditingEmployee = null;
        let currentEditingPermission = null;

        // íšŒì‚¬ëª… ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCompanyTitle(companyId) {
            console.log('ğŸ¢ íšŒì‚¬ëª… ì—…ë°ì´íŠ¸:', companyId);
            
            if (!companyId) {
                console.log('âŒ companyIdê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const companies = JSON.parse(localStorage.getItem('platform_companies') || '[]');
            const company = companies.find(c => c.id === companyId);
            
            const companyNameMap = {
                'seokyoung-snt': 'ì„œê²½ S&T',
                'posco': 'í¬ìŠ¤ì½” ì² ê°•',
                'hyundai-steel': 'í˜„ëŒ€ì œì² ',
                'namkyung-steel': 'ë‚¨ê²½ìŠ¤í‹¸',
                'new-test-company': 'ìƒˆë¡œìš´í…ŒìŠ¤íŠ¸íšŒì‚¬',
                '': 'ë‚¨ê²½ìŠ¤í‹¸' // ë¹ˆ íŒŒë¼ë¯¸í„° ì²˜ë¦¬
            };
            
            const companyName = company?.companyName || companyNameMap[companyId] || companyId;
            const titleElement = document.getElementById('companyTitle');
            
            console.log('ğŸ“‹ ì°¾ì€ íšŒì‚¬ ì •ë³´:', {
                companyId,
                company,
                companyName,
                titleElement: !!titleElement
            });
            
            if (titleElement) {
                const newTitle = `${companyName} - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ`;
                titleElement.textContent = newTitle;
                document.title = newTitle;
                console.log('âœ… íšŒì‚¬ëª… ì—…ë°ì´íŠ¸ ì™„ë£Œ:', newTitle);
                
            } else {
                console.log('âŒ titleElementë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus() {
            const statusElement = document.getElementById('dataStatus');
            const data = localStorage.getItem(`template_${currentTemplate}_settings`);
            
            if (data) {
                const parsed = JSON.parse(data);
                const companyName = parsed.basic?.companyName || 'ë¯¸ì„¤ì •';
                statusElement.innerHTML = `ğŸ’¾ ë°ì´í„°: âœ… ì €ì¥ë¨ (${companyName})`;
            } else {
                statusElement.innerHTML = 'ğŸ’¾ ë°ì´í„°: âŒ ì—†ìŒ';
            }
        }
        
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
        function handleEditClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ (í•¸ë“¤ëŸ¬):', employeeId);
            editEmployee(employeeId);
        }

        function handleDeleteClick(e) {
            e.preventDefault();
            e.stopPropagation();
            const employeeId = this.getAttribute('data-employee-id');
            console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ í´ë¦­ (í•¸ë“¤ëŸ¬):', employeeId);
            deleteEmployee(employeeId);
        }

        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡ (onclickì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        window.editEmployee = editEmployee;
        window.simpleEditEmployee = simpleEditEmployee;
        window.deleteEmployee = deleteEmployee;
        window.openEmployeeModal = openEmployeeModal;
        window.closeEmployeeModal = closeEmployeeModal;
        window.saveEmployee = saveEmployee;
        window.backToDashboard = backToDashboard;
        window.showEmployeeManagement = showEmployeeManagement;
        window.showPermissionManagement = showPermissionManagement;
        window.handleEditClick = handleEditClick;
        window.handleDeleteClick = handleDeleteClick;
        window.openEmployeeSettingsModal = openEmployeeSettingsModal;
        window.closeEmployeeSettingsModal = closeEmployeeSettingsModal;
        window.addDepartment = addDepartment;
        window.addPosition = addPosition;
        window.removeDepartment = removeDepartment;
        window.removePosition = removePosition;
        window.showSection = showSection;
        window.handleHashChange = handleHashChange;
        window.testFormElementsAccessibility = testFormElementsAccessibility;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì‹œì‘');
            
            // localStorage ì´ˆê¸° ìƒíƒœ í™•ì¸
            console.log('ğŸ” í˜ì´ì§€ ë¡œë“œ ì‹œ localStorage ìƒíƒœ:');
            const initialEmployeesData = localStorage.getItem('employees');
            console.log('  ğŸ“ employees:', initialEmployeesData ? JSON.parse(initialEmployeesData).length + 'ëª…' : 'ì—†ìŒ');
            
            // ëª¨ë“  company_*_employees í‚¤ í™•ì¸
            const allKeys = Object.keys(localStorage);
            const companyKeys = allKeys.filter(key => key.startsWith('company_') && key.endsWith('_employees'));
            console.log('  ğŸ“ íšŒì‚¬ë³„ ì§ì› ë°ì´í„°:', companyKeys.length + 'ê°œ');
            companyKeys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    const parsed = JSON.parse(data);
                    console.log(`    ${key}: ${parsed.length}ëª…`);
                }
            });
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì§ì› ë°ì´í„° ì¬ë¡œë“œ ê°•í™”
            setTimeout(() => {
                console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ í›„ ì§ì› ë°ì´í„° ì¬í™•ì¸');
                const currentEmployeesData = localStorage.getItem('employees');
                if (currentEmployeesData) {
                    const employees = JSON.parse(currentEmployeesData);
                    console.log('ğŸ“Š ì§ì› ë°ì´í„° ì¬í™•ì¸:', employees.length + 'ëª…');
                } else {
                    console.log('âš ï¸ ì§ì› ë°ì´í„°ê°€ ì—†ìŒ!');
                }
                
                // ê°•ì œë¡œ ë‹¤ì‹œ ë Œë”ë§
                renderEmployeeList();
            }, 1000);
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì—ì„œ ì˜¨ ê²½ìš° ì²´í¬
            const masterAccess = JSON.parse(localStorage.getItem('master_company_access') || '{}');
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            console.log('ğŸ” ì´ˆê¸°í™” ì •ë³´:', {
                masterAccess,
                companyId,
                currentUrl: window.location.href
            });
            
            // ì•Œë¦¼ ì²´í¬
            setTimeout(() => {
                checkAdminNotifications();
            }, 500);
            
            let user = AuthManager.getCurrentUser();
            
            // ë§ˆìŠ¤í„° ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•œ ê²½ìš°
            if (masterAccess.role === 'master' && companyId === masterAccess.companyId) {
                console.log('ğŸ”‘ ë§ˆìŠ¤í„° ê¶Œí•œìœ¼ë¡œ íšŒì‚¬ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼:', companyId);
                const masterUser = JSON.parse(localStorage.getItem('steelplatform_currentUser') || localStorage.getItem('currentUser') || '{}');
                if (masterUser.role === 'master') {
                    AuthManager.setCurrentUser(masterUser);
                    user = masterUser;
                    console.log('âœ… ë§ˆìŠ¤í„° ì‚¬ìš©ì ê¶Œí•œ ì„¤ì • ì™„ë£Œ');
                }
                
                // íšŒì‚¬ëª… ì—…ë°ì´íŠ¸
                updateCompanyTitle(companyId);
            }
            
            if (!user) {
                // í…ŒìŠ¤íŠ¸ìš© ë§ˆìŠ¤í„° ì‚¬ìš©ì ìë™ ë¡œê·¸ì¸
                const testMasterUser = {
                    id: 'master-001',
                    name: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                    email: 'master@namkyungsteel.co.kr',
                    role: 'master',
                    department: 'ê´€ë¦¬ë¶€',
                    position: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì'
                };
                AuthManager.setCurrentUser(testMasterUser);
                user = testMasterUser;
                console.log('âœ… í…ŒìŠ¤íŠ¸ìš© ë§ˆìŠ¤í„° ì‚¬ìš©ì ìë™ ë¡œê·¸ì¸');
            }
            
            // ê¶Œí•œ í™•ì¸
            if (!hasAdminPermission(user)) {
                alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                console.log('âŒ ê¶Œí•œ ì—†ìŒ:', user);
                return;
            }
            
            console.log('âœ… í˜„ì¬ ì‚¬ìš©ì:', user);
            
            currentTemplate = localStorage.getItem('currentTemplateId') || 'scout';
            if (currentTemplate) {
                // íšŒì‚¬ëª… ë™ì  ì—…ë°ì´íŠ¸
                if (companyId) {
                    updateCompanyTitle(companyId);
                } else {
                    // URLì—ì„œ company íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ê²½ìš°, ê¸°ë³¸ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    const titleElement = document.getElementById('companyTitle');
                    if (titleElement) {
                        titleElement.textContent = 'í†µí•© ê´€ë¦¬ì - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
                        document.title = 'í†µí•© ê´€ë¦¬ì - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ';
                    }
                }
            }
            
            // ë°ì´í„° ì§€ì†ì„± ë³´ì¥
            ensureDataPersistence();
            
            // ë¨¼ì € ê¸°ì¡´ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³ , ì—†ì„ ë•Œë§Œ ì´ˆê¸°í™”
            loadEmployeesFromDatabase();
            loadData();
            setupEventListeners();
            updateStatus();
            updateEmployeeFormOptions(); // ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì´ˆê¸°í™”
            
            // ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ (ì—¬ëŸ¬ ë²ˆ ì‹œë„)
            setTimeout(() => {
                console.log('ğŸ”„ ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ ì‹œì‘ (1ì°¨)');
                renderEmployeeList();
                
                // 2ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„
                setTimeout(() => {
                    console.log('ğŸ”„ ì§ì› ëª©ë¡ ê°•ì œ ë Œë”ë§ ì‹œì‘ (2ì°¨)');
                    renderEmployeeList();
                    
                    // ë Œë”ë§ í™•ì¸
                    setTimeout(() => {
                        const employeeList = document.getElementById('employeeList');
                        console.log('ğŸ“‹ ì§ì› ëª©ë¡ ì»¨í…Œì´ë„ˆ:', employeeList);
                        console.log('ğŸ”„ ì§ì› ëª©ë¡ HTML:', employeeList?.innerHTML?.substring(0, 200) + '...');
                        
                        // ìˆ˜ì • ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸
                        const editButtons = document.querySelectorAll('.edit-employee-btn');
                        console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ ê°œìˆ˜:', editButtons.length);
                        editButtons.forEach((btn, index) => {
                            console.log(`ìˆ˜ì • ë²„íŠ¼ ${index}:`, btn);
                        });
                        
                        // ëª¨ë‹¬ í™•ì¸
                        const modal = document.getElementById('employeeModal');
                        console.log('ğŸ­ ëª¨ë‹¬ ìš”ì†Œ:', modal);
                        
                        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ ì „ì—­ ë“±ë¡ í™•ì¸
                        console.log('ğŸ”§ simpleEditEmployee í•¨ìˆ˜:', window.simpleEditEmployee);
                        console.log('â• openEmployeeModal í•¨ìˆ˜:', window.openEmployeeModal);
                    }, 500);
                }, 2000);
            }, 500);
            
            // ìƒíƒœëŠ” ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œë§Œ ì—…ë°ì´íŠ¸ (ìë™ ìƒˆë¡œê³ ì¹¨ ì œê±°)
            
            // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.addEventListener('click', function(e) {
                // ê´€ë¦¬ ë²„íŠ¼ë“¤ í´ë¦­ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (e.target.closest('.management-card, .btn, .nav-btn')) {
                    setTimeout(updateStatus, 100);
                }
            });
            
            // í¼ ì œì¶œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.addEventListener('submit', function(e) {
                setTimeout(updateStatus, 100);
            });
            
            // í•´ì‹œ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            window.addEventListener('hashchange', handleHashChange);
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ í•´ì‹œ í™•ì¸
            setTimeout(() => {
                handleHashChange();
            }, 100);
            
            // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ê°ì§€ (ì‚¬ìš©ìê°€ ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ê°”ë‹¤ê°€ ëŒì•„ì˜¬ ë•Œ)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    console.log('ğŸ“„ í˜ì´ì§€ê°€ ë‹¤ì‹œ í™œì„±í™”ë¨, localStorage ìƒíƒœ í™•ì¸');
                    const currentEmployeesData = localStorage.getItem('employees');
                    console.log('  ğŸ“ employees:', currentEmployeesData ? JSON.parse(currentEmployeesData).length + 'ëª…' : 'ì—†ìŒ');
                    
                    // í•­ìƒ ë‹¤ì‹œ ë Œë”ë§ (ì•ˆì •ì„± í–¥ìƒ)
                    console.log('ğŸ”„ í˜ì´ì§€ í™œì„±í™” ì‹œ ì§ì› ëª©ë¡ ì¬ë Œë”ë§');
                    renderEmployeeList();
                    
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°±ì—…ì—ì„œ ë³µì› ì‹œë„
                    if (!currentEmployeesData || JSON.parse(currentEmployeesData).length === 0) {
                        console.log('âš ï¸ ì§ì› ë°ì´í„°ê°€ ì‚¬ë¼ì¡ŒìŒ, ë°±ì—…ì—ì„œ ë³µì› ì‹œë„');
                        
                        // ë°±ì—… ë°ì´í„° ì°¾ê¸°
                        const allKeys = Object.keys(localStorage);
                        const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort().reverse();
                        
                        if (backupKeys.length > 0) {
                            const latestBackup = localStorage.getItem(backupKeys[0]);
                            if (latestBackup) {
                                localStorage.setItem('employees', latestBackup);
                                console.log('âœ… ë°±ì—…ì—ì„œ ë°ì´í„° ë³µì›:', backupKeys[0]);
                                renderEmployeeList();
                            }
                        }
                    }
                }
            });
            
            // ì¶”ê°€: localStorage ë³€ê²½ ê°ì§€ (storage ì´ë²¤íŠ¸)
            window.addEventListener('storage', function(e) {
                if (e.key === 'employees' || (e.key && e.key.includes('employees'))) {
                    console.log('ğŸ”„ localStorage employees ë°ì´í„° ë³€ê²½ ê°ì§€, ì¬ë Œë”ë§');
                    setTimeout(() => {
                        renderEmployeeList();
                    }, 100);
                }
            });
            
            // ì£¼ê¸°ì  ë°ì´í„° ì§€ì†ì„± ì²´í¬ (10ì´ˆë§ˆë‹¤)
            setInterval(() => {
                ensureDataPersistence();
            }, 10000);
            
            // beforeunload ì´ë²¤íŠ¸ì—ì„œ localStorage í™•ì¸ ë° ë°±ì—…
            window.addEventListener('beforeunload', function() {
                console.log('ğŸšª í˜ì´ì§€ ì¢…ë£Œ ì „ ë°ì´í„° ë°±ì—…');
                const currentEmployees = localStorage.getItem('employees');
                if (currentEmployees) {
                    try {
                        const employees = JSON.parse(currentEmployees);
                        if (employees && employees.length > 0) {
                            createDataBackup(employees);
                            console.log('âœ… ì¢…ë£Œ ì „ ë°ì´í„° ë°±ì—… ì™„ë£Œ');
                        }
                    } catch (error) {
                        console.error('âŒ ì¢…ë£Œ ì „ ë°±ì—… ì‹¤íŒ¨:', error);
                    }
                }
            });
        });

        function hasAdminPermission(user) {
            const adminRoles = ['master', 'company_admin', 'company_manager'];
            return adminRoles.includes(user.role);
        }

        // ì§ì› ê´€ë¦¬ ê¶Œí•œ ì²´í¬
        function canManageEmployees(user) {
            const managerRoles = ['master', 'company_admin', 'company_manager'];
            return managerRoles.includes(user.role);
        }

        // ê¶Œí•œ ìˆ˜ì • ë¶ˆê°€ ì‚¬ìš©ì ì²´í¬
        function isSystemUser(role) {
            return ['master', 'company_admin'].includes(role);
        }

        // ê¶Œí•œ ì˜µì…˜ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì, ì§ì›ë§Œ)
        function updateRoleOptions(currentUser, employeeId = null) {
            const roleSelect = document.getElementById('employeeRole');
            
            // ê´€ë¦¬ìì™€ ì§ì›ë§Œ ì„ íƒ ê°€ëŠ¥
            let options = '<option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>';
            options += '<option value="employee">ì§ì›</option>';
            options += '<option value="manager">ê´€ë¦¬ì</option>';
            
            roleSelect.innerHTML = options;
        }

        // ì§ì› ëª©ë¡ ë Œë”ë§
        function renderEmployeeList() {
            console.log('ğŸ”„ ì§ì› ëª©ë¡ ë Œë”ë§ ì‹œì‘');
            
            // URLì—ì„œ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            console.log('ğŸ¢ í˜„ì¬ íšŒì‚¬ ID:', companyId);
            
            // localStorage í˜„ì¬ ìƒíƒœ ë¡œê¹…
            console.log('ğŸ” í˜„ì¬ localStorage ìƒíƒœ:');
            const allData = localStorage.getItem('employees');
            console.log('  ğŸ“ employees:', allData ? JSON.parse(allData).length + 'ëª…' : 'ì—†ìŒ');
            
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                const companyData = localStorage.getItem(companyKey);
                console.log(`  ğŸ“ ${companyKey}:`, companyData ? JSON.parse(companyData).length + 'ëª…' : 'ì—†ìŒ');
            }
            
            let employees = [];
            
            // ë¨¼ì € íšŒì‚¬ë³„ ì§ì› ë°ì´í„° í™•ì¸
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                const companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log(`ğŸ“ ${companyKey}ì—ì„œ ${companyEmployees.length}ëª… ë°œê²¬`);
                
                if (companyEmployees.length > 0) {
                    employees = companyEmployees;
                    console.log('âœ… íšŒì‚¬ë³„ ë°ì´í„° ì‚¬ìš©:', employees.length + 'ëª…');
                } else {
                    // íšŒì‚¬ë³„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í†µí•© ëª©ë¡ì—ì„œ í•„í„°ë§
                    const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
                    employees = allEmployees.filter(emp => emp.companyId === companyId);
                    console.log(`ğŸ“ í†µí•© ëª©ë¡ì—ì„œ ${employees.length}ëª… í•„í„°ë§`);
                    
                    // í•„í„°ë§ëœ ê²°ê³¼ê°€ ìˆìœ¼ë©´ íšŒì‚¬ë³„ ì €ì¥ì†Œì—ë„ ì €ì¥
                    if (employees.length > 0) {
                        localStorage.setItem(companyKey, JSON.stringify(employees));
                        console.log('ğŸ’¾ íšŒì‚¬ë³„ ì €ì¥ì†Œì— ë°±ì—… ì €ì¥ ì™„ë£Œ');
                    }
                }
            } else {
                // íšŒì‚¬ IDê°€ ì—†ìœ¼ë©´ ëª¨ë“  ì§ì› í‘œì‹œ
                employees = JSON.parse(localStorage.getItem('employees') || '[]');
                console.log(`ğŸ“ ëª¨ë“  ì§ì›: ${employees.length}ëª…`);
            }
            
            const employeeList = document.getElementById('employeeList');
            const currentUser = AuthManager.getCurrentUser();
            
            console.log('ğŸ‘¥ í‘œì‹œí•  ì§ì› ìˆ˜:', employees.length);
            console.log('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì:', currentUser);
            
            // ì§ì› ë°ì´í„°ê°€ ìˆëŠ”ì§€ ë” ìì„¸íˆ í™•ì¸
            if (employees.length > 0) {
                console.log('ğŸ“‹ ì§ì› ëª©ë¡ ìƒ˜í”Œ:', employees.slice(0, 3).map(emp => ({ 
                    id: emp.id, 
                    name: emp.name, 
                    companyId: emp.companyId,
                    createdAt: emp.createdAt 
                })));
            }
            
            if (employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #9ca3af;">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const htmlContent = employees.map(emp => {
                const isSystemUser = ['master', 'company_admin'].includes(emp.role);
                const canEdit = canManageEmployees(currentUser) && (!isSystemUser || currentUser.role === 'master');
                const canDelete = canManageEmployees(currentUser) && !isSystemUser;
                
                console.log(`ğŸ‘¤ ${emp.name}: canEdit=${canEdit}, canDelete=${canDelete}, isSystemUser=${isSystemUser}`);
                
                return `
                    <div class="employee-card" data-employee-id="${emp.id}">
                        <div class="employee-info">
                            <h4>${emp.name} ${isSystemUser ? '<i class="fas fa-shield-alt" style="color: #f59e0b; margin-left: 0.5rem;" title="ì‹œìŠ¤í…œ ì‚¬ìš©ì"></i>' : ''}</h4>
                            <p>${emp.email}</p>
                            <p>${emp.department || 'ë¯¸ì„¤ì •'} | ${emp.position || 'ë¯¸ì„¤ì •'}</p>
                            <span class="role-badge role-${emp.role}">${getRoleText(emp.role)}</span>
                        </div>
                        <div class="employee-actions">
                            ${canEdit ? `
                                <button type="button" class="btn btn-small edit-employee-btn" data-employee-id="${emp.id}" onclick="console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ í´ë¦­: ${emp.id}'); try { window.simpleEditEmployee('${emp.id}'); } catch(e) { console.error('ìˆ˜ì • ì˜¤ë¥˜:', e); alert('ìˆ˜ì • ì˜¤ë¥˜: ' + e.message); } return false;">
                                    <i class="fas fa-edit"></i> ìˆ˜ì •
                                </button>
                            ` : ''}
                            ${canDelete ? `
                                <button type="button" class="btn btn-small btn-danger delete-employee-btn" data-employee-id="${emp.id}" onclick="console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ í´ë¦­: ${emp.id}'); window.deleteEmployee('${emp.id}'); return false;">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                            ` : ''}
                            ${!canEdit && !canDelete ? `
                                <span style="color: #6b7280; font-size: 0.8rem;">ê¶Œí•œ ì—†ìŒ</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            employeeList.innerHTML = htmlContent;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (onclick ë°±ì—…ìš©)
            setTimeout(() => {
                // ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const editButtons = document.querySelectorAll('.edit-employee-btn');
                console.log('ğŸ“ ìˆ˜ì • ë²„íŠ¼ ì°¾ìŒ:', editButtons.length);
                
                editButtons.forEach((btn, index) => {
                    console.log(`ìˆ˜ì • ë²„íŠ¼ ${index}:`, btn.getAttribute('data-employee-id'));
                    
                    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                    btn.removeEventListener('click', handleEditClick);
                    
                    // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    btn.addEventListener('click', handleEditClick);
                });
                
                // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const deleteButtons = document.querySelectorAll('.delete-employee-btn');
                console.log('ğŸ—‘ï¸ ì‚­ì œ ë²„íŠ¼ ì°¾ìŒ:', deleteButtons.length);
                
                deleteButtons.forEach((btn, index) => {
                    console.log(`ì‚­ì œ ë²„íŠ¼ ${index}:`, btn.getAttribute('data-employee-id'));
                    
                    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                    btn.removeEventListener('click', handleDeleteClick);
                    
                    // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    btn.addEventListener('click', handleDeleteClick);
                });
                
                console.log('âœ… ì§ì› ëª©ë¡ ë Œë”ë§ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            }, 100);
        }

        // ë°ì´í„° ë°±ì—… ë° ë³µì› ì‹œìŠ¤í…œ
        function createDataBackup(employees) {
            try {
                const timestamp = Date.now();
                const backupKey = `employees_backup_${timestamp}`;
                localStorage.setItem(backupKey, JSON.stringify(employees));
                console.log('ğŸ’¾ ë°ì´í„° ë°±ì—… ìƒì„±:', backupKey);
                
                // ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬ (ìµœê·¼ 10ê°œë§Œ ìœ ì§€)
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort();
                if (backupKeys.length > 10) {
                    const keysToRemove = backupKeys.slice(0, backupKeys.length - 10);
                    keysToRemove.forEach(key => {
                        localStorage.removeItem(key);
                        console.log('ğŸ—‘ï¸ ì˜¤ë˜ëœ ë°±ì—… ì œê±°:', key);
                    });
                }
            } catch (error) {
                console.error('âŒ ë°±ì—… ìƒì„± ì‹¤íŒ¨:', error);
            }
        }
        
        function restoreFromBackup() {
            try {
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort().reverse();
                
                if (backupKeys.length > 0) {
                    const latestBackup = localStorage.getItem(backupKeys[0]);
                    if (latestBackup) {
                        const employees = JSON.parse(latestBackup);
                        localStorage.setItem('employees', latestBackup);
                        console.log('âœ… ë°±ì—…ì—ì„œ ë°ì´í„° ë³µì›:', backupKeys[0], employees.length + 'ëª…');
                        return employees;
                    }
                }
            } catch (error) {
                console.error('âŒ ë°±ì—… ë³µì› ì‹¤íŒ¨:', error);
            }
            return null;
        }
        
        function ensureDataPersistence() {
            // ë°ì´í„° ì§€ì†ì„± ë³´ì¥ì„ ìœ„í•œ ì£¼ê¸°ì  ì²´í¬
            const currentData = localStorage.getItem('employees');
            if (!currentData || JSON.parse(currentData).length === 0) {
                console.log('âš ï¸ ì§ì› ë°ì´í„° ì†ì‹¤ ê°ì§€, ë³µì› ì‹œë„');
                const restored = restoreFromBackup();
                if (!restored) {
                    console.log('âš ï¸ ë°±ì—…ë„ ì—†ìŒ, ì´ˆê¸°í™” ì‹¤í–‰');
                    loadEmployeesFromDatabase();
                }
                renderEmployeeList();
            }
        }

        // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ
        async function loadEmployeesFromDatabase() {
            console.log('ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë”© ì‹œì‘');
            
            try {
                // DatabaseManager ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
                if (typeof databaseManager !== 'undefined' && databaseManager.getEmployees) {
                    const employees = await databaseManager.getEmployees();
                    
                    if (employees && employees.length > 0) {
                        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìºì‹œ
                        localStorage.setItem('employees', JSON.stringify(employees));
                        
                        // íšŒì‚¬ë³„ ë°ì´í„°ë„ ì—…ë°ì´íŠ¸
                        const companyEmployees = employees.filter(emp => emp.companyId === 'seokyoung-snt');
                        localStorage.setItem('company_seokyoung-snt_employees', JSON.stringify(companyEmployees));
                        
                        console.log('âœ… ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', employees.length + 'ëª…');
                        
                        // ë°ì´í„° ë°±ì—… ìƒì„±
                        createDataBackup(employees);
                        
                        // ì¦‰ì‹œ ë Œë”ë§
                        renderEmployeeList();
                        
                        return employees;
                    }
                }
            } catch (error) {
                console.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
            
            // ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
            const localEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“‚ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì§ì› ë°ì´í„° ë¡œë“œ:', localEmployees.length + 'ëª…');
            renderEmployeeList();
            return localEmployees;
        }
        
        // ê¸°ì¡´ initializeTestEmployees í•¨ìˆ˜ëŠ” ì œê±°í•˜ê³  loadEmployeesFromDatabase ì‚¬ìš©

        function getTemplateName(templateId) {
            const names = {
                'scout': 'í•œêµ­ì² ê°•',
                'instant': 'ëŒ€í•œì² ê°•',
                'visible': 'ë¹„ì „ìŠ¤í‹¸',
                'dewi': 'ë™ì–‘ì² ê°•',
                'nice-restaurant': 'í•œì¼ì² ê°•',
                'iportfolio': 'í¬í•­ì² ê°•',
                'blogy': 'í•œêµ­ì‚°ì—…',
                'gp': 'ê¸€ë¡œë²Œì² ê°•',
                'upconstruction': 'ëŒ€í•œì¤‘ê³µì—…'
            };
            return names[templateId] || templateId;
        }

        function setupEventListeners() {
            // íƒ­ ì „í™˜
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // ì§ì› í¼ ì œì¶œ
            document.getElementById('employeeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEmployee();
            });

            // ê¶Œí•œ í¼ ì œì¶œ
            document.getElementById('permissionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                savePermission();
            });
        }

        function switchSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            const targetBtn = document.querySelector(`[data-section="${sectionId}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
        }

        function loadData() {
            loadEmployees();
            loadPermissions();
        }

        // ì§ì› ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function loadEmployees() {
            console.log('ğŸ“‚ loadEmployees í˜¸ì¶œë¨');
            const currentData = localStorage.getItem('employees');
            console.log('  ğŸ“ í˜„ì¬ employees ë°ì´í„°:', currentData ? JSON.parse(currentData).length + 'ëª…' : 'ì—†ìŒ');
            renderEmployeeList();
        }

        function getRoleText(role) {
            const roleTexts = {
                'employee': 'ì§ì›',
                'manager': 'ë§¤ë‹ˆì €',
                'company_admin': 'íšŒì‚¬ ê´€ë¦¬ì',
                'master': 'ë§ˆìŠ¤í„°'
            };
            return roleTexts[role] || role;
        }

        function openEmployeeModal(employeeId = null) {
            console.log('ğŸ”µ openEmployeeModal í˜¸ì¶œë¨. employeeId:', employeeId);
            
            try {
                const currentUser = AuthManager.getCurrentUser();
                console.log('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì:', currentUser);
                
                // ê¶Œí•œ ì²´í¬
                if (!canManageEmployees(currentUser)) {
                    alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    console.log('âŒ ê¶Œí•œ ì²´í¬ ì‹¤íŒ¨');
                    return;
                }
                
                console.log('âœ… ê¶Œí•œ ì²´í¬ í†µê³¼');
                
                currentEditingEmployee = employeeId;
                const modal = document.getElementById('employeeModal');
                const form = document.getElementById('employeeForm');
                
                console.log('ğŸ¯ ëª¨ë‹¬ ìš”ì†Œ:', modal);
                console.log('ğŸ“ í¼ ìš”ì†Œ:', form);
                
                if (!modal) {
                    console.error('âŒ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                if (!form) {
                    console.error('âŒ í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ëª¨ë‹¬ í‘œì‹œ
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                console.log('ğŸ“– ëª¨ë‹¬ í‘œì‹œë¨');
                
                // í¼ ì´ˆê¸°í™”
                form.reset();
                console.log('ğŸ”„ í¼ ì´ˆê¸°í™” ì™„ë£Œ');
                
                // ê¶Œí•œ ì˜µì…˜ ì„¤ì • (í¼ ë¦¬ì…‹ í›„)
                try {
                    updateRoleOptions(currentUser, employeeId);
                    console.log('âš™ï¸ ê¶Œí•œ ì˜µì…˜ ì„¤ì • ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ê¶Œí•œ ì˜µì…˜ ì„¤ì • ì‹¤íŒ¨:', error);
                }
                
                // ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì—…ë°ì´íŠ¸ (ë³„ë„ë¡œ ì²˜ë¦¬)
                setTimeout(() => {
                    try {
                        updateEmployeeFormOptions();
                        console.log('âš™ï¸ ë¶€ì„œ/ì§ì±… ì˜µì…˜ ì„¤ì • ì™„ë£Œ');
                        
                        // ì˜µì…˜ ë¡œë“œ í™•ì¸
                        const deptSelect = document.getElementById('employeeDepartment');
                        const posSelect = document.getElementById('employeePosition');
                        console.log('ğŸ” ë¶€ì„œ/ì§ì±… ì˜µì…˜ í™•ì¸:', {
                            deptOptions: deptSelect ? deptSelect.options.length : 0,
                            posOptions: posSelect ? posSelect.options.length : 0
                        });
                    } catch (error) {
                        console.error('âŒ ë¶€ì„œ/ì§ì±… ì˜µì…˜ ì„¤ì • ì‹¤íŒ¨:', error);
                    }
                }, 100);
                
                if (employeeId) {
                    console.log('ğŸ“ ì§ì› ìˆ˜ì • ëª¨ë“œ');
                    
                    // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
                    const urlParams = new URLSearchParams(window.location.search);
                    const companyId = urlParams.get('company');
                    
                    let employee = null;
                    
                    // ë¨¼ì € íšŒì‚¬ë³„ ì§ì› ëª©ë¡ì—ì„œ ì°¾ê¸°
                    if (companyId) {
                        const companyKey = `company_${companyId}_employees`;
                        const companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                        employee = companyEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    // íšŒì‚¬ë³„ ëª©ë¡ì— ì—†ìœ¼ë©´ í†µí•© ëª©ë¡ì—ì„œ ì°¾ê¸°
                    if (!employee) {
                        const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
                        employee = allEmployees.find(emp => emp.id === employeeId);
                    }
                    
                    console.log('ğŸ‘¤ ìˆ˜ì •í•  ì§ì›:', employee);
                    
                    if (employee) {
                        console.log('ğŸ“ ì§ì› ìˆ˜ì • ëª¨ë“œ - ê¸°ì¡´ ë°ì´í„° ë¡œë“œ:', employee);
                        
                        // ì¦‰ì‹œ ê°’ ì„¤ì • (setTimeout ì œê±°)
                        const nameEl = document.getElementById('employeeName');
                        const emailEl = document.getElementById('employeeEmail');
                        const deptEl = document.getElementById('employeeDepartment');
                        const posEl = document.getElementById('employeePosition');
                        const phoneEl = document.getElementById('employeePhone');
                        const roleEl = document.getElementById('employeeRole');
                        
                        console.log('ğŸ” ëª¨ë‹¬ ìš”ì†Œë“¤:', {
                            nameEl: !!nameEl,
                            emailEl: !!emailEl,
                            deptEl: !!deptEl,
                            posEl: !!posEl,
                            phoneEl: !!phoneEl,
                            roleEl: !!roleEl
                        });
                        
                        if (nameEl) {
                            nameEl.value = employee.name || '';
                            console.log('âœ… ì´ë¦„ ì„¤ì •:', nameEl.value);
                        }
                        if (emailEl) {
                            emailEl.value = employee.email || '';
                            console.log('âœ… ì´ë©”ì¼ ì„¤ì •:', emailEl.value);
                        }
                        if (deptEl) {
                            deptEl.value = employee.department || '';
                            console.log('âœ… ë¶€ì„œ ì„¤ì •:', deptEl.value);
                        }
                        if (posEl) {
                            posEl.value = employee.position || '';
                            console.log('âœ… ì§ì±… ì„¤ì •:', posEl.value);
                        }
                        if (phoneEl) {
                            phoneEl.value = employee.phone || '';
                            console.log('âœ… ì—°ë½ì²˜ ì„¤ì •:', phoneEl.value);
                        }
                        if (roleEl) {
                            roleEl.value = employee.role || '';
                            console.log('âœ… ê¶Œí•œ ì„¤ì •:', roleEl.value);
                        }
                        
                        // ì‹œìŠ¤í…œ ì‚¬ìš©ìì¸ ê²½ìš° ê¶Œí•œ í•„ë“œ ë¹„í™œì„±í™”
                        if (roleEl && isSystemUser(employee.role) && currentUser.role !== 'master') {
                            roleEl.disabled = true;
                            console.log('ğŸ”’ ê¶Œí•œ í•„ë“œ ë¹„í™œì„±í™” (ì‹œìŠ¤í…œ ì‚¬ìš©ì)');
                        } else if (roleEl) {
                            roleEl.disabled = false;
                            console.log('ğŸ”“ ê¶Œí•œ í•„ë“œ í™œì„±í™”');
                        }
                        
                        console.log('âœ… ì§ì› ì •ë³´ ë¡œë“œ ì™„ë£Œ');
                    } else {
                        console.log('âš ï¸ ì§ì› ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
                    }
                } else {
                    console.log('â• ì§ì› ì¶”ê°€ ëª¨ë“œ');
                    const roleEl = document.getElementById('employeeRole');
                    if (roleEl) roleEl.disabled = false;
                }
                
                console.log('ğŸ‰ ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ');
                
                // ëª¨ë‹¬ ì™„ì „ ë¡œë“œ í›„ í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
                setTimeout(() => {
                    console.log('ğŸ§ª í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘');
                    testFormElementsAccessibility();
                }, 200);
                
            } catch (error) {
                console.error('âŒ openEmployeeModal ì˜¤ë¥˜:', error);
                alert('ëª¨ë‹¬ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // í¼ ìš”ì†Œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testFormElementsAccessibility() {
            const elements = {
                name: document.getElementById('employeeName'),
                email: document.getElementById('employeeEmail'),
                role: document.getElementById('employeeRole'),
                department: document.getElementById('employeeDepartment'),
                position: document.getElementById('employeePosition'),
                phone: document.getElementById('employeePhone')
            };
            
            console.log('ğŸ§ª í¼ ìš”ì†Œ í…ŒìŠ¤íŠ¸ ê²°ê³¼:');
            
            for (const [key, element] of Object.entries(elements)) {
                if (element) {
                    console.log(`  âœ… ${key}: ì ‘ê·¼ ê°€ëŠ¥, íƒ€ì…: ${element.tagName}, ê°’: "${element.value}"`);
                    if (element.tagName === 'SELECT') {
                        console.log(`    ì˜µì…˜ ìˆ˜: ${element.options.length}`);
                    }
                } else {
                    console.error(`  âŒ ${key}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
            
            // ëª¨ë‹¬ í‘œì‹œ ìƒíƒœ í™•ì¸
            const modal = document.getElementById('employeeModal');
            console.log('ğŸ­ ëª¨ë‹¬ í‘œì‹œ ìƒíƒœ:', {
                display: modal?.style.display,
                offsetParent: modal?.offsetParent !== null,
                clientWidth: modal?.clientWidth,
                clientHeight: modal?.clientHeight
            });
        }

        function closeEmployeeModal() {
            console.log('âŒ ì§ì› ëª¨ë‹¬ ë‹«ê¸°');
            const modal = document.getElementById('employeeModal');
            modal.style.display = 'none';
            
            // í¼ ì´ˆê¸°í™”
            const form = document.getElementById('employeeForm');
            if (form) {
                form.reset();
            }
            
            // ê¶Œí•œ ì„ íƒ í•„ë“œ í™œì„±í™”
            const roleSelect = document.getElementById('employeeRole');
            if (roleSelect) {
                roleSelect.disabled = false;
            }
            
            // currentEditingEmployeeëŠ” saveEmployee ì™„ë£Œ í›„ì—ë§Œ ì´ˆê¸°í™”
            // currentEditingEmployee = null; // ì´ ë¼ì¸ì„ ì œê±°í•˜ì—¬ ì €ì¥ ì¤‘ ê°’ì´ ìœ ì§€ë˜ë„ë¡ í•¨
        }

        // ì €ì¥ ì¤‘ í”Œë˜ê·¸ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isSaving = false;
        
        function saveEmployee() {
            console.log('ğŸ’¾ saveEmployee í•¨ìˆ˜ ì‹œì‘');
            
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (isSaving) {
                console.log('âš ï¸ ì´ë¯¸ ì €ì¥ ì¤‘ì…ë‹ˆë‹¤. ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                return;
            }
            
            isSaving = true;
            console.log('ğŸ”’ ì €ì¥ í”Œë˜ê·¸ ì„¤ì •ë¨');
            
            const currentUser = AuthManager.getCurrentUser();
            
            // ê¶Œí•œ ì²´í¬
            if (!canManageEmployees(currentUser)) {
                alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // ëª¨ë‹¬ì´ í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const modal = document.getElementById('employeeModal');
            console.log('ğŸ­ ëª¨ë‹¬ ìƒíƒœ:', {
                modalExists: !!modal,
                modalDisplay: modal ? modal.style.display : 'N/A',
                modalVisible: modal ? modal.offsetParent !== null : false
            });
            
            // ëª¨ë‹¬ì´ ë‹«í˜€ìˆìœ¼ë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ
            if (!modal || modal.style.display === 'none') {
                console.log('âš ï¸ ëª¨ë‹¬ì´ ë‹«í˜€ìˆì–´ì„œ ì €ì¥ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // DOM ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸
            const nameElement = document.getElementById('employeeName');
            const emailElement = document.getElementById('employeeEmail');
            const roleElement = document.getElementById('employeeRole');
            const departmentElement = document.getElementById('employeeDepartment');
            const positionElement = document.getElementById('employeePosition');
            const phoneElement = document.getElementById('employeePhone');
            
            console.log('ğŸ” DOM ìš”ì†Œ ì¡´ì¬ í™•ì¸:', {
                nameElement: !!nameElement,
                emailElement: !!emailElement,
                roleElement: !!roleElement,
                departmentElement: !!departmentElement,
                positionElement: !!positionElement,
                phoneElement: !!phoneElement
            });
            
            // ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ê²½ê³ 
            if (!nameElement || !emailElement || !roleElement) {
                console.error('âŒ í•„ìˆ˜ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                alert('í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // ì‹¤ì œ ê°’ ì½ê¸°
            const name = nameElement.value.trim();
            const email = emailElement.value.trim();
            const role = roleElement.value;
            const department = departmentElement ? departmentElement.value.trim() : '';
            const position = positionElement ? positionElement.value.trim() : '';
            const phone = phoneElement ? phoneElement.value.trim() : '';
            
            console.log('ğŸ“ ì…ë ¥ëœ ì§ì› ì •ë³´:', { name, email, role, department, position, phone });
            
            // HTML ê°’ë„ í™•ì¸ (ë””ë²„ê¹…ìš©)
            console.log('ğŸ” HTML input ê°’ ì§ì ‘ í™•ì¸:', {
                nameHTML: nameElement.outerHTML,
                emailHTML: emailElement.outerHTML,
                roleHTML: roleElement.outerHTML
            });
            
            // ë” ì •í™•í•œ í•„ìˆ˜ í•­ëª© ê²€ì¦
            console.log('ğŸ” í•„ìˆ˜ í•­ëª© ê²€ì¦:', { 
                name: name || 'empty', 
                email: email || 'empty', 
                role: role || 'empty',
                nameLength: name.length,
                emailLength: email.length,
                roleValue: role,
                department: department || 'empty',
                position: position || 'empty'
            });
            
            // í•„ìˆ˜ í•­ëª©ë“¤ì„ ê°œë³„ì ìœ¼ë¡œ í™•ì¸
            const validationErrors = [];
            
            if (!name || name.length === 0) {
                validationErrors.push('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                console.log('âŒ ì´ë¦„ ëˆ„ë½:', name);
            }
            
            if (!email || email.length === 0) {
                validationErrors.push('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                console.log('âŒ ì´ë©”ì¼ ëˆ„ë½:', email);
            }
            
            if (!role || role === '' || role === null || role === undefined) {
                validationErrors.push('ê¶Œí•œì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                console.log('âŒ ê¶Œí•œ ëˆ„ë½, role ê°’:', role);
            }
            
            // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
            if (email && email.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    validationErrors.push('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    console.log('âŒ ì´ë©”ì¼ í˜•ì‹ ì˜¤ë¥˜:', email);
                }
            }
            
            // ê²€ì¦ ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            if (validationErrors.length > 0) {
                const errorMessage = validationErrors.join('\n');
                alert(errorMessage);
                console.log('âŒ ê²€ì¦ ì‹¤íŒ¨:', validationErrors);
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            console.log('âœ… ëª¨ë“  í•„ìˆ˜ í•­ëª© í†µê³¼');
            
            // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            console.log('ğŸ¢ í˜„ì¬ íšŒì‚¬ ID:', companyId);
            
            // ì €ì¥ ì „ í˜„ì¬ localStorage ìƒíƒœ ë¡œê¹…
            console.log('ğŸ” ì €ì¥ ì „ localStorage ìƒíƒœ:');
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                const existingCompanyData = localStorage.getItem(companyKey);
                console.log(`  ğŸ“ ${companyKey}:`, existingCompanyData ? JSON.parse(existingCompanyData).length + 'ëª…' : 'ì—†ìŒ');
            }
            const existingAllData = localStorage.getItem('employees');
            console.log('  ğŸ“ employees:', existingAllData ? JSON.parse(existingAllData).length + 'ëª…' : 'ì—†ìŒ');
            
            // íšŒì‚¬ë³„ ì§ì› ëª©ë¡ê³¼ í†µí•© ëª©ë¡ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log('ğŸ“‹ ê¸°ì¡´ íšŒì‚¬ë³„ ì§ì› ìˆ˜:', companyEmployees.length);
            }
            const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“‹ ê¸°ì¡´ í†µí•© ì§ì› ìˆ˜:', allEmployees.length);
            
            if (currentEditingEmployee) {
                console.log('âœï¸ ì§ì› ìˆ˜ì • ëª¨ë“œ, ID:', currentEditingEmployee);
                // ìˆ˜ì • ëª¨ë“œ
                // íšŒì‚¬ë³„ ëª©ë¡ì—ì„œ ì°¾ê¸°
                const companyIndex = companyEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                const allIndex = allEmployees.findIndex(emp => emp.id === currentEditingEmployee);
                
                console.log('ğŸ” ì¸ë±ìŠ¤ ì°¾ê¸° ê²°ê³¼:', { companyIndex, allIndex });
                
                // ì›ë³¸ ì§ì› ì •ë³´ ì°¾ê¸° (íšŒì‚¬ë³„ ìš°ì„ , ì—†ìœ¼ë©´ í†µí•©ì—ì„œ)
                let originalEmployee = null;
                if (companyIndex !== -1) {
                    originalEmployee = companyEmployees[companyIndex];
                } else if (allIndex !== -1) {
                    originalEmployee = allEmployees[allIndex];
                }
                
                if (originalEmployee) {
                    // ì‹œìŠ¤í…œ ì‚¬ìš©ì ê¶Œí•œ ë³€ê²½ ì²´í¬
                    if (isSystemUser(originalEmployee.role) && currentUser.role !== 'master') {
                        alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        isSaving = false;
                        return;
                    }
                    
                    // ìƒˆë¡œìš´ ê¶Œí•œì´ ì‹œìŠ¤í…œ ê¶Œí•œì¸ì§€ ì²´í¬
                    if (isSystemUser(role) && currentUser.role !== 'master') {
                        alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ê¶Œí•œ(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        isSaving = false;
                        return;
                    }
                    
                    const updatedEmployee = {
                        ...originalEmployee,
                        name,
                        email,
                        role,
                        department,
                        position,
                        phone,
                        updatedAt: new Date().toISOString()
                    };
                    
                    console.log('âœï¸ ì—…ë°ì´íŠ¸ëœ ì§ì› ì •ë³´:', updatedEmployee);
                    
                    // íšŒì‚¬ë³„ ëª©ë¡ ì—…ë°ì´íŠ¸
                    if (companyIndex !== -1) {
                        companyEmployees[companyIndex] = updatedEmployee;
                    } else if (companyId && originalEmployee.companyId === companyId) {
                        // íšŒì‚¬ë³„ ëª©ë¡ì— ì—†ì§€ë§Œ ê°™ì€ íšŒì‚¬ ì§ì›ì´ë©´ ì¶”ê°€
                        companyEmployees.push(updatedEmployee);
                    }
                    
                    // í†µí•© ëª©ë¡ ì—…ë°ì´íŠ¸
                    if (allIndex !== -1) {
                        allEmployees[allIndex] = updatedEmployee;
                    }
                } else {
                    console.error('âŒ ìˆ˜ì •í•  ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    alert('ìˆ˜ì •í•  ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    isSaving = false;
                    return;
                }
            } else {
                console.log('â• ì§ì› ì¶”ê°€ ëª¨ë“œ');
                // ìƒˆ ì§ì› ì¶”ê°€
                // ì‹œìŠ¤í…œ ê¶Œí•œ ë¶€ì—¬ ì²´í¬
                if (isSystemUser(role) && currentUser.role !== 'master') {
                    alert('ë§ˆìŠ¤í„°ë§Œ ì‹œìŠ¤í…œ ê¶Œí•œ(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const newEmployee = {
                    id: Date.now().toString(),
                    name,
                    email,
                    role,
                    department,
                    position,
                    phone,
                    companyId: companyId, // íšŒì‚¬ ID ì¶”ê°€
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                console.log('â• ìƒˆ ì§ì› ì •ë³´:', newEmployee);
                
                // íšŒì‚¬ë³„ ëª©ë¡ì— ì¶”ê°€
                if (companyId) {
                    companyEmployees.push(newEmployee);
                    console.log('ğŸ“ íšŒì‚¬ë³„ ëª©ë¡ì— ì¶”ê°€ ì™„ë£Œ, ì´ ì¸ì›:', companyEmployees.length);
                }
                
                // í†µí•© ëª©ë¡ì— ì¶”ê°€
                allEmployees.push(newEmployee);
                console.log('ğŸ“ í†µí•© ëª©ë¡ì— ì¶”ê°€ ì™„ë£Œ, ì´ ì¸ì›:', allEmployees.length);
            }
            
            // ì €ì¥ ì „ ìµœì¢… í™•ì¸
            console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„° í™•ì¸:');
            console.log('  íšŒì‚¬ë³„ ì§ì› ìˆ˜:', companyEmployees.length);
            console.log('  í†µí•© ì§ì› ìˆ˜:', allEmployees.length);
            
            // ì €ì¥
            try {
                if (companyId) {
                    const companyKey = `company_${companyId}_employees`;
                    const companyDataStr = JSON.stringify(companyEmployees);
                    localStorage.setItem(companyKey, companyDataStr);
                    console.log('ğŸ’¾ íšŒì‚¬ë³„ ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ:', companyKey, companyEmployees.length + 'ëª…');
                    
                    // ì¦‰ì‹œ í™•ì¸
                    const verifyCompanyData = localStorage.getItem(companyKey);
                    if (verifyCompanyData) {
                        const parsed = JSON.parse(verifyCompanyData);
                        console.log('âœ… íšŒì‚¬ë³„ ë°ì´í„° ì €ì¥ í™•ì¸:', parsed.length + 'ëª…');
                    } else {
                        console.error('âŒ íšŒì‚¬ë³„ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨!');
                    }
                }
                
                const allDataStr = JSON.stringify(allEmployees);
                localStorage.setItem('employees', allDataStr);
                console.log('ğŸ’¾ í†µí•© ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ:', allEmployees.length + 'ëª…');
                
                // ë°ì´í„° ë³€ê²½ ì‹œ ë°±ì—… ìƒì„±
                createDataBackup(allEmployees);
                
                // ì¦‰ì‹œ í™•ì¸
                const verifyAllData = localStorage.getItem('employees');
                if (verifyAllData) {
                    const parsed = JSON.parse(verifyAllData);
                    console.log('âœ… í†µí•© ë°ì´í„° ì €ì¥ í™•ì¸:', parsed.length + 'ëª…');
                    
                    // ì €ì¥ëœ ì§ì› ëª©ë¡ì˜ ì²˜ìŒ 3ëª… í™•ì¸
                    console.log('ğŸ“‹ ì €ì¥ëœ ì§ì› ìƒ˜í”Œ:', parsed.slice(0, 3).map(emp => ({ id: emp.id, name: emp.name, companyId: emp.companyId })));
                } else {
                    console.error('âŒ í†µí•© ë°ì´í„° ì €ì¥ ì‹¤íŒ¨!');
                }
                
            } catch (error) {
                console.error('âŒ localStorage ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì§ì› ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                isSaving = false; // í”Œë˜ê·¸ í•´ì œ
                return;
            }
            
            // localStorage ë°ì´í„° ë³´ì¡´ì„ ìœ„í•œ ì¶”ê°€ ì €ì¥ (ë¨¼ì € ì‹¤í–‰)
            const finalDataBackup = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ”’ ìµœì¢… ë°ì´í„° ë°±ì—…:', finalDataBackup.length + 'ëª…');
            
            // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™” (ë Œë”ë§ ì „ì— ì‹¤í–‰)
            if (typeof window.syncEmployeeCount === 'function') {
                window.syncEmployeeCount(companyId);
                console.log('ğŸ”„ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”');
            }
            
            // ë°ì´í„° ë³µì› í™•ì¸ ë° ì¬ì €ì¥
            setTimeout(() => {
                const currentData = JSON.parse(localStorage.getItem('employees') || '[]');
                console.log('ğŸ” ë™ê¸°í™” í›„ ë°ì´í„° í™•ì¸:', currentData.length + 'ëª…');
                
                if (currentData.length < finalDataBackup.length) {
                    console.log('âš ï¸ ë°ì´í„° ì†ì‹¤ ê°ì§€! ë°±ì—… ë°ì´í„°ë¡œ ë³µì›');
                    localStorage.setItem('employees', JSON.stringify(finalDataBackup));
                }
                
                // ì¦‰ì‹œ ì§ì› ëª©ë¡ ì—…ë°ì´íŠ¸
                console.log('ğŸ”„ ì§ì› ëª©ë¡ ë Œë”ë§ ì‹œì‘');
                renderEmployeeList();
                
                // 500ms í›„ ë‹¤ì‹œ ë Œë”ë§ (ì•ˆì •ì„± í–¥ìƒ)
                setTimeout(() => {
                    console.log('ğŸ”„ ë°ì´í„° ì €ì¥ í›„ ì§ì› ëª©ë¡ ì¬ë Œë”ë§');
                    
                    // ë Œë”ë§ ì „ ë°ì´í„° ë‹¤ì‹œ í™•ì¸
                    const preRenderData = JSON.parse(localStorage.getItem('employees') || '[]');
                    console.log('ğŸ” ì¬ë Œë”ë§ ì „ ë°ì´í„°:', preRenderData.length + 'ëª…');
                    
                    if (preRenderData.length < finalDataBackup.length) {
                        console.log('âš ï¸ ì¬ë Œë”ë§ ì „ ë°ì´í„° ì†ì‹¤ ê°ì§€! ë‹¤ì‹œ ë³µì›');
                        localStorage.setItem('employees', JSON.stringify(finalDataBackup));
                    }
                    
                    renderEmployeeList();
                }, 500);
            }, 100);
            
            // localStorageì— ë°ì´í„° ìœ ì§€ë¥¼ ìœ„í•œ ì¶”ê°€ ì €ì¥ (ì¤‘ë³µ ì €ì¥ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ)
            try {
                const verifyDataSave = JSON.parse(localStorage.getItem('employees') || '[]');
                const backupKey = `employees_backup_${Date.now()}`;
                localStorage.setItem(backupKey, JSON.stringify(verifyDataSave));
                console.log('ğŸ’¾ ë°±ì—… ë°ì´í„° ì €ì¥:', backupKey);
                
                // ì˜¤ë˜ëœ ë°±ì—… ì œê±° (5ê°œë§Œ ìœ ì§€)
                const allKeys = Object.keys(localStorage);
                const backupKeys = allKeys.filter(key => key.startsWith('employees_backup_')).sort();
                if (backupKeys.length > 5) {
                    const keysToRemove = backupKeys.slice(0, backupKeys.length - 5);
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    console.log('ğŸ—‘ï¸ ì˜¤ë˜ëœ ë°±ì—… ì œê±°:', keysToRemove.length + 'ê°œ');
                }
            } catch (backupError) {
                console.error('âš ï¸ ë°±ì—… ì €ì¥ ì˜¤ë¥˜:', backupError);
            }
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeEmployeeModal();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (currentEditingEmployee ë¦¬ì…‹ ì „ì— ì²´í¬)
            const isEditMode = currentEditingEmployee !== null;
            const message = isEditMode ? 'âœ… ì§ì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'âœ… ì§ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
            console.log('ğŸ¯ í¸ì§‘ ëª¨ë“œ í™•ì¸:', isEditMode, 'currentEditingEmployee:', currentEditingEmployee);
            alert(message);
            
            // currentEditingEmployee ë¦¬ì…‹ (ì €ì¥ ì™„ë£Œ í›„)
            currentEditingEmployee = null;
            console.log('ğŸ”„ currentEditingEmployee ë¦¬ì…‹ ì™„ë£Œ');
            
            console.log('âœ… saveEmployee í•¨ìˆ˜ ì™„ë£Œ');
            
            // ì €ì¥ ì™„ë£Œ í›„ í”Œë˜ê·¸ í•´ì œ
            isSaving = false;
            console.log('ğŸ”“ ì €ì¥ í”Œë˜ê·¸ í•´ì œë¨');
            
            // ì €ì¥ í›„ 3ì´ˆ ë’¤ì— ë‹¤ì‹œ í•œë²ˆ í™•ì¸
            setTimeout(() => {
                console.log('ğŸ” 3ì´ˆ í›„ localStorage ì¬í™•ì¸:');
                const recheck = localStorage.getItem('employees');
                if (recheck) {
                    const parsed = JSON.parse(recheck);
                    console.log('  ğŸ“ employees:', parsed.length + 'ëª…');
                } else {
                    console.error('  âŒ employees ë°ì´í„°ê°€ ì‚¬ë¼ì§!');
                }
                
                if (companyId) {
                    const companyKey = `company_${companyId}_employees`;
                    const recheckCompany = localStorage.getItem(companyKey);
                    if (recheckCompany) {
                        const parsed = JSON.parse(recheckCompany);
                        console.log(`  ğŸ“ ${companyKey}:`, parsed.length + 'ëª…');
                    } else {
                        console.error(`  âŒ ${companyKey} ë°ì´í„°ê°€ ì‚¬ë¼ì§!`);
                    }
                }
            }, 3000);
        }

        function editEmployee(employeeId) {
            console.log('ğŸ”§ğŸ”§ğŸ”§ editEmployee í•¨ìˆ˜ í˜¸ì¶œë¨! employeeId:', employeeId);
            
            try {
                // ì¦‰ì‹œ ëª¨ë‹¬ ì—´ê¸° í…ŒìŠ¤íŠ¸
                console.log('âš¡ ì¦‰ì‹œ ëª¨ë‹¬ ì—´ê¸° ì‹œë„');
                openEmployeeModal(employeeId);
                
            } catch (error) {
                console.error('âŒ editEmployee ì˜¤ë¥˜:', error);
                alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }

        // ë°±ì—… ë‹¨ìˆœ í•¨ìˆ˜
        function simpleEditEmployee(employeeId) {
            console.log('ğŸ”¥ simpleEditEmployee í˜¸ì¶œë¨:', employeeId);
            // alert ì œê±° - ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            
            // ì§ì ‘ openEmployeeModal í˜¸ì¶œ
            openEmployeeModal(employeeId);
        }

        function deleteEmployee(employeeId) {
            console.log('ğŸ—‘ï¸ deleteEmployee ì‹œì‘, ID:', employeeId);
            const currentUser = AuthManager.getCurrentUser();
            
            // í˜„ì¬ íšŒì‚¬ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company');
            
            // íšŒì‚¬ë³„ ì§ì› ëª©ë¡ê³¼ í†µí•© ëª©ë¡ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
            let companyEmployees = [];
            if (companyId) {
                const companyKey = `company_${companyId}_employees`;
                companyEmployees = JSON.parse(localStorage.getItem(companyKey) || '[]');
                console.log(`ğŸ“ ì‚­ì œ ì „ ${companyKey}:`, companyEmployees.length + 'ëª…');
            }
            const allEmployees = JSON.parse(localStorage.getItem('employees') || '[]');
            console.log('ğŸ“ ì‚­ì œ ì „ employees:', allEmployees.length + 'ëª…');
            
            // ì‚­ì œí•  ì§ì› ì°¾ê¸°
            const employee = companyEmployees.find(emp => emp.id === employeeId) || 
                           allEmployees.find(emp => emp.id === employeeId);
            
            console.log('ğŸ‘¤ ì‚­ì œí•  ì§ì›:', employee);
            
            if (!employee) {
                console.log('âš ï¸ ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ, ì´ë¯¸ ì‚­ì œë¨');
                return;
            }
            
            // ê¶Œí•œ ì²´í¬
            if (!canManageEmployees(currentUser)) {
                alert('ì§ì› ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‹œìŠ¤í…œ ì‚¬ìš©ìëŠ” ì‚­ì œ ë¶ˆê°€
            if (isSystemUser(employee.role)) {
                alert('ì‹œìŠ¤í…œ ì‚¬ìš©ì(ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ)ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ì •ë§ë¡œ ${employee.name} ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                // íšŒì‚¬ë³„ ëª©ë¡ì—ì„œ ì‚­ì œ
                if (companyId) {
                    const filteredCompanyEmployees = companyEmployees.filter(emp => emp.id !== employeeId);
                    const companyKey = `company_${companyId}_employees`;
                    localStorage.setItem(companyKey, JSON.stringify(filteredCompanyEmployees));
                    console.log(`ğŸ—‘ï¸ ${companyKey}ì—ì„œ ì‚­ì œ ì™„ë£Œ:`, filteredCompanyEmployees.length + 'ëª… ë‚¨ìŒ');
                }
                
                // í†µí•© ëª©ë¡ì—ì„œ ì‚­ì œ
                const filteredAllEmployees = allEmployees.filter(emp => emp.id !== employeeId);
                localStorage.setItem('employees', JSON.stringify(filteredAllEmployees));
                console.log('ğŸ—‘ï¸ employeesì—ì„œ ì‚­ì œ ì™„ë£Œ:', filteredAllEmployees.length + 'ëª… ë‚¨ìŒ');
                
                // ì‚­ì œ í›„ ë°±ì—… ìƒì„±
                createDataBackup(filteredAllEmployees);
                
                // ì¦‰ì‹œ í™•ì¸
                const verifyData = localStorage.getItem('employees');
                if (verifyData) {
                    const parsed = JSON.parse(verifyData);
                    console.log('âœ… ì‚­ì œ í›„ í™•ì¸:', parsed.length + 'ëª…');
                } else {
                    console.error('âŒ ì‚­ì œ í›„ ë°ì´í„° ì—†ìŒ!');
                }
                
                renderEmployeeList();
                
                // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”
                if (typeof window.syncEmployeeCount === 'function') {
                    window.syncEmployeeCount(companyId);
                    console.log('ğŸ”„ ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œì— ì§ì› ìˆ˜ ë™ê¸°í™”');
                }
                
                alert('ì§ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('âŒ ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ê¶Œí•œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function loadPermissions() {
            const permissions = JSON.parse(localStorage.getItem('permissions') || '[]');
            const permissionList = document.getElementById('permissionList');
            
            if (permissions.length === 0) {
                permissionList.innerHTML = '<p style="text-align: center; color: #9ca3af;">ì„¤ì •ëœ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            permissionList.innerHTML = permissions.map(perm => `
                <div class="permission-card">
                    <div class="permission-info">
                        <h4>${perm.name}</h4>
                        <p>${perm.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                        <div class="permission-badges">
                            ${perm.canRead ? '<span class="badge">ì½ê¸°</span>' : ''}
                            ${perm.canWrite ? '<span class="badge">ì“°ê¸°</span>' : ''}
                            ${perm.canDelete ? '<span class="badge">ì‚­ì œ</span>' : ''}
                            ${perm.canManage ? '<span class="badge">ê´€ë¦¬</span>' : ''}
                        </div>
                    </div>
                    <div class="permission-actions">
                        <button class="btn btn-small" onclick="editPermission('${perm.id}')">
                            <i class="fas fa-edit"></i> ìˆ˜ì •
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deletePermission('${perm.id}')">
                            <i class="fas fa-trash"></i> ì‚­ì œ
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openPermissionModal(permissionId = null) {
            currentEditingPermission = permissionId;
            const modal = document.getElementById('permissionModal');
            const form = document.getElementById('permissionForm');
            
            form.reset();
            
            if (permissionId) {
                const permissions = JSON.parse(localStorage.getItem('permissions') || '[]');
                const permission = permissions.find(perm => perm.id === permissionId);
                
                if (permission) {
                    document.getElementById('permissionName').value = permission.name;
                    document.getElementById('permissionDescription').value = permission.description || '';
                    document.getElementById('canRead').checked = permission.canRead || false;
                    document.getElementById('canWrite').checked = permission.canWrite || false;
                    document.getElementById('canDelete').checked = permission.canDelete || false;
                    document.getElementById('canManage').checked = permission.canManage || false;
                }
            }
            
            modal.style.display = 'block';
        }

        function closePermissionModal() {
            document.getElementById('permissionModal').style.display = 'none';
            currentEditingPermission = null;
        }

        function savePermission() {
            const name = document.getElementById('permissionName').value.trim();
            const description = document.getElementById('permissionDescription').value.trim();
            const canRead = document.getElementById('canRead').checked;
            const canWrite = document.getElementById('canWrite').checked;
            const canDelete = document.getElementById('canDelete').checked;
            const canManage = document.getElementById('canManage').checked;
            
            if (!name) {
                alert('ê¶Œí•œëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            const permissions = JSON.parse(localStorage.getItem('permissions') || '[]');
            
            if (currentEditingPermission) {
                // ìˆ˜ì •
                const index = permissions.findIndex(perm => perm.id === currentEditingPermission);
                if (index !== -1) {
                    permissions[index] = {
                        ...permissions[index],
                        name,
                        description,
                        canRead,
                        canWrite,
                        canDelete,
                        canManage,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // ìƒˆ ê¶Œí•œ ì¶”ê°€
                const newPermission = {
                    id: Date.now().toString(),
                    name,
                    description,
                    canRead,
                    canWrite,
                    canDelete,
                    canManage,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                permissions.push(newPermission);
            }
            
            localStorage.setItem('permissions', JSON.stringify(permissions));
            loadPermissions();
            closePermissionModal();
            
            alert(currentEditingPermission ? 'ê¶Œí•œì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê¶Œí•œì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function editPermission(permissionId) {
            openPermissionModal(permissionId);
        }

        function deletePermission(permissionId) {
            if (!confirm('ì •ë§ë¡œ ì´ ê¶Œí•œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const permissions = JSON.parse(localStorage.getItem('permissions') || '[]');
            const filteredPermissions = permissions.filter(perm => perm.id !== permissionId);
            
            localStorage.setItem('permissions', JSON.stringify(filteredPermissions));
            loadPermissions();
            
            alert('ê¶Œí•œì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë©”ì¸ ê´€ë¦¬ ì¹´ë“œ í´ë¦­ í•¨ìˆ˜ë“¤
        function showEmployeeManagement() {
            // ê¶Œí•œ ì²´í¬
            const user = AuthManager.getCurrentUser();
            if (!user || !canManageEmployees(user)) {
                alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ, ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            // íˆìŠ¤í† ë¦¬ì— ìƒíƒœ ì¶”ê°€ (í•´ì‹œ ë³€ê²½ ì—†ì´)
            history.pushState({ section: 'employees' }, 'ì§ì› ê´€ë¦¬', '#employees');
            
            // ì§ì› ê´€ë¦¬ ì„¹ì…˜ í‘œì‹œ
            showSection('employees');
        }

        function showPermissionManagement() {
            // íˆìŠ¤í† ë¦¬ì— ìƒíƒœ ì¶”ê°€ (í•´ì‹œ ë³€ê²½ ì—†ì´)
            history.pushState({ section: 'permissions' }, 'ê¶Œí•œ ì„¤ì •', '#permissions');
            
            // ê¶Œí•œ ì„¤ì • ì„¹ì…˜ í‘œì‹œ
            showSection('permissions');
            
            // ê¶Œí•œ ë°ì´í„° ë¡œë“œ
            loadMenuPermissions();
        }

        function showPendingMembers() {
            // ê¶Œí•œ ì²´í¬
            const user = AuthManager.getCurrentUser();
            if (!user || !canManageEmployees(user)) {
                alert('ê°€ì… ìŠ¹ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ, ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            // íˆìŠ¤í† ë¦¬ì— ìƒíƒœ ì¶”ê°€ (í•´ì‹œ ë³€ê²½ ì—†ì´)
            history.pushState({ section: 'pendingMembers' }, 'ê°€ì… ìŠ¹ì¸', '#pendingMembers');
            
            // ê°€ì… ìŠ¹ì¸ ì„¹ì…˜ í‘œì‹œ
            showSection('pendingMembers');
            
            // ìŠ¹ì¸ ëŒ€ê¸° íšŒì› ëª©ë¡ ë¡œë“œ
            loadPendingMembers();
        }

        function backToDashboard() {
            // íˆìŠ¤í† ë¦¬ì— ìƒíƒœ ì¶”ê°€ (í•´ì‹œ ë³€ê²½ ì—†ì´)
            history.pushState({ section: 'dashboard' }, 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ', window.location.pathname);
            
            // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
            showSection('dashboard');
        }

        // ì„¹ì…˜ í‘œì‹œ í†µí•© í•¨ìˆ˜
        function showSection(sectionName) {
            console.log('ğŸ¯ ì„¹ì…˜ ì „í™˜:', sectionName);
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            if (sectionName === 'dashboard' || !sectionName) {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                document.querySelector('.management-container').style.display = 'flex';
            } else {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìˆ¨ê¸°ê¸°
                document.querySelector('.management-container').style.display = 'none';
                
                // ìš”ì²­ëœ ì„¹ì…˜ í‘œì‹œ
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    
                    // ì§ì› ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ë°ì´í„° ë¡œë“œ
                    if (sectionName === 'employees') {
                        renderEmployeeList();
                    }
                    // ê°€ì… ìŠ¹ì¸ ì„¹ì…˜ì¸ ê²½ìš° ë°ì´í„° ë¡œë“œ
                    else if (sectionName === 'pendingMembers') {
                        loadPendingMembers();
                    }
                } else {
                    console.warn('ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', sectionName);
                    // ê¸°ë³¸ì ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                    document.querySelector('.management-container').style.display = 'flex';
                }
            }
        }

        // URL í•´ì‹œ ë³€ê²½ ì²˜ë¦¬
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // # ì œê±°
            console.log('ğŸ”— í•´ì‹œ ë³€ê²½:', hash);
            
            if (hash === 'employees') {
                // ê¶Œí•œ ì²´í¬
                const user = AuthManager.getCurrentUser();
                if (!user || !canManageEmployees(user)) {
                    alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŠ¤í„°, íšŒì‚¬ëŒ€í‘œ, ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    window.location.hash = '';
                    return;
                }
                showSection('employees');
            } else if (hash === 'permissions') {
                showSection('permissions');
            } else {
                showSection('dashboard');
            }
        }

        // ì§ì› ì„¤ì • ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openEmployeeSettingsModal() {
            console.log('âš™ï¸ ì§ì› ì„¤ì • ëª¨ë‹¬ ì—´ê¸°');
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'flex';
                loadDepartmentsAndPositions();
            } else {
                console.error('âŒ ì„¤ì • ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        function closeEmployeeSettingsModal() {
            const modal = document.getElementById('employeeSettingsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function loadDepartmentsAndPositions() {
            const departments = getDepartments();
            const positions = getPositions();
            
            renderDepartmentsList(departments);
            renderPositionsList(positions);
        }

        function getDepartments() {
            const saved = localStorage.getItem('employee_departments');
            return saved ? JSON.parse(saved) : ['ì˜ì—…ë¶€', 'ê´€ë¦¬ë¶€', 'ë¬¼ë¥˜ë¶€'];
        }

        function getPositions() {
            const saved = localStorage.getItem('employee_positions');
            return saved ? JSON.parse(saved) : ['ì´ì‚¬', 'ë¶€ì¥', 'ì°¨ì¥', 'ê³¼ì¥', 'ëŒ€ë¦¬', 'ê³„ì¥'];
        }

        function saveDepartments(departments) {
            localStorage.setItem('employee_departments', JSON.stringify(departments));
            updateEmployeeFormOptions();
        }

        function savePositions(positions) {
            localStorage.setItem('employee_positions', JSON.stringify(positions));
            updateEmployeeFormOptions();
        }

        function renderDepartmentsList(departments) {
            const container = document.getElementById('departmentsList');
            if (!container) return;
            
            container.innerHTML = departments.map((dept, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${dept}</span>
                    <button class="btn btn-danger btn-small" onclick="removeDepartment('${dept}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderPositionsList(positions) {
            const container = document.getElementById('positionsList');
            if (!container) return;
            
            container.innerHTML = positions.map((pos, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="color: #e2e8f0;">${pos}</span>
                    <button class="btn btn-danger btn-small" onclick="removePosition('${pos}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function addDepartment() {
            const input = document.getElementById('newDepartmentInput');
            const newDept = input.value.trim();
            
            if (!newDept) {
                alert('ë¶€ì„œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const departments = getDepartments();
            if (departments.includes(newDept)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¶€ì„œì…ë‹ˆë‹¤.');
                return;
            }
            
            departments.push(newDept);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            input.value = '';
            
            alert('ìƒˆ ë¶€ì„œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function addPosition() {
            const input = document.getElementById('newPositionInput');
            const newPos = input.value.trim();
            
            if (!newPos) {
                alert('ì§ì±…ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const positions = getPositions();
            if (positions.includes(newPos)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì§ì±…ì…ë‹ˆë‹¤.');
                return;
            }
            
            positions.push(newPos);
            savePositions(positions);
            renderPositionsList(positions);
            input.value = '';
            
            alert('ìƒˆ ì§ì±…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function removeDepartment(deptToRemove) {
            // í•´ë‹¹ ë¶€ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            const employeesUsingDept = employees.filter(emp => emp.department === deptToRemove);
            
            if (employeesUsingDept.length > 0) {
                alert(`'${deptToRemove}' ë¶€ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ${employeesUsingDept.length}ëª… ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í•´ë‹¹ ì§ì›ë“¤ì˜ ë¶€ì„œë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            if (!confirm(`'${deptToRemove}' ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const departments = getDepartments().filter(dept => dept !== deptToRemove);
            saveDepartments(departments);
            renderDepartmentsList(departments);
            
            alert('ë¶€ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function removePosition(posToRemove) {
            // í•´ë‹¹ ì§ì±…ì„ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            const employeesUsingPos = employees.filter(emp => emp.position === posToRemove);
            
            if (employeesUsingPos.length > 0) {
                alert(`'${posToRemove}' ì§ì±…ì„ ì‚¬ìš©í•˜ëŠ” ì§ì›ì´ ${employeesUsingPos.length}ëª… ìˆìŠµë‹ˆë‹¤. ë¨¼ì € í•´ë‹¹ ì§ì›ë“¤ì˜ ì§ì±…ì„ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            if (!confirm(`'${posToRemove}' ì§ì±…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const positions = getPositions().filter(pos => pos !== posToRemove);
            savePositions(positions);
            renderPositionsList(positions);
            
            alert('ì§ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function updateEmployeeFormOptions() {
            // ì§ì› ëª¨ë‹¬ì˜ ë¶€ì„œ ë° ì§ì±… ì˜µì…˜ ì—…ë°ì´íŠ¸
            const departments = getDepartments();
            const positions = getPositions();
            
            const deptSelect = document.getElementById('employeeDepartment');
            const posSelect = document.getElementById('employeePosition');
            
            if (deptSelect) {
                const currentValue = deptSelect.value;
                let deptOptions = '<option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                departments.forEach(dept => {
                    deptOptions += `<option value="${dept}">${dept}</option>`;
                });
                deptSelect.innerHTML = deptOptions;
                deptSelect.value = currentValue; // ê¸°ì¡´ ì„ íƒê°’ ë³µì›
            }
            
            if (posSelect) {
                const currentValue = posSelect.value;
                let posOptions = '<option value="">ì§ì±…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                positions.forEach(pos => {
                    posOptions += `<option value="${pos}">${pos}</option>`;
                });
                posSelect.innerHTML = posOptions;
                posSelect.value = currentValue; // ê¸°ì¡´ ì„ íƒê°’ ë³µì›
            }
        }

        // ë§ˆìŠ¤í„° ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        function goToMasterDashboard() {
            // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
            const currentUser = AuthManager.getCurrentUser();
            
            if (currentUser.role === 'master') {
                window.location.href = 'master-dashboard.html';
            } else {
                alert('ë§ˆìŠ¤í„° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                AuthManager.logout();
                window.location.href = 'index.html';
            }
        }

        // ==================== ê¶Œí•œ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ====================
        
        // ë©”ë‰´ ê¶Œí•œ ë°ì´í„° ë¡œë“œ
        function loadMenuPermissions() {
            console.log('ğŸ“‹ ë©”ë‰´ ê¶Œí•œ ë¡œë“œ ì‹œì‘');
            
            // ì €ì¥ëœ ê¶Œí•œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const savedPermissions = JSON.parse(localStorage.getItem('menuPermissions') || '{}');
            
            // í˜„ì¬ íšŒì‚¬ì˜ ë¶€ì„œ, ì§ê¸‰, ì§ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const departments = getDepartments();
            const positions = getPositions();
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            
            // ê° ë©”ë‰´ì— ëŒ€í•´ ê¶Œí•œ íŒ¨ë„ ë Œë”ë§
            const menus = ['worklog', 'corporate-card', 'documents'];
            
            menus.forEach(menu => {
                // ë¶€ì„œë³„ ê¶Œí•œ
                renderDepartmentPermissions(menu, departments, savedPermissions);
                
                // ì§ê¸‰ë³„ ê¶Œí•œ
                renderPositionPermissions(menu, positions, savedPermissions);
                
                // ê°œì¸ë³„ ê¶Œí•œ
                renderIndividualPermissions(menu, employees, savedPermissions);
            });
        }
        
        // ë¶€ì„œë³„ ê¶Œí•œ ë Œë”ë§
        function renderDepartmentPermissions(menu, departments, savedPermissions) {
            const container = document.getElementById(`${menu}-department`);
            if (!container) return;
            
            const menuPermissions = savedPermissions[menu] || {};
            const departmentPermissions = menuPermissions.departments || {};
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            
            if (departments.length === 0) {
                html += '<p style="color: #9ca3af; text-align: center;">ë“±ë¡ëœ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                departments.forEach(dept => {
                    const isChecked = departmentPermissions[dept] || false;
                    html += `
                        <div class="permission-checkbox">
                            <input type="checkbox" id="${menu}-dept-${dept}" 
                                   data-menu="${menu}" data-type="departments" data-value="${dept}"
                                   ${isChecked ? 'checked' : ''}>
                            <label for="${menu}-dept-${dept}">${dept}</label>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ì§ê¸‰ë³„ ê¶Œí•œ ë Œë”ë§
        function renderPositionPermissions(menu, positions, savedPermissions) {
            const container = document.getElementById(`${menu}-position`);
            if (!container) return;
            
            const menuPermissions = savedPermissions[menu] || {};
            const positionPermissions = menuPermissions.positions || {};
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            
            if (positions.length === 0) {
                html += '<p style="color: #9ca3af; text-align: center;">ë“±ë¡ëœ ì§ê¸‰ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                positions.forEach(pos => {
                    const isChecked = positionPermissions[pos] || false;
                    html += `
                        <div class="permission-checkbox">
                            <input type="checkbox" id="${menu}-pos-${pos}" 
                                   data-menu="${menu}" data-type="positions" data-value="${pos}"
                                   ${isChecked ? 'checked' : ''}>
                            <label for="${menu}-pos-${pos}">${pos}</label>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ê°œì¸ë³„ ê¶Œí•œ ë Œë”ë§
        function renderIndividualPermissions(menu, employees, savedPermissions) {
            const container = document.getElementById(`${menu}-individual`);
            if (!container) return;
            
            const menuPermissions = savedPermissions[menu] || {};
            const individualPermissions = menuPermissions.individuals || {};
            
            // ëŒ€í‘œì´ì‚¬ ì œì™¸ (ëª¨ë“  ê¶Œí•œ ìë™ ë¶€ì—¬)
            const filteredEmployees = employees.filter(emp => emp.position !== 'ëŒ€í‘œì´ì‚¬');
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            
            if (filteredEmployees.length === 0) {
                html += '<p style="color: #9ca3af; text-align: center;">ê¶Œí•œ ì„¤ì • ê°€ëŠ¥í•œ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.<br><small>(ëŒ€í‘œì´ì‚¬ëŠ” ëª¨ë“  ê¶Œí•œì´ ìë™ ë¶€ì—¬ë©ë‹ˆë‹¤)</small></p>';
            } else {
                filteredEmployees.forEach(emp => {
                    const isChecked = individualPermissions[emp.id] || false;
                    html += `
                        <div class="permission-checkbox">
                            <input type="checkbox" id="${menu}-emp-${emp.id}" 
                                   data-menu="${menu}" data-type="individuals" data-value="${emp.id}"
                                   data-name="${emp.name}"
                                   ${isChecked ? 'checked' : ''}>
                            <label for="${menu}-emp-${emp.id}">${emp.name} (${emp.department || 'ë¶€ì„œ ë¯¸ì§€ì •'} - ${emp.position || 'ì§ê¸‰ ë¯¸ì§€ì •'})</label>
                        </div>
                    `;
                });
                
                // ëŒ€í‘œì´ì‚¬ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
                const ceoEmployees = employees.filter(emp => emp.position === 'ëŒ€í‘œì´ì‚¬');
                if (ceoEmployees.length > 0) {
                    html += '<div style="margin-top: 1rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-radius: 5px; border-left: 3px solid #22c55e;">';
                    html += '<p style="color: #22c55e; margin: 0; font-size: 0.875rem;"><i class="fas fa-info-circle"></i> ëŒ€í‘œì´ì‚¬ëŠ” ëª¨ë“  ë©”ë‰´ì— ìë™ìœ¼ë¡œ ì ‘ê·¼ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤:</p>';
                    ceoEmployees.forEach(emp => {
                        html += `<p style="color: #e2e8f0; margin: 0.25rem 0 0 0; font-size: 0.875rem;">â€¢ ${emp.name} (${emp.department || 'ë¶€ì„œ ë¯¸ì§€ì •'} - ${emp.position})</p>`;
                    });
                    html += '</div>';
                }
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ê¶Œí•œ íƒ­ ì „í™˜
        function switchPermissionTab(menu, type) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            const tabs = document.querySelectorAll(`#${menu}-permissions .permission-tab`);
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
            const panels = document.querySelectorAll(`#${menu}-permissions .permission-panel`);
            panels.forEach(panel => {
                panel.style.display = 'none';
                panel.classList.remove('active');
            });
            
            const activePanel = document.getElementById(`${menu}-${type}`);
            if (activePanel) {
                activePanel.style.display = 'block';
                activePanel.classList.add('active');
            }
        }
        
        // ê¶Œí•œ ì €ì¥
        function savePermissions() {
            console.log('ğŸ’¾ ê¶Œí•œ ì €ì¥ ì‹œì‘');
            
            const permissions = {};
            
            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ì—ì„œ ê¶Œí•œ ì •ë³´ ìˆ˜ì§‘
            const checkboxes = document.querySelectorAll('#menuPermissions input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                const menu = checkbox.dataset.menu;
                const type = checkbox.dataset.type;
                const value = checkbox.dataset.value;
                const isChecked = checkbox.checked;
                
                if (!permissions[menu]) {
                    permissions[menu] = {
                        departments: {},
                        positions: {},
                        individuals: {}
                    };
                }
                
                if (type === 'individuals') {
                    // ê°œì¸ë³„ ê¶Œí•œì€ IDë¡œ ì €ì¥
                    permissions[menu][type][value] = isChecked;
                } else {
                    // ë¶€ì„œ/ì§ê¸‰ë³„ ê¶Œí•œì€ ì´ë¦„ìœ¼ë¡œ ì €ì¥
                    permissions[menu][type][value] = isChecked;
                }
            });
            
            // localStorageì— ì €ì¥
            localStorage.setItem('menuPermissions', JSON.stringify(permissions));
            console.log('âœ… ê¶Œí•œ ì €ì¥ ì™„ë£Œ:', permissions);
            
            alert('ê¶Œí•œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ê°€ì… ìŠ¹ì¸ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function loadPendingMembers() {
            console.log('ğŸ“‹ ìŠ¹ì¸ ëŒ€ê¸° íšŒì› ëª©ë¡ ë¡œë“œ');
            
            const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
            const pendingMembersList = document.getElementById('pendingMembersList');
            
            if (pendingMembers.length === 0) {
                pendingMembersList.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #e2e8f0;">
                        <i class="fas fa-user-check" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="font-size: 1.1rem; margin: 0;">í˜„ì¬ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            pendingMembers.forEach(member => {
                const requestDate = new Date(member.requestedAt).toLocaleDateString('ko-KR');
                const roleText = {
                    'employee': 'ì§ì›',
                    'company_manager': 'ê´€ë¦¬ì',
                    'company_admin': 'íšŒì‚¬ ëŒ€í‘œ'
                }[member.role] || member.role;
                
                html += `
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <h4 style="color: #fff; margin: 0 0 0.5rem 0; font-size: 1.2rem;">
                                    <i class="fas fa-user" style="margin-right: 0.5rem;"></i>
                                    ${member.name}
                                </h4>
                                <p style="color: #e2e8f0; margin: 0 0 0.5rem 0;">
                                    <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>
                                    ${member.email}
                                </p>
                                ${member.phone ? `
                                <p style="color: #e2e8f0; margin: 0 0 0.5rem 0;">
                                    <i class="fas fa-phone" style="margin-right: 0.5rem;"></i>
                                    ${member.phone}
                                </p>` : ''}
                            </div>
                            <div style="text-align: right;">
                                <span style="background: rgba(255, 193, 7, 0.2); color: #ffc107; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.875rem; font-weight: 600;">
                                    <i class="fas fa-clock" style="margin-right: 0.25rem;"></i>ìŠ¹ì¸ëŒ€ê¸°
                                </span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            ${member.department ? `
                            <div>
                                <strong style="color: #cbd5e0;">ì†Œì† ë¶€ì„œ:</strong>
                                <span style="color: #e2e8f0; margin-left: 0.5rem;">${member.department}</span>
                            </div>` : ''}
                            ${member.position ? `
                            <div>
                                <strong style="color: #cbd5e0;">ì§ì±…:</strong>
                                <span style="color: #e2e8f0; margin-left: 0.5rem;">${member.position}</span>
                            </div>` : ''}
                            <div>
                                <strong style="color: #cbd5e0;">í¬ë§ ê¶Œí•œ:</strong>
                                <span style="color: #e2e8f0; margin-left: 0.5rem;">${roleText}</span>
                            </div>
                            <div>
                                <strong style="color: #cbd5e0;">ì‹ ì²­ì¼:</strong>
                                <span style="color: #e2e8f0; margin-left: 0.5rem;">${requestDate}</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                            <button onclick="approveMember('${member.id}')" class="btn" style="background: linear-gradient(135deg, #10b981, #059669); padding: 0.5rem 1rem; font-size: 0.875rem;">
                                <i class="fas fa-check" style="margin-right: 0.5rem;"></i>ìŠ¹ì¸
                            </button>
                            <button onclick="rejectMember('${member.id}')" class="btn btn-danger" style="background: linear-gradient(135deg, #ef4444, #dc2626); padding: 0.5rem 1rem; font-size: 0.875rem;">
                                <i class="fas fa-times" style="margin-right: 0.5rem;"></i>ê±°ë¶€
                            </button>
                        </div>
                    </div>
                `;
            });
            
            pendingMembersList.innerHTML = html;
        }

        function approveMember(memberId) {
            if (!confirm('ì´ íšŒì›ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            console.log('âœ… íšŒì› ìŠ¹ì¸:', memberId);
            
            const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
            const memberIndex = pendingMembers.findIndex(m => m.id === memberId);
            
            if (memberIndex === -1) {
                alert('ìŠ¹ì¸í•  íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const member = pendingMembers[memberIndex];
            
            // ê¸°ì¡´ ì§ì› ëª©ë¡ì— ì¶”ê°€
            const employees = JSON.parse(localStorage.getItem('employees') || '[]');
            const newEmployee = {
                id: member.id,
                name: member.name,
                email: member.email,
                phone: member.phone || '',
                role: member.role,
                department: member.department || '',
                position: member.position || '',
                password: 'demo123', // ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸
                company: 'seokyoung-snt', // ê¸°ë³¸ íšŒì‚¬
                status: 'active',
                createdAt: new Date().toISOString(),
                approvedAt: new Date().toISOString()
            };
            
            employees.push(newEmployee);
            localStorage.setItem('employees', JSON.stringify(employees));
            
            // ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ì—ì„œ ì œê±°
            pendingMembers.splice(memberIndex, 1);
            localStorage.setItem('pendingMembers', JSON.stringify(pendingMembers));
            
            alert(`${member.name}ë‹˜ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            loadPendingMembers();
        }

        function rejectMember(memberId) {
            if (!confirm('ì´ íšŒì›ì˜ ê°€ì…ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            console.log('âŒ íšŒì› ê±°ë¶€:', memberId);
            
            const pendingMembers = JSON.parse(localStorage.getItem('pendingMembers') || '[]');
            const memberIndex = pendingMembers.findIndex(m => m.id === memberId);
            
            if (memberIndex === -1) {
                alert('ê±°ë¶€í•  íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const member = pendingMembers[memberIndex];
            
            // ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ì—ì„œ ì œê±°
            pendingMembers.splice(memberIndex, 1);
            localStorage.setItem('pendingMembers', JSON.stringify(pendingMembers));
            
            alert(`${member.name}ë‹˜ì˜ ê°€ì…ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            loadPendingMembers();
        }

        function refreshPendingMembers() {
            console.log('ğŸ”„ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ ìƒˆë¡œê³ ì¹¨');
            loadPendingMembers();
        }

        // ë¬¸ì„œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showDocumentManagement() {
            console.log('ğŸ“„ ë¬¸ì„œ ê´€ë¦¬ í‘œì‹œ');
            showSection('documents');
            loadDocumentTemplates();
        }

        let currentEditingTemplate = null;
        let documentTemplates = {
            career: {
                name: 'ê²½ë ¥ì¦ëª…ì„œ',
                icon: 'fas fa-certificate',
                enabled: true,
                content: `ê²½ë ¥ì¦ëª…ì„œ

ì„±ëª…: [ì´ë¦„]
ìƒë…„ì›”ì¼: [ìƒë…„ì›”ì¼]
ì£¼ì†Œ: [ì£¼ì†Œ]

ìœ„ ì‚¬ëŒì˜ ê²½ë ¥ì‚¬í•­ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¦ëª…í•©ë‹ˆë‹¤.

ê·¼ë¬´ê¸°ê°„: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
ê·¼ë¬´ë¶€ì„œ: [ë¶€ì„œëª…]
ë‹´ë‹¹ì—…ë¬´: [ì—…ë¬´ë‚´ìš©]
ì§ì±…: [ì§ì±…]

[ë°œê¸‰ì¼ì]
[íšŒì‚¬ëª…]
ëŒ€í‘œì´ì‚¬: [ëŒ€í‘œëª…] (ì§ì¸)`
            },
            employment: {
                name: 'ì¬ì§ì¦ëª…ì„œ',
                icon: 'fas fa-id-card',
                enabled: true,
                content: `ì¬ì§ì¦ëª…ì„œ

ì„±ëª…: [ì´ë¦„]
ìƒë…„ì›”ì¼: [ìƒë…„ì›”ì¼]
ì£¼ì†Œ: [ì£¼ì†Œ]

ìœ„ ì‚¬ëŒì€ ë³¸ íšŒì‚¬ì— ì¬ì§ì¤‘ì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.

ì…ì‚¬ì¼: [ì…ì‚¬ì¼]
í˜„ ì§ì±…: [ì§ì±…]
í˜„ ë¶€ì„œ: [ë¶€ì„œ]
ì›” ê¸‰ì—¬: [ê¸‰ì—¬]ì›

ìš©ë„: [ì‚¬ìš©ìš©ë„]

[ë°œê¸‰ì¼ì]
[íšŒì‚¬ëª…]
ëŒ€í‘œì´ì‚¬: [ëŒ€í‘œëª…] (ì§ì¸)`
            },
            leave: {
                name: 'ì—°ì°¨ì‹ ì²­ì„œ',
                icon: 'fas fa-calendar-alt',
                enabled: true,
                content: `ì—°ì°¨ ì‹ ì²­ì„œ

ì‹ ì²­ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì§ì±…: [ì§ì±…]

ì—°ì°¨ ì‚¬ìš© ë‚´ì—­:
- ì‚¬ìš©ì¼ì: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
- ì‚¬ìš©ì¼ìˆ˜: [ì¼ìˆ˜]ì¼
- ì‚¬ìœ : [ì‚¬ìœ ]

ê¸´ê¸‰ì—°ë½ì²˜: [ì—°ë½ì²˜]

ìœ„ì™€ ê°™ì´ ì—°ì°¨ì‚¬ìš©ì„ ì‹ ì²­í•©ë‹ˆë‹¤.

ì‹ ì²­ì¼: [ë‚ ì§œ]
ì‹ ì²­ì: [ì´ë¦„] (ì„œëª…)

ìŠ¹ì¸ì¼: [ë‚ ì§œ]
ìŠ¹ì¸ì: [ìŠ¹ì¸ì] (ì„œëª…)`
            },
            resignation: {
                name: 'ì‚¬ì§ì„œ',
                icon: 'fas fa-sign-out-alt',
                enabled: true,
                content: `ì‚¬ì§ì„œ

ì„±ëª…: [ì´ë¦„]
ì…ì‚¬ì¼: [ì…ì‚¬ì¼]
ë¶€ì„œ: [ë¶€ì„œ]
ì§ì±…: [ì§ì±…]

ë³¸ì¸ì€ ê°œì¸ì ì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•˜ì—¬ ì‚¬ì§í•˜ê³ ì í•˜ë‹ˆ 
ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

ì‚¬ì§ ì˜ˆì •ì¼: [ì‚¬ì§ì¼]
ì‚¬ì§ ì‚¬ìœ : [ì‚¬ìœ ]

[ì‘ì„±ì¼ì]
[ì´ë¦„] (ì„œëª…)

[íšŒì‚¬ëª…] ê·€ì¤‘`
            },
            incident: {
                name: 'ê²½ìœ„ì„œ',
                icon: 'fas fa-exclamation-triangle',
                enabled: true,
                content: `ê²½ìœ„ì„œ

ì œëª©: [ì œëª©]
ì‘ì„±ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì‘ì„±ì¼: [ë‚ ì§œ]

ì‚¬ê±´ ê°œìš”:
[ì‚¬ê±´ ê°œìš” ì‘ì„±]

ìƒì„¸ ê²½ìœ„:
[ìƒì„¸ ê²½ìœ„ ì‘ì„±]

ì›ì¸ ë¶„ì„:
[ì›ì¸ ë¶„ì„ ì‘ì„±]

ê°œì„  ë°©ì•ˆ:
[ê°œì„  ë°©ì•ˆ ì‘ì„±]

[ì‘ì„±ì¼ì]
ì‘ì„±ì: [ì´ë¦„] (ì„œëª…)`
            },
            businessTrip: {
                name: 'ì¶œì¥ ë³´ê³ ì„œ',
                icon: 'fas fa-plane',
                enabled: true,
                content: `ì¶œì¥ ë³´ê³ ì„œ

ì¶œì¥ì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ì¶œì¥ê¸°ê°„: [ì‹œì‘ì¼] ~ [ì¢…ë£Œì¼]
ì¶œì¥ì§€: [ì¶œì¥ì§€]
ì¶œì¥ëª©ì : [ëª©ì ]

ì¶œì¥ ë‚´ìš©:
[ì¶œì¥ ë‚´ìš© ì‘ì„±]

ì„±ê³¼ ë° ê²°ê³¼:
[ì„±ê³¼ ë° ê²°ê³¼ ì‘ì„±]

íŠ¹ì´ì‚¬í•­:
[íŠ¹ì´ì‚¬í•­ ì‘ì„±]

í–¥í›„ ê³„íš:
[í–¥í›„ ê³„íš ì‘ì„±]

[ì‘ì„±ì¼ì]
ì¶œì¥ì: [ì´ë¦„] (ì„œëª…)`
            },
            proposal: {
                name: 'ê¸°ì•ˆì„œ',
                icon: 'fas fa-file-signature',
                enabled: true,
                content: `ê¸°ì•ˆì„œ

ì œëª©: [ì œëª©]
ê¸°ì•ˆì: [ì´ë¦„]
ë¶€ì„œ: [ë¶€ì„œ]
ê¸°ì•ˆì¼: [ë‚ ì§œ]

1. ê¸°ì•ˆ ë°°ê²½
[ê¸°ì•ˆ ë°°ê²½ ì‘ì„±]

2. ê¸°ì•ˆ ë‚´ìš©
[ê¸°ì•ˆ ë‚´ìš© ì‘ì„±]

3. ê¸°ëŒ€ íš¨ê³¼
[ê¸°ëŒ€ íš¨ê³¼ ì‘ì„±]

4. ì˜ˆì‚° ë° ì¼ì •
[ì˜ˆì‚° ë° ì¼ì • ì‘ì„±]

[ê¸°ì•ˆì¼ì]
ê¸°ì•ˆì: [ì´ë¦„] (ì„œëª…)

ê²°ì¬ë€:
ë‹´ë‹¹: _______ íŒ€ì¥: _______ ë³¸ë¶€ì¥: _______`
            }
        };

        // í…œí”Œë¦¿ ë¡œë“œ
        function loadDocumentTemplates() {
            const saved = localStorage.getItem('documentTemplates');
            if (saved) {
                const savedTemplates = JSON.parse(saved);
                // ê¸°ì¡´ ì €ì¥ëœ í…œí”Œë¦¿ê³¼ ê¸°ë³¸ í…œí”Œë¦¿ì„ ë³‘í•©
                Object.keys(documentTemplates).forEach(templateId => {
                    if (savedTemplates[templateId]) {
                        // enabled ì†ì„±ì´ ì—†ëŠ” ê²½ìš° trueë¡œ ì„¤ì •
                        if (savedTemplates[templateId].enabled === undefined) {
                            savedTemplates[templateId].enabled = true;
                        }
                        documentTemplates[templateId] = savedTemplates[templateId];
                    }
                });
                // ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ë“¤ë„ í¬í•¨
                Object.keys(savedTemplates).forEach(templateId => {
                    if (!documentTemplates[templateId]) {
                        documentTemplates[templateId] = savedTemplates[templateId];
                    }
                });
            }
            renderTemplates();
        }

        // í…œí”Œë¦¿ ì €ì¥
        function saveDocumentTemplates() {
            localStorage.setItem('documentTemplates', JSON.stringify(documentTemplates));
        }

        // í…œí”Œë¦¿ í† ê¸€
        function toggleTemplate(templateId) {
            if (documentTemplates[templateId]) {
                documentTemplates[templateId].enabled = !documentTemplates[templateId].enabled;
                saveDocumentTemplates();
                renderTemplates();
                
                const status = documentTemplates[templateId].enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”';
                console.log(`ğŸ“„ ${documentTemplates[templateId].name} ${status}`);
            }
        }

        // ìƒˆ í…œí”Œë¦¿ ì¶”ê°€
        function addNewTemplate() {
            const name = prompt('ìƒˆ í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (name && name.trim()) {
                const id = 'template_' + Date.now();
                documentTemplates[id] = {
                    name: name.trim(),
                    icon: 'fas fa-file-alt',
                    enabled: true,
                    content: 'ìƒˆë¡œìš´ í…œí”Œë¦¿ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.'
                };
                saveDocumentTemplates();
                renderTemplates();
            }
        }

        // í…œí”Œë¦¿ í¸ì§‘
        function editTemplate(templateId) {
            const template = documentTemplates[templateId];
            if (!template) return;

            currentEditingTemplate = templateId;
            document.getElementById('templateEditName').value = template.name;
            document.getElementById('templateEditContent').value = template.content;
            document.getElementById('templateEditModal').style.display = 'flex';
        }

        // í…œí”Œë¦¿ í¸ì§‘ ì €ì¥
        function saveTemplateEdit() {
            if (!currentEditingTemplate) return;

            const name = document.getElementById('templateEditName').value.trim();
            const content = document.getElementById('templateEditContent').value.trim();

            if (name && content) {
                documentTemplates[currentEditingTemplate].name = name;
                documentTemplates[currentEditingTemplate].content = content;
                saveDocumentTemplates();
                renderTemplates();
                closeTemplateEdit();
                alert('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('í…œí”Œë¦¿ ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í…œí”Œë¦¿ í¸ì§‘ ë‹«ê¸°
        function closeTemplateEdit() {
            document.getElementById('templateEditModal').style.display = 'none';
            currentEditingTemplate = null;
        }

        // í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° (admin ì „ìš©)
        function previewAdminTemplate(templateId) {
            console.log('ğŸ” previewAdminTemplate í˜¸ì¶œë¨, templateId:', templateId);
            console.log('ğŸ“‹ í˜„ì¬ documentTemplates:', documentTemplates);
            console.log('ğŸ“‹ documentTemplates í‚¤ë“¤:', Object.keys(documentTemplates));
            
            // ë¨¼ì € í…œí”Œë¦¿ì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!documentTemplates || Object.keys(documentTemplates).length === 0) {
                console.log('ğŸ“„ í…œí”Œë¦¿ì„ ë‹¤ì‹œ ë¡œë“œí•©ë‹ˆë‹¤...');
                loadDocumentTemplates();
            }
            
            const template = documentTemplates[templateId];
            if (!template) {
                console.error('âŒ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', templateId);
                console.log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ í…œí”Œë¦¿ë“¤:', Object.keys(documentTemplates));
                alert('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            console.log('âœ… ë¯¸ë¦¬ë³´ê¸° ì—´ê¸°:', template.name);
            
            const previewContent = document.getElementById('previewContent');
            const modal = document.getElementById('templatePreviewModal');
            
            if (!previewContent || !modal) {
                console.error('âŒ ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                alert('ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            previewContent.textContent = template.content;
            modal.style.display = 'block';
        }

        // ê¸°ì¡´ previewTemplate í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ
        function previewTemplate(templateId) {
            return previewAdminTemplate(templateId);
        }

        // í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°
        function closeTemplatePreview() {
            const modal = document.getElementById('templatePreviewModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // í…œí”Œë¦¿ ì¸ì‡„
        function printTemplate() {
            window.print();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('templatePreviewModal');
            if (modal && event.target === modal) {
                closeTemplatePreview();
            }
        });

        // í…œí”Œë¦¿ ì‚­ì œ
        function deleteTemplate(templateId) {
            if (templateId === 'career') {
                alert('ê¸°ë³¸ ê²½ë ¥ì¦ëª…ì„œ í…œí”Œë¦¿ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const template = documentTemplates[templateId];
            if (confirm(`"${template.name}" í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                delete documentTemplates[templateId];
                saveDocumentTemplates();
                renderTemplates();
            }
        }

        // í…œí”Œë¦¿ ë Œë”ë§
        function renderTemplates() {
            const container = document.getElementById('documentTemplates');
            container.innerHTML = '';

            Object.keys(documentTemplates).forEach(templateId => {
                const template = documentTemplates[templateId];
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                templateCard.setAttribute('data-template', templateId);

                templateCard.innerHTML = `
                    <div class="template-header">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="${template.icon}" style="color: #10b981;"></i>
                            <h4 style="color: #ffffff; margin: 0;">${template.name}</h4>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: #e5e7eb; font-size: 0.9rem;">ê²°ì¬ì„œë¥˜ í‘œì‹œ</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${template.enabled ? 'checked' : ''} onchange="toggleTemplate('${templateId}')">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-small btn-danger" onclick="deleteTemplate('${templateId}')" style="padding: 0.5rem 0.75rem;">
                                    <i class="fas fa-trash"></i> ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                container.appendChild(templateCard);
            });
        }

        // í™œì„±í™”ëœ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸° (ê²°ì¬ ì„œë¥˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©)
        function getEnabledTemplates() {
            const enabled = {};
            Object.keys(documentTemplates).forEach(templateId => {
                if (documentTemplates[templateId].enabled) {
                    enabled[templateId] = documentTemplates[templateId];
                }
            });
            return enabled;
        }

        // ë¬¸ì„œ ì„¤ì • ì €ì¥ (ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€)
        function saveDocumentSettings() {
            console.log('ğŸ“„ ë¬¸ì„œ ì„¤ì • ì €ì¥');
            alert('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        
        // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ì²˜ë¦¬
        function handlePopState(event) {
            console.log('ğŸ”„ ë¸Œë¼ìš°ì € ë„¤ë¹„ê²Œì´ì…˜ ê°ì§€:', window.location.hash);
            const hash = window.location.hash.substring(1); // # ì œê±°
            
            if (!hash || hash === '') {
                // ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                showSection('dashboard');
            } else {
                // í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                showSection(hash);
                
                // ê° ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
                if (hash === 'employees') {
                    // ì§ì› ê´€ë¦¬ ì„¹ì…˜ì˜ ê²½ìš° ê¶Œí•œ ì²´í¬
                    const user = AuthManager.getCurrentUser();
                    if (user && canManageEmployees(user)) {
                        // ì´ë¯¸ showSectionì—ì„œ í™”ë©´ì„ í‘œì‹œí–ˆìœ¼ë¯€ë¡œ ì¶”ê°€ ë¡œì§ ì—†ìŒ
                    } else {
                        // ê¶Œí•œ ì—†ìœ¼ë©´ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                        window.location.hash = '';
                        showSection('dashboard');
                        alert('ì§ì› ê´€ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else if (hash === 'permissions') {
                    loadMenuPermissions();
                } else if (hash === 'pendingMembers') {
                    // ê°€ì… ìŠ¹ì¸ ì„¹ì…˜ì˜ ê²½ìš° ê¶Œí•œ ì²´í¬
                    const user = AuthManager.getCurrentUser();
                    if (user && canManageEmployees(user)) {
                        loadPendingMembers();
                    } else {
                        // ê¶Œí•œ ì—†ìœ¼ë©´ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                        window.location.hash = '';
                        showSection('dashboard');
                        alert('ê°€ì… ìŠ¹ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else if (hash === 'documents') {
                    // ë¬¸ì„œ ê´€ë¦¬ ì„¹ì…˜
                    loadDocumentTemplates();
                }
            }
        }

        // í˜ì´ì§€ ì´ˆê¸°í™” ì‹œ URL í•´ì‹œ í™•ì¸
        function initializePage() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                // URLì— í•´ì‹œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
                handlePopState();
            } else {
                // í•´ì‹œê°€ ì—†ìœ¼ë©´ ë©”ì¸ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                showSection('dashboard');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('popstate', handlePopState);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initializePage);

        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
        window.switchPermissionTab = switchPermissionTab;
        window.savePermissions = savePermissions;
        window.loadMenuPermissions = loadMenuPermissions;
        window.showPendingMembers = showPendingMembers;
        window.loadPendingMembers = loadPendingMembers;
        window.approveMember = approveMember;
        window.rejectMember = rejectMember;
        window.refreshPendingMembers = refreshPendingMembers;
        window.showDocumentManagement = showDocumentManagement;
        window.saveDocumentSettings = saveDocumentSettings;
        window.handlePopState = handlePopState;
        window.initializePage = initializePage;
        window.openCorporateCardManagement = openCorporateCardManagement;
        window.checkAdminNotifications = checkAdminNotifications;
        
        // ë¬¸ì„œ í…œí”Œë¦¿ ê´€ë ¨ ì „ì—­ í•¨ìˆ˜
        window.getEnabledTemplates = getEnabledTemplates;
        window.documentTemplates = documentTemplates;
        window.loadDocumentTemplates = loadDocumentTemplates;
        window.previewAdminTemplate = previewAdminTemplate;
        window.previewTemplate = previewTemplate;

        // ë²•ì¸ì¹´ë“œ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
        function openCorporateCardManagement() {
            window.location.href = 'corporate-card.html?admin=true';
        }

        // ê´€ë¦¬ì ì•Œë¦¼ ì²´í¬ í•¨ìˆ˜
        function checkAdminNotifications() {
            const notifications = JSON.parse(localStorage.getItem('corporateCardNotifications') || '[]');
            const unreadNotifications = notifications.filter(n => !n.read);
            
            const badge = document.getElementById('adminCardNotificationBadge');
            if (badge) {
                if (unreadNotifications.length > 0) {
                    badge.textContent = unreadNotifications.length;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

    </script>
    <script src="../../shared-assets/js/platform.js"></script>
</body>
</html>
